(()=>{var a={};a.id=302,a.ids=[302],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},813:(a,b,c)=>{"use strict";c.d(b,{OU:()=>j});var d=c(3721),e=c(5788),f=c(3300),g=c(8208),h=c(9411),i=c(8853);class j{#a;constructor(a){this.#a=(0,e.CN)(a)}when(...a){return new k({...this.#a,node:f.P.cloneWithWhen(this.#a.node,g.t.create((0,h.GB)(a)))})}}class k{#a;constructor(a){this.#a=(0,e.CN)(a)}then(a){return new l({...this.#a,node:f.P.cloneWithThen(this.#a.node,(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a))})}}class l{#a;constructor(a){this.#a=(0,e.CN)(a)}when(...a){return new k({...this.#a,node:f.P.cloneWithWhen(this.#a.node,g.t.create((0,h.GB)(a)))})}else(a){return new m({...this.#a,node:f.P.cloneWith(this.#a.node,{else:(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a)})})}end(){return new d.Is(f.P.cloneWith(this.#a.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#a.node,{isStatement:!0}))}}class m{#a;constructor(a){this.#a=(0,e.CN)(a)}end(){return new d.Is(f.P.cloneWith(this.#a.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#a.node,{isStatement:!0}))}}},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1078:(a,b,c)=>{"use strict";c.d(b,{Z:()=>f});var d=c(5788),e=c(2325);let f=(0,d.CN)({is:a=>"ColumnNode"===a.kind,create:a=>(0,d.CN)({kind:"ColumnNode",column:e.O.create(a)})})},1427:(a,b,c)=>{"use strict";c.d(b,{F:()=>d,x:()=>e});class d extends Error{node;constructor(a){super("no result"),this.node=a}}function e(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}},1584:(a,b,c)=>{"use strict";c.d(b,{D:()=>e});let d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function e(a){let b="";for(let c=0;c<a;++c)b+=d[~~(Math.random()*d.length)];return b}},2041:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{handler:()=>mp,patchFetch:()=>mo,routeModule:()=>mk,serverHooks:()=>mn,workAsyncStorage:()=>ml,workUnitAsyncStorage:()=>mm});var e,f,g,h,i,j,k,l={};c.r(l),c.d(l,{GET:()=>mi,POST:()=>mj});var m=c(6559),n=c(8088),o=c(7719),p=c(6191),q=c(1289),r=c(261),s=c(2603),t=c(9893),u=c(4823),v=c(7220),w=c(6946),x=c(7912),y=c(9786),z=c(6143),A=c(6439),B=c(3365);let C=require("node:crypto");var D=c.t(C,2);let E=C.webcrypto?.subtle||{},F=a=>C.webcrypto.getRandomValues(a),G=(()=>{let a=function(){};return a.prototype=Object.create(null),a})();function H(){return{root:{key:""},static:new G}}function I(a){return a.split("/").filter(Boolean)}function J(a,b){let c=new G;for(let[d,e]of b){let b=d<0?a.slice(-1*d).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function K(a,b="",c,d){let e=I(c),f=a.root,g=0,h=[];for(let a=0;a<e.length;a++){let b=e[a];if(b.startsWith("**")){f.wildcard||(f.wildcard={key:"**"}),f=f.wildcard,h.push([-a,b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){f.param||(f.param={key:"*"}),f=f.param;let c="*"===b;h.push([a,c?`_${g++}`:function(a){if(!a.includes(":",1))return a.slice(1);let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>\\w+)`);return RegExp(`^${b}$`)}(b),c]);continue}let c=f.static?.[b];if(c)f=c;else{let a={key:b};f.static||(f.static=new G),f.static[b]=a,f=a}}let i=h.length>0;f.methods||(f.methods=new G),f.methods[b]||(f.methods[b]=[]),f.methods[b].push({data:d||null,paramsMap:i?h:void 0}),i||(a.static[c]=f)}var L={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},M=class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:L[a]){super(b?.message),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0,this.stack=""}};async function N(a){let b=a.headers.get("content-type")||"";if(a.body){if(b.includes("application/json"))return await a.json();if(b.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(b.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return b.includes("text/plain")?await a.text():b.includes("application/octet-stream")?await a.arrayBuffer():b.includes("application/pdf")||b.includes("image/")||b.includes("video/")?await a.blob():b.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function O(a){return a instanceof M||a?.name==="APIError"}function P(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a?._flag==="json"){let b=a.routerResponse;return b instanceof Response?b:P(a.body,{headers:a.headers,status:a.status})}if(O(a))return P(a.body,{status:a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);return a?"string"==typeof a?(c=a,d.set("Content-Type","text/plain")):a instanceof ArrayBuffer||ArrayBuffer.isView(a)?(c=a,d.set("Content-Type","application/octet-stream")):a instanceof Blob?(c=a,d.set("Content-Type",a.type||"application/octet-stream")):a instanceof FormData?c=a:a instanceof URLSearchParams?(c=a,d.set("Content-Type","application/x-www-form-urlencoded")):a instanceof ReadableStream?(c=a,d.set("Content-Type","application/octet-stream")):function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)&&(c=JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString():b),d.set("Content-Type","application/json")):(null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json")),new Response(c,{...b,headers:d})}async function Q(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:R(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:R(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required"}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required"}}:{data:c,error:null}}function R(a,b){let c=[];for(let b of a){let a=b.message;c.push(a)}return{message:`Invalid ${b} parameters`}}var S={name:"HMAC",hash:"SHA-256"},T=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await E.importKey("raw",b,S,!1,["sign","verify"])},U=async(a,b,c)=>{try{let d=atob(a),e=new Uint8Array(d.length);for(let a=0,b=d.length;a<b;a++)e[a]=d.charCodeAt(a);return await E.verify(S,c,e,new TextEncoder().encode(b))}catch(a){return!1}},V=async(a,b)=>{let c=await T(b);return btoa(String.fromCharCode(...new Uint8Array(await E.sign(S.name,c,new TextEncoder().encode(a)))))},W=async(a,b)=>{let c=await V(a,b);return a=encodeURIComponent(a=`${a}.${c}`)},X=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},Y=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},Z=async(a,b,c,d)=>Y(a,b=await W(b,c),d),$=async(a,{options:b,path:c})=>{let d=new Headers,{data:e,error:f}=await Q(b,a);if(f)throw new M(400,{message:f.message,code:"VALIDATION_ERROR"});let g="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&a.request instanceof Request?a.request.headers:null,h=g?.get("cookie"),i=h?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(h):void 0,j={...a,body:e.body,query:e.query,path:a.path||c,context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method,setHeader:(a,b)=>{d.set(a,b)},getHeader:a=>g?g.get(a):null,getCookie:(a,b)=>{let c=X(a,b);return c&&i?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=X(a,c);if(!d)return null;let e=i?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);if(44!==h.length||!h.endsWith("="))return null;let j=await T(b);return!!await U(h,g,j)&&g},setCookie:(a,b,c)=>{let e=((a,b,c)=>Y(a,b=encodeURIComponent(b),c))(a,b,c);return d.append("set-cookie",e),e},setSignedCookie:async(a,b,c,e)=>{let f=await Z(a,b,c,e);return d.append("set-cookie",f),f},redirect:a=>(d.set("location",a),new M("FOUND",void 0,d)),error:(a,b,c)=>new M(a,b,c),json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:d};for(let a of b.use||[]){let b=await a({...j,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(j.context,b.response),b.headers&&b.headers.forEach((a,b)=>{j.responseHeaders.set(b,a)})}return j};function _(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await $(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}_.create=a=>function(b,c){if("function"==typeof b)return _({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return _({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};var aa=(a,b,c)=>{let d=async(...d)=>{let e=d[0]||{},f=await $(e,{options:b,path:a}),g=await c(f).catch(async a=>{if(O(a)){let c=b.onAPIError;if(c&&await c(a),e.asResponse)return a}throw a}),h=f.responseHeaders;return e.asResponse?P(g,{headers:h}):e.returnHeaders?{headers:h,response:g}:g};return d.options=b,d.path=a,d};aa.create=a=>(b,c,d)=>aa(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),function(a){a.assertEqual=a=>a,a.assertIs=function(a){},a.assertNever=function(a){throw Error()},a.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},a.getValidEnumValues=b=>{let c=a.objectKeys(b).filter(a=>"number"!=typeof b[b[a]]),d={};for(let a of c)d[a]=b[a];return a.objectValues(d)},a.objectValues=b=>a.objectKeys(b).map(function(a){return b[a]}),a.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},a.find=(a,b)=>{for(let c of a)if(b(c))return c},a.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&isFinite(a)&&Math.floor(a)===a,a.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},a.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b}(e||(e={})),(f||(f={})).mergeShapes=(a,b)=>({...a,...b});var ab=e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ac=a=>{switch(typeof a){case"undefined":return ab.undefined;case"string":return ab.string;case"number":return isNaN(a)?ab.nan:ab.number;case"boolean":return ab.boolean;case"function":return ab.function;case"bigint":return ab.bigint;case"symbol":return ab.symbol;case"object":if(Array.isArray(a))return ab.array;if(null===a)return ab.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return ab.promise;if("undefined"!=typeof Map&&a instanceof Map)return ab.map;if("undefined"!=typeof Set&&a instanceof Set)return ab.set;if("undefined"!=typeof Date&&a instanceof Date)return ab.date;return ab.object;default:return ab.unknown}},ad=e.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ae=class a extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(b){if(!(b instanceof a))throw Error(`Not a ZodError: ${b}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,e.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)d.path.length>0?(b[d.path[0]]=b[d.path[0]]||[],b[d.path[0]].push(a(d))):c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}};ae.create=a=>new ae(a);var af=(a,b)=>{let c;switch(a.code){case ad.invalid_type:c=a.received===ab.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case ad.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,e.jsonStringifyReplacer)}`;break;case ad.unrecognized_keys:c=`Unrecognized key(s) in object: ${e.joinValues(a.keys,", ")}`;break;case ad.invalid_union:c="Invalid input";break;case ad.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${e.joinValues(a.options)}`;break;case ad.invalid_enum_value:c=`Invalid enum value. Expected ${e.joinValues(a.options)}, received '${a.received}'`;break;case ad.invalid_arguments:c="Invalid function arguments";break;case ad.invalid_return_type:c="Invalid function return type";break;case ad.invalid_date:c="Invalid date";break;case ad.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:e.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case ad.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case ad.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case ad.custom:c="Invalid input";break;case ad.invalid_intersection_types:c="Intersection results could not be merged";break;case ad.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case ad.not_finite:c="Number must be finite";break;default:c=b.defaultError,e.assertNever(a)}return{message:c}},ag=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}};function ah(a,b){let c=ag({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,af,void 0].filter(a=>!!a)});a.common.issues.push(c)}var ai=class a{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return aj;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(b,c){let d=[];for(let a of c){let b=await a.key,c=await a.value;d.push({key:b,value:c})}return a.mergeObjectSync(b,d)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return aj;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}},aj=Object.freeze({status:"aborted"}),ak=a=>({status:"dirty",value:a}),al=a=>({status:"valid",value:a}),am=a=>"undefined"!=typeof Promise&&a instanceof Promise;function an(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}function ao(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}!function(a){a.errToObj=a=>"string"==typeof a?{message:a}:a||{},a.toString=a=>"string"==typeof a?a:null==a?void 0:a.message}(g||(g={}));var ap=class{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},aq=(a,b)=>{if("valid"===b.status)return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new ae(a.common.issues);return this._error=b,this._error}}};function ar(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{var f,g;let{message:h}=a;return"invalid_enum_value"===b.code?{message:null!=h?h:e.defaultError}:void 0===e.data?{message:null!=(f=null!=h?h:d)?f:e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:null!=(g=null!=h?h:c)?g:e.defaultError}},description:e}}var as=class{get description(){return this._def.description}_getType(a){return ac(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:ac(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new ai,ctx:{common:a.parent.common,data:a.data,parsedType:ac(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(am(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){var c;let d={common:{issues:[],async:null!=(c=null==b?void 0:b.async)&&c,contextualErrorMap:null==b?void 0:b.errorMap},path:(null==b?void 0:b.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:ac(a)},e=this._parseSync({data:a,path:d.path,parent:d});return aq(d,e)}"~validate"(a){var b,c;let d={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:ac(a)};if(!this["~standard"].async)try{let b=this._parseSync({data:a,path:[],parent:d});return"valid"===b.status?{value:b.value}:{issues:d.common.issues}}catch(a){(null==(c=null==(b=null==a?void 0:a.message)?void 0:b.toLowerCase())?void 0:c.includes("encountered"))&&(this["~standard"].async=!0),d.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:d}).then(a=>"valid"===a.status?{value:a.value}:{issues:d.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:null==b?void 0:b.errorMap,async:!0},path:(null==b?void 0:b.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:ac(a)},d=this._parse({data:a,path:c.path,parent:c});return aq(c,await (am(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:ad.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new bb({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return bc.create(this,this._def)}nullable(){return bd.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return aW.create(this)}promise(){return ba.create(this,this._def)}or(a){return aY.create([this,a],this._def)}and(a){return a_.create(this,a,this._def)}transform(a){return new bb({...ar(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new be({...ar(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:k.ZodDefault})}brand(){return new bh({typeName:k.ZodBranded,type:this,...ar(this._def)})}catch(a){return new bf({...ar(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:k.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return bi.create(this,a)}readonly(){return bj.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},at=/^c[^\s-]{8,}$/i,au=/^[0-9a-z]+$/,av=/^[0-9A-HJKMNP-TV-Z]{26}$/i,aw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ax=/^[a-z0-9_-]{21}$/i,ay=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,az=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,aA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aB=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,aC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aD=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,aE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,aF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,aG=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,aH="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",aI=RegExp(`^${aH}$`);function aJ(a){let b="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`),b}var aK=class a extends as{_parse(a){var b,c,d,f;let g;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==ab.string){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.string,received:b.parsedType}),aj}let h=new ai;for(let i of this._def.checks)if("min"===i.kind)a.data.length<i.value&&(ah(g=this._getOrReturnCtx(a,g),{code:ad.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("max"===i.kind)a.data.length>i.value&&(ah(g=this._getOrReturnCtx(a,g),{code:ad.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("length"===i.kind){let b=a.data.length>i.value,c=a.data.length<i.value;(b||c)&&(g=this._getOrReturnCtx(a,g),b?ah(g,{code:ad.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&ah(g,{code:ad.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),h.dirty())}else if("email"===i.kind)aA.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"email",code:ad.invalid_string,message:i.message}),h.dirty());else if("emoji"===i.kind)j||(j=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),j.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"emoji",code:ad.invalid_string,message:i.message}),h.dirty());else if("uuid"===i.kind)aw.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"uuid",code:ad.invalid_string,message:i.message}),h.dirty());else if("nanoid"===i.kind)ax.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"nanoid",code:ad.invalid_string,message:i.message}),h.dirty());else if("cuid"===i.kind)at.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"cuid",code:ad.invalid_string,message:i.message}),h.dirty());else if("cuid2"===i.kind)au.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"cuid2",code:ad.invalid_string,message:i.message}),h.dirty());else if("ulid"===i.kind)av.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"ulid",code:ad.invalid_string,message:i.message}),h.dirty());else if("url"===i.kind)try{new URL(a.data)}catch(b){ah(g=this._getOrReturnCtx(a,g),{validation:"url",code:ad.invalid_string,message:i.message}),h.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"regex",code:ad.invalid_string,message:i.message}),h.dirty())):"trim"===i.kind?a.data=a.data.trim():"includes"===i.kind?a.data.includes(i.value,i.position)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),h.dirty()):"toLowerCase"===i.kind?a.data=a.data.toLowerCase():"toUpperCase"===i.kind?a.data=a.data.toUpperCase():"startsWith"===i.kind?a.data.startsWith(i.value)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:{startsWith:i.value},message:i.message}),h.dirty()):"endsWith"===i.kind?a.data.endsWith(i.value)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:{endsWith:i.value},message:i.message}),h.dirty()):"datetime"===i.kind?(function(a){let b=`${aH}T${aJ(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)})(i).test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:"datetime",message:i.message}),h.dirty()):"date"===i.kind?aI.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:"date",message:i.message}),h.dirty()):"time"===i.kind?RegExp(`^${aJ(i)}$`).test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{code:ad.invalid_string,validation:"time",message:i.message}),h.dirty()):"duration"===i.kind?az.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"duration",code:ad.invalid_string,message:i.message}),h.dirty()):"ip"===i.kind?(b=a.data,!(("v4"===(c=i.version)||!c)&&aB.test(b)||("v6"===c||!c)&&aD.test(b))&&1&&(ah(g=this._getOrReturnCtx(a,g),{validation:"ip",code:ad.invalid_string,message:i.message}),h.dirty())):"jwt"===i.kind?!function(a,b){if(!ay.test(a))return!1;try{let[c]=a.split("."),d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||!e.typ||!e.alg||b&&e.alg!==b)return!1;return!0}catch(a){return!1}}(a.data,i.alg)&&(ah(g=this._getOrReturnCtx(a,g),{validation:"jwt",code:ad.invalid_string,message:i.message}),h.dirty()):"cidr"===i.kind?(d=a.data,!(("v4"===(f=i.version)||!f)&&aC.test(d)||("v6"===f||!f)&&aE.test(d))&&1&&(ah(g=this._getOrReturnCtx(a,g),{validation:"cidr",code:ad.invalid_string,message:i.message}),h.dirty())):"base64"===i.kind?aF.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"base64",code:ad.invalid_string,message:i.message}),h.dirty()):"base64url"===i.kind?aG.test(a.data)||(ah(g=this._getOrReturnCtx(a,g),{validation:"base64url",code:ad.invalid_string,message:i.message}),h.dirty()):e.assertNever(i);return{status:h.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:ad.invalid_string,...g.errToObj(c)})}_addCheck(b){return new a({...this._def,checks:[...this._def.checks,b]})}email(a){return this._addCheck({kind:"email",...g.errToObj(a)})}url(a){return this._addCheck({kind:"url",...g.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...g.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...g.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...g.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...g.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...g.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...g.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...g.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...g.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...g.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...g.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...g.errToObj(a)})}datetime(a){var b,c;return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===(null==a?void 0:a.precision)?null:null==a?void 0:a.precision,offset:null!=(b=null==a?void 0:a.offset)&&b,local:null!=(c=null==a?void 0:a.local)&&c,...g.errToObj(null==a?void 0:a.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===(null==a?void 0:a.precision)?null:null==a?void 0:a.precision,...g.errToObj(null==a?void 0:a.message)})}duration(a){return this._addCheck({kind:"duration",...g.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...g.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:null==b?void 0:b.position,...g.errToObj(null==b?void 0:b.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...g.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...g.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...g.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...g.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...g.errToObj(b)})}nonempty(a){return this.min(1,g.errToObj(a))}trim(){return new a({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}};aK.create=a=>{var b;return new aK({checks:[],typeName:k.ZodString,coerce:null!=(b=null==a?void 0:a.coerce)&&b,...ar(a)})};var aL=class a extends as{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==ab.number){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.number,received:b.parsedType}),aj}let c=new ai;for(let d of this._def.checks)"int"===d.kind?e.isInteger(a.data)||(ah(b=this._getOrReturnCtx(a,b),{code:ad.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return parseInt(a.toFixed(e).replace(".",""))%parseInt(b.toFixed(e).replace(".",""))/Math.pow(10,e)}(a.data,d.value)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(ah(b=this._getOrReturnCtx(a,b),{code:ad.not_finite,message:d.message}),c.dirty()):e.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,g.toString(b))}gt(a,b){return this.setLimit("min",a,!1,g.toString(b))}lte(a,b){return this.setLimit("max",a,!0,g.toString(b))}lt(a,b){return this.setLimit("max",a,!1,g.toString(b))}setLimit(b,c,d,e){return new a({...this._def,checks:[...this._def.checks,{kind:b,value:c,inclusive:d,message:g.toString(e)}]})}_addCheck(b){return new a({...this._def,checks:[...this._def.checks,b]})}int(a){return this._addCheck({kind:"int",message:g.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:g.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:g.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:g.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:g.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:g.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:g.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:g.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:g.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&e.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}};aL.create=a=>new aL({checks:[],typeName:k.ZodNumber,coerce:(null==a?void 0:a.coerce)||!1,...ar(a)});var aM=class a extends as{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch(b){return this._getInvalidInput(a)}if(this._getType(a)!==ab.bigint)return this._getInvalidInput(a);let c=new ai;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):e.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.bigint,received:b.parsedType}),aj}gte(a,b){return this.setLimit("min",a,!0,g.toString(b))}gt(a,b){return this.setLimit("min",a,!1,g.toString(b))}lte(a,b){return this.setLimit("max",a,!0,g.toString(b))}lt(a,b){return this.setLimit("max",a,!1,g.toString(b))}setLimit(b,c,d,e){return new a({...this._def,checks:[...this._def.checks,{kind:b,value:c,inclusive:d,message:g.toString(e)}]})}_addCheck(b){return new a({...this._def,checks:[...this._def.checks,b]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:g.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:g.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:g.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:g.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:g.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}};aM.create=a=>{var b;return new aM({checks:[],typeName:k.ZodBigInt,coerce:null!=(b=null==a?void 0:a.coerce)&&b,...ar(a)})};var aN=class extends as{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==ab.boolean){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.boolean,received:b.parsedType}),aj}return al(a.data)}};aN.create=a=>new aN({typeName:k.ZodBoolean,coerce:(null==a?void 0:a.coerce)||!1,...ar(a)});var aO=class a extends as{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==ab.date){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.date,received:b.parsedType}),aj}if(isNaN(a.data.getTime()))return ah(this._getOrReturnCtx(a),{code:ad.invalid_date}),aj;let c=new ai;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(ah(b=this._getOrReturnCtx(a,b),{code:ad.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):e.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(b){return new a({...this._def,checks:[...this._def.checks,b]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:g.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:g.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}};aO.create=a=>new aO({checks:[],coerce:(null==a?void 0:a.coerce)||!1,typeName:k.ZodDate,...ar(a)});var aP=class extends as{_parse(a){if(this._getType(a)!==ab.symbol){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.symbol,received:b.parsedType}),aj}return al(a.data)}};aP.create=a=>new aP({typeName:k.ZodSymbol,...ar(a)});var aQ=class extends as{_parse(a){if(this._getType(a)!==ab.undefined){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.undefined,received:b.parsedType}),aj}return al(a.data)}};aQ.create=a=>new aQ({typeName:k.ZodUndefined,...ar(a)});var aR=class extends as{_parse(a){if(this._getType(a)!==ab.null){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.null,received:b.parsedType}),aj}return al(a.data)}};aR.create=a=>new aR({typeName:k.ZodNull,...ar(a)});var aS=class extends as{constructor(){super(...arguments),this._any=!0}_parse(a){return al(a.data)}};aS.create=a=>new aS({typeName:k.ZodAny,...ar(a)});var aT=class extends as{constructor(){super(...arguments),this._unknown=!0}_parse(a){return al(a.data)}};aT.create=a=>new aT({typeName:k.ZodUnknown,...ar(a)});var aU=class extends as{_parse(a){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.never,received:b.parsedType}),aj}};aU.create=a=>new aU({typeName:k.ZodNever,...ar(a)});var aV=class extends as{_parse(a){if(this._getType(a)!==ab.undefined){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.void,received:b.parsedType}),aj}return al(a.data)}};aV.create=a=>new aV({typeName:k.ZodVoid,...ar(a)});var aW=class a extends as{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==ab.array)return ah(b,{code:ad.invalid_type,expected:ab.array,received:b.parsedType}),aj;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(ah(b,{code:a?ad.too_big:ad.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(ah(b,{code:ad.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(ah(b,{code:ad.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new ap(b,a,b.path,c)))).then(a=>ai.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new ap(b,a,b.path,c)));return ai.mergeArray(c,e)}get element(){return this._def.type}min(b,c){return new a({...this._def,minLength:{value:b,message:g.toString(c)}})}max(b,c){return new a({...this._def,maxLength:{value:b,message:g.toString(c)}})}length(b,c){return new a({...this._def,exactLength:{value:b,message:g.toString(c)}})}nonempty(a){return this.min(1,a)}};aW.create=(a,b)=>new aW({type:a,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...ar(b)});var aX=class a extends as{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=e.objectKeys(a);return this._cached={shape:a,keys:b}}_parse(a){if(this._getType(a)!==ab.object){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.object,received:b.parsedType}),aj}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof aU&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new ap(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof aU){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(ah(c,{code:ad.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new ap(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>ai.mergeObjectSync(b,a)):ai.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(b){return g.errToObj,new a({...this._def,unknownKeys:"strict",...void 0!==b?{errorMap:(a,c)=>{var d,e,f,h;let i=null!=(f=null==(e=(d=this._def).errorMap)?void 0:e.call(d,a,c).message)?f:c.defaultError;return"unrecognized_keys"===a.code?{message:null!=(h=g.errToObj(b).message)?h:i}:{message:i}}}:{}})}strip(){return new a({...this._def,unknownKeys:"strip"})}passthrough(){return new a({...this._def,unknownKeys:"passthrough"})}extend(b){return new a({...this._def,shape:()=>({...this._def.shape(),...b})})}merge(b){return new a({unknownKeys:b._def.unknownKeys,catchall:b._def.catchall,shape:()=>({...this._def.shape(),...b._def.shape()}),typeName:k.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(b){return new a({...this._def,catchall:b})}pick(b){let c={};return e.objectKeys(b).forEach(a=>{b[a]&&this.shape[a]&&(c[a]=this.shape[a])}),new a({...this._def,shape:()=>c})}omit(b){let c={};return e.objectKeys(this.shape).forEach(a=>{b[a]||(c[a]=this.shape[a])}),new a({...this._def,shape:()=>c})}deepPartial(){return function a(b){if(b instanceof aX){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=bc.create(a(e))}return new aX({...b._def,shape:()=>c})}if(b instanceof aW)return new aW({...b._def,type:a(b.element)});if(b instanceof bc)return bc.create(a(b.unwrap()));if(b instanceof bd)return bd.create(a(b.unwrap()));if(b instanceof a0)return a0.create(b.items.map(b=>a(b)));else return b}(this)}partial(b){let c={};return e.objectKeys(this.shape).forEach(a=>{let d=this.shape[a];b&&!b[a]?c[a]=d:c[a]=d.optional()}),new a({...this._def,shape:()=>c})}required(b){let c={};return e.objectKeys(this.shape).forEach(a=>{if(b&&!b[a])c[a]=this.shape[a];else{let b=this.shape[a];for(;b instanceof bc;)b=b._def.innerType;c[a]=b}}),new a({...this._def,shape:()=>c})}keyof(){return a7(e.objectKeys(this.shape))}};aX.create=(a,b)=>new aX({shape:()=>a,unknownKeys:"strip",catchall:aU.create(),typeName:k.ZodObject,...ar(b)}),aX.strictCreate=(a,b)=>new aX({shape:()=>a,unknownKeys:"strict",catchall:aU.create(),typeName:k.ZodObject,...ar(b)}),aX.lazycreate=(a,b)=>new aX({shape:a,unknownKeys:"strip",catchall:aU.create(),typeName:k.ZodObject,...ar(b)});var aY=class extends as{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new ae(a.ctx.common.issues));return ah(b,{code:ad.invalid_union,unionErrors:c}),aj});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new ae(a));return ah(b,{code:ad.invalid_union,unionErrors:e}),aj}}get options(){return this._def.options}};aY.create=(a,b)=>new aY({options:a,typeName:k.ZodUnion,...ar(b)});var aZ=a=>{if(a instanceof a5)return aZ(a.schema);if(a instanceof bb)return aZ(a.innerType());if(a instanceof a6)return[a.value];if(a instanceof a8)return a.options;if(a instanceof a9)return e.objectValues(a.enum);else if(a instanceof be)return aZ(a._def.innerType);else if(a instanceof aQ)return[void 0];else if(a instanceof aR)return[null];else if(a instanceof bc)return[void 0,...aZ(a.unwrap())];else if(a instanceof bd)return[null,...aZ(a.unwrap())];else if(a instanceof bh)return aZ(a.unwrap());else if(a instanceof bj)return aZ(a.unwrap());else if(a instanceof bf)return aZ(a._def.innerType);else return[]},a$=class a extends as{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==ab.object)return ah(b,{code:ad.invalid_type,expected:ab.object,received:b.parsedType}),aj;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(ah(b,{code:ad.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),aj)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(b,c,d){let e=new Map;for(let a of c){let c=aZ(a.shape[b]);if(!c.length)throw Error(`A discriminator value for key \`${b}\` could not be extracted from all schema options`);for(let d of c){if(e.has(d))throw Error(`Discriminator property ${String(b)} has duplicate value ${String(d)}`);e.set(d,a)}}return new a({typeName:k.ZodDiscriminatedUnion,discriminator:b,options:c,optionsMap:e,...ar(d)})}},a_=class extends as{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=(a,d)=>{if("aborted"===a.status||"aborted"===d.status)return aj;let f=function a(b,c){let d=ac(b),f=ac(c);if(b===c)return{valid:!0,data:b};if(d===ab.object&&f===ab.object){let d=e.objectKeys(c),f=e.objectKeys(b).filter(a=>-1!==d.indexOf(a)),g={...b,...c};for(let d of f){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};g[d]=e.data}return{valid:!0,data:g}}if(d===ab.array&&f===ab.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(d===ab.date&&f===ab.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,d.value);return f.valid?(("dirty"===a.status||"dirty"===d.status)&&b.dirty(),{status:b.value,value:f.data}):(ah(c,{code:ad.invalid_intersection_types}),aj)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>d(a,b)):d(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}};a_.create=(a,b,c)=>new a_({left:a,right:b,typeName:k.ZodIntersection,...ar(c)});var a0=class a extends as{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==ab.array)return ah(c,{code:ad.invalid_type,expected:ab.array,received:c.parsedType}),aj;if(c.data.length<this._def.items.length)return ah(c,{code:ad.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),aj;!this._def.rest&&c.data.length>this._def.items.length&&(ah(c,{code:ad.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new ap(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>ai.mergeArray(b,a)):ai.mergeArray(b,d)}get items(){return this._def.items}rest(b){return new a({...this._def,rest:b})}};a0.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new a0({items:a,typeName:k.ZodTuple,rest:null,...ar(b)})};var a1=class a extends as{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==ab.object)return ah(c,{code:ad.invalid_type,expected:ab.object,received:c.parsedType}),aj;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new ap(c,a,c.path,a)),value:f._parse(new ap(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?ai.mergeObjectAsync(b,d):ai.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(b,c,d){return new a(c instanceof as?{keyType:b,valueType:c,typeName:k.ZodRecord,...ar(d)}:{keyType:aK.create(),valueType:b,typeName:k.ZodRecord,...ar(c)})}},a2=class extends as{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==ab.map)return ah(c,{code:ad.invalid_type,expected:ab.map,received:c.parsedType}),aj;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new ap(c,a,c.path,[f,"key"])),value:e._parse(new ap(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return aj;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return aj;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}};a2.create=(a,b,c)=>new a2({valueType:b,keyType:a,typeName:k.ZodMap,...ar(c)});var a3=class a extends as{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==ab.set)return ah(c,{code:ad.invalid_type,expected:ab.set,received:c.parsedType}),aj;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(ah(c,{code:ad.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(ah(c,{code:ad.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return aj;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new ap(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(b,c){return new a({...this._def,minSize:{value:b,message:g.toString(c)}})}max(b,c){return new a({...this._def,maxSize:{value:b,message:g.toString(c)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}};a3.create=(a,b)=>new a3({valueType:a,minSize:null,maxSize:null,typeName:k.ZodSet,...ar(b)});var a4=class a extends as{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==ab.function)return ah(b,{code:ad.invalid_type,expected:ab.function,received:b.parsedType}),aj;function c(a,c){return ag({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,af,af].filter(a=>!!a),issueData:{code:ad.invalid_arguments,argumentsError:c}})}function d(a,c){return ag({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,af,af].filter(a=>!!a),issueData:{code:ad.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof ba){let a=this;return al(async function(...b){let g=new ae([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return al(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new ae([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new ae([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...b){return new a({...this._def,args:a0.create(b).rest(aT.create())})}returns(b){return new a({...this._def,returns:b})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(b,c,d){return new a({args:b||a0.create([]).rest(aT.create()),returns:c||aT.create(),typeName:k.ZodFunction,...ar(d)})}},a5=class extends as{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}};a5.create=(a,b)=>new a5({getter:a,typeName:k.ZodLazy,...ar(b)});var a6=class extends as{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return ah(b,{received:b.data,code:ad.invalid_literal,expected:this._def.value}),aj}return{status:"valid",value:a.data}}get value(){return this._def.value}};function a7(a,b){return new a8({values:a,typeName:k.ZodEnum,...ar(b)})}a6.create=(a,b)=>new a6({value:a,typeName:k.ZodLiteral,...ar(b)});var a8=class a extends as{constructor(){super(...arguments),h.set(this,void 0)}_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return ah(b,{expected:e.joinValues(c),received:b.parsedType,code:ad.invalid_type}),aj}if(an(this,h,"f")||ao(this,h,new Set(this._def.values),"f"),!an(this,h,"f").has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return ah(b,{received:b.data,code:ad.invalid_enum_value,options:c}),aj}return al(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(b,c=this._def){return a.create(b,{...this._def,...c})}exclude(b,c=this._def){return a.create(this.options.filter(a=>!b.includes(a)),{...this._def,...c})}};h=new WeakMap,a8.create=a7;var a9=class extends as{constructor(){super(...arguments),i.set(this,void 0)}_parse(a){let b=e.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==ab.string&&c.parsedType!==ab.number){let a=e.objectValues(b);return ah(c,{expected:e.joinValues(a),received:c.parsedType,code:ad.invalid_type}),aj}if(an(this,i,"f")||ao(this,i,new Set(e.getValidEnumValues(this._def.values)),"f"),!an(this,i,"f").has(a.data)){let a=e.objectValues(b);return ah(c,{received:c.data,code:ad.invalid_enum_value,options:a}),aj}return al(a.data)}get enum(){return this._def.values}};i=new WeakMap,a9.create=(a,b)=>new a9({values:a,typeName:k.ZodNativeEnum,...ar(b)});var ba=class extends as{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==ab.promise&&!1===b.common.async?(ah(b,{code:ad.invalid_type,expected:ab.promise,received:b.parsedType}),aj):al((b.parsedType===ab.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}};ba.create=(a,b)=>new ba({type:a,typeName:k.ZodPromise,...ar(b)});var bb=class extends as{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,f={addIssue:a=>{ah(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(f.addIssue=f.addIssue.bind(f),"preprocess"===d.type){let a=d.transform(c.data,f);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return aj;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?aj:"dirty"===d.status||"dirty"===b.value?ak(d.value):d});{if("aborted"===b.value)return aj;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?aj:"dirty"===d.status||"dirty"===b.value?ak(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,f);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?aj:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?aj:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>"valid"!==a.status?a:Promise.resolve(d.transform(a.value,f)).then(a=>({status:b.value,value:a})));else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if("valid"!==a.status)return a;let e=d.transform(a.value,f);if(e instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:e}}e.assertNever(d)}};bb.create=(a,b,c)=>new bb({schema:a,typeName:k.ZodEffects,effect:b,...ar(c)}),bb.createWithPreprocess=(a,b,c)=>new bb({schema:b,effect:{type:"preprocess",transform:a},typeName:k.ZodEffects,...ar(c)});var bc=class extends as{_parse(a){return this._getType(a)===ab.undefined?al(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}};bc.create=(a,b)=>new bc({innerType:a,typeName:k.ZodOptional,...ar(b)});var bd=class extends as{_parse(a){return this._getType(a)===ab.null?al(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}};bd.create=(a,b)=>new bd({innerType:a,typeName:k.ZodNullable,...ar(b)});var be=class extends as{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===ab.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}};be.create=(a,b)=>new be({innerType:a,typeName:k.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...ar(b)});var bf=class extends as{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return am(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ae(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new ae(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}};bf.create=(a,b)=>new bf({innerType:a,typeName:k.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...ar(b)});var bg=class extends as{_parse(a){if(this._getType(a)!==ab.nan){let b=this._getOrReturnCtx(a);return ah(b,{code:ad.invalid_type,expected:ab.nan,received:b.parsedType}),aj}return{status:"valid",value:a.data}}};bg.create=a=>new bg({typeName:k.ZodNaN,...ar(a)}),Symbol("zod_brand");var bh=class extends as{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}},bi=class a extends as{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?aj:"dirty"===a.status?(b.dirty(),ak(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?aj:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(b,c){return new a({in:b,out:c,typeName:k.ZodPipeline})}},bj=class extends as{_parse(a){let b=this._def.innerType._parse(a),c=a=>("valid"===a.status&&(a.value=Object.freeze(a.value)),a);return am(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}};bj.create=(a,b)=>new bj({innerType:a,typeName:k.ZodReadonly,...ar(b)}),aX.lazycreate,function(a){a.ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline",a.ZodReadonly="ZodReadonly"}(k||(k={})),aK.create,aL.create,bg.create,aM.create,aN.create,aO.create,aP.create,aQ.create,aR.create,aS.create,aT.create,aU.create,aV.create,aW.create,aX.create,aX.strictCreate,aY.create,a$.create,a_.create,a0.create,a1.create,a2.create,a3.create,a4.create,a5.create,a6.create,a8.create,a9.create,ba.create,bb.create,bc.create,bd.create,bb.createWithPreprocess,bi.create;var bk={};function bl(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function bm(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof aX&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof as&&b.push({name:a,in:"query",schema:{type:bl(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function bn(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function bo(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!c.metadata?.SERVER_ONLY&&("GET"===c.method&&(bk[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bm(c),responses:bn(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof aX||a.body instanceof bc)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof as&&(c[a]={type:bl(b),description:b.description},b instanceof bc||d.push(a))}),{required:!(a.body instanceof bc)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);bk[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bm(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:bn(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:bk}}function bp(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}Object.freeze({status:"aborted"}),Symbol("zod_brand");class bq extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let br={};function bs(a){return a&&Object.assign(br,a),br}let bt=/^[cC][^\s-]{8,}$/,bu=/^[0-9a-z]+$/,bv=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,bw=/^[0-9a-vA-V]{20}$/,bx=/^[A-Za-z0-9]{27}$/,by=/^[a-zA-Z0-9_-]{21}$/,bz=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,bA=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,bB=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,bC=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,bD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,bE=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,bF=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,bG=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bH=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,bI=/^[A-Za-z0-9_-]*$/,bJ=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,bK=/^\+(?:[0-9]){6,14}[0-9]$/,bL="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",bM=RegExp(`^${bL}$`);function bN(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}let bO=/^\d+$/,bP=/^-?\d+(?:\.\d+)?/i,bQ=/true|false/i,bR=/^[^A-Z]*$/,bS=/^[^a-z]*$/;function bT(a,b){return"bigint"==typeof b?b.toString():b}function bU(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function bV(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function bW(a,b,c){Object.defineProperty(a,b,{get(){{let d=c();return a[b]=d,d}},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function bX(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function bY(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function bZ(a){return JSON.stringify(a)}let b$="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function b_(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let b0=bU(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function b1(a){if(!1===b_(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==b_(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}let b2=new Set(["string","number","symbol"]);function b3(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b4(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function b5(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}let b6={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function b7(a,b=0){for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function b8(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function b9(a){return"string"==typeof a?a:a?.message}function ca(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=b9(a.inst?._zod.def?.error?.(a))??b9(b?.error?.(a))??b9(c.customError?.(a))??b9(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function cb(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function cc(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}let cd=bp("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),ce={number:"number",bigint:"bigint",object:"date"},cf=bp("$ZodCheckLessThan",(a,b)=>{cd.init(a,b);let c=ce[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),cg=bp("$ZodCheckGreaterThan",(a,b)=>{cd.init(a,b);let c=ce[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),ch=bp("$ZodCheckMultipleOf",(a,b)=>{cd.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),ci=bp("$ZodCheckNumberFormat",(a,b)=>{cd.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=b6[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=bO)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),cj=bp("$ZodCheckMaxLength",(a,b)=>{var c;cd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=cb(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),ck=bp("$ZodCheckMinLength",(a,b)=>{var c;cd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=cb(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),cl=bp("$ZodCheckLengthEquals",(a,b)=>{var c;cd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=cb(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),cm=bp("$ZodCheckStringFormat",(a,b)=>{var c,d;cd.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),cn=bp("$ZodCheckRegex",(a,b)=>{cm.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),co=bp("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=bR),cm.init(a,b)}),cp=bp("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=bS),cm.init(a,b)}),cq=bp("$ZodCheckIncludes",(a,b)=>{cd.init(a,b);let c=b3(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),cr=bp("$ZodCheckStartsWith",(a,b)=>{cd.init(a,b);let c=RegExp(`^${b3(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),cs=bp("$ZodCheckEndsWith",(a,b)=>{cd.init(a,b);let c=RegExp(`.*${b3(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),ct=bp("$ZodCheckOverwrite",(a,b)=>{cd.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});class cu{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}let cv=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,bT,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},cw=bp("$ZodError",cv),cx=bp("$ZodError",cv,{Parent:Error}),cy=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new bq;return f.issues.length?{success:!1,error:new(a??cw)(f.issues.map(a=>ca(a,e,bs())))}:{success:!0,data:f.value}},cz=cy(cx),cA=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>ca(a,e,bs())))}:{success:!0,data:f.value}},cB=cA(cx),cC={major:4,minor:0,patch:10},cD=bp("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=cC;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=b7(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new bq;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=b7(a,b)))});else{if(a.issues.length===b)continue;e||(e=b7(a,b))}}return d?d.then(()=>a):a};a._zod.run=(c,e)=>{let f=a._zod.parse(c,e);if(f instanceof Promise){if(!1===e.async)throw new bq;return f.then(a=>b(a,d,e))}return b(f,d,e)}}a["~standard"]={validate:b=>{try{let c=cz(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return cB(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),cE=bp("$ZodString",(a,b)=>{cD.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??(a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)})(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),cF=bp("$ZodStringFormat",(a,b)=>{cm.init(a,b),cE.init(a,b)}),cG=bp("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=bA),cF.init(a,b)}),cH=bp("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=bB(a))}else b.pattern??(b.pattern=bB());cF.init(a,b)}),cI=bp("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=bC),cF.init(a,b)}),cJ=bp("$ZodURL",(a,b)=>{cF.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:bJ.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),cK=bp("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),cF.init(a,b)}),cL=bp("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=by),cF.init(a,b)}),cM=bp("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=bt),cF.init(a,b)}),cN=bp("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=bu),cF.init(a,b)}),cO=bp("$ZodULID",(a,b)=>{b.pattern??(b.pattern=bv),cF.init(a,b)}),cP=bp("$ZodXID",(a,b)=>{b.pattern??(b.pattern=bw),cF.init(a,b)}),cQ=bp("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=bx),cF.init(a,b)}),cR=bp("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=function(a){let b=bN({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-]\\d{2}:\\d{2})");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${bL}T(?:${d})$`)}(b)),cF.init(a,b)}),cS=bp("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=bM),cF.init(a,b)}),cT=bp("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=RegExp(`^${bN(b)}$`)),cF.init(a,b)}),cU=bp("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=bz),cF.init(a,b)}),cV=bp("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=bD),cF.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),cW=bp("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=bE),cF.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),cX=bp("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=bF),cF.init(a,b)}),cY=bp("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=bG),cF.init(a,b),a._zod.check=c=>{let[d,e]=c.value.split("/");try{if(!e)throw Error();let a=Number(e);if(`${a}`!==e||a<0||a>128)throw Error();new URL(`http://[${d}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function cZ(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let c$=bp("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=bH),cF.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{cZ(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),c_=bp("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=bI),cF.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{!function(a){if(!bI.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return cZ(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),c0=bp("$ZodE164",(a,b)=>{b.pattern??(b.pattern=bK),cF.init(a,b)}),c1=bp("$ZodJWT",(a,b)=>{cF.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),c2=bp("$ZodNumber",(a,b)=>{cD.init(a,b),a._zod.pattern=a._zod.bag.pattern??bP,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),c3=bp("$ZodNumber",(a,b)=>{ci.init(a,b),c2.init(a,b)}),c4=bp("$ZodBoolean",(a,b)=>{cD.init(a,b),a._zod.pattern=bQ,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),c5=bp("$ZodAny",(a,b)=>{cD.init(a,b),a._zod.parse=a=>a}),c6=bp("$ZodUnknown",(a,b)=>{cD.init(a,b),a._zod.parse=a=>a}),c7=bp("$ZodNever",(a,b)=>{cD.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),c8=bp("$ZodDate",(a,b)=>{cD.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function c9(a,b,c){a.issues.length&&b.issues.push(...b8(c,a.issues)),b.value[c]=a.value}let da=bp("$ZodArray",(a,b)=>{cD.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>c9(b,c,a))):c9(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function db(a,b,c,d){a.issues.length&&b.issues.push(...b8(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}let dc=bp("$ZodObject",(a,b)=>{let c,d;cD.init(a,b);let e=bU(()=>{let a=Object.keys(b.shape);for(let c of a)if(!(b.shape[c]instanceof cD))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=function(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});bW(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=!br.jitless,g=f&&b0.value,h=b.catchall;a._zod.parse=(i,j)=>{d??(d=e.value);let k=i.value;if(!b_(k))return i.issues.push({expected:"object",code:"invalid_type",input:k,inst:a}),i;let l=[];if(f&&g&&j?.async===!1&&!0!==j.jitless)c||(c=(a=>{let b=new cu(["shape","payload","ctx"]),c=e.value,d=a=>{let b=bZ(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let f=Object.create(null),g=0;for(let a of c.keys)f[a]=`key_${g++}`;for(let a of(b.write("const newResult = {}"),c.keys)){let c=f[a],e=bZ(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${e}, ...iss.path] : [${e}]
          })));
        }
        
        if (${c}.value === undefined) {
          if (${e} in input) {
            newResult[${e}] = undefined;
          }
        } else {
          newResult[${e}] = ${c}.value;
        }
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,j);else{i.value={};let a=d.shape;for(let b of d.keys){let c=a[b]._zod.run({value:k[b],issues:[]},j);c instanceof Promise?l.push(c.then(a=>db(a,i,b,k))):db(c,i,b,k)}}if(!h)return l.length?Promise.all(l).then(()=>i):i;let m=[],n=d.keySet,o=h._zod,p=o.def.type;for(let a of Object.keys(k)){if(n.has(a))continue;if("never"===p){m.push(a);continue}let b=o.run({value:k[a],issues:[]},j);b instanceof Promise?l.push(b.then(b=>db(b,i,a,k))):db(b,i,a,k)}return(m.length&&i.issues.push({code:"unrecognized_keys",keys:m,input:k,inst:a}),l.length)?Promise.all(l).then(()=>i):i}});function dd(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let e=a.filter(a=>!b7(a));return 1===e.length?(b.value=e[0].value,e[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>ca(a,d,bs())))}),b)}let de=bp("$ZodUnion",(a,b)=>{cD.init(a,b),bW(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),bW(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),bW(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),bW(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>bV(a.source)).join("|")})$`)}}),a._zod.parse=(c,d)=>{let e=!1,f=[];for(let a of b.options){let b=a._zod.run({value:c.value,issues:[]},d);if(b instanceof Promise)f.push(b),e=!0;else{if(0===b.issues.length)return b;f.push(b)}}return e?Promise.all(f).then(b=>dd(b,c,a,d)):dd(f,c,a,d)}}),df=bp("$ZodIntersection",(a,b)=>{cD.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>dg(a,b,c)):dg(a,e,f)}});function dg(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),b7(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(b1(b)&&b1(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let dh=bp("$ZodRecord",(a,b)=>{cD.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!b1(e))return c.issues.push({expected:"record",code:"invalid_type",input:e,inst:a}),c;let f=[];if(b.keyType._zod.values){let g,h=b.keyType._zod.values;for(let a of(c.value={},h))if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){let g=b.valueType._zod.run({value:e[a],issues:[]},d);g instanceof Promise?f.push(g.then(b=>{b.issues.length&&c.issues.push(...b8(a,b.issues)),c.value[a]=b.value})):(g.issues.length&&c.issues.push(...b8(a,g.issues)),c.value[a]=g.value)}for(let a in e)h.has(a)||(g=g??[]).push(a);g&&g.length>0&&c.issues.push({code:"unrecognized_keys",input:e,inst:a,keys:g})}else for(let g of(c.value={},Reflect.ownKeys(e))){if("__proto__"===g)continue;let h=b.keyType._zod.run({value:g,issues:[]},d);if(h instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(h.issues.length){c.issues.push({origin:"record",code:"invalid_key",issues:h.issues.map(a=>ca(a,d,bs())),input:g,path:[g],inst:a}),c.value[h.value]=h.value;continue}let i=b.valueType._zod.run({value:e[g],issues:[]},d);i instanceof Promise?f.push(i.then(a=>{a.issues.length&&c.issues.push(...b8(g,a.issues)),c.value[h.value]=a.value})):(i.issues.length&&c.issues.push(...b8(g,i.issues)),c.value[h.value]=i.value)}return f.length?Promise.all(f).then(()=>c):c}}),di=bp("$ZodEnum",(a,b)=>{cD.init(a,b);let c=function(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>b2.has(typeof a)).map(a=>"string"==typeof a?b3(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),dj=bp("$ZodTransform",(a,b)=>{cD.init(a,b),a._zod.parse=(a,c)=>{let d=b.transform(a.value,a);if(c.async)return(d instanceof Promise?d:Promise.resolve(d)).then(b=>(a.value=b,a));if(d instanceof Promise)throw new bq;return a.value=d,a}}),dk=bp("$ZodOptional",(a,b)=>{cD.init(a,b),a._zod.optin="optional",a._zod.optout="optional",bW(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),bW(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${bV(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>"optional"===b.innerType._zod.optin?b.innerType._zod.run(a,c):void 0===a.value?a:b.innerType._zod.run(a,c)}),dl=bp("$ZodNullable",(a,b)=>{cD.init(a,b),bW(a._zod,"optin",()=>b.innerType._zod.optin),bW(a._zod,"optout",()=>b.innerType._zod.optout),bW(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${bV(a.source)}|null)$`):void 0}),bW(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),dm=bp("$ZodDefault",(a,b)=>{cD.init(a,b),a._zod.optin="optional",bW(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>dn(a,b)):dn(d,b)}});function dn(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let dp=bp("$ZodPrefault",(a,b)=>{cD.init(a,b),a._zod.optin="optional",bW(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),dq=bp("$ZodNonOptional",(a,b)=>{cD.init(a,b),bW(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>dr(b,a)):dr(e,a)}});function dr(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let ds=bp("$ZodCatch",(a,b)=>{cD.init(a,b),bW(a._zod,"optin",()=>b.innerType._zod.optin),bW(a._zod,"optout",()=>b.innerType._zod.optout),bW(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>ca(a,c,bs()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>ca(a,c,bs()))},input:a.value}),a.issues=[]),a)}}),dt=bp("$ZodPipe",(a,b)=>{cD.init(a,b),bW(a._zod,"values",()=>b.in._zod.values),bW(a._zod,"optin",()=>b.in._zod.optin),bW(a._zod,"optout",()=>b.out._zod.optout),bW(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>du(a,b,c)):du(d,b,c)}});function du(a,b,c){return a.issues.length?a:b.out._zod.run({value:a.value,issues:a.issues},c)}let dv=bp("$ZodReadonly",(a,b)=>{cD.init(a,b),bW(a._zod,"propValues",()=>b.innerType._zod.propValues),bW(a._zod,"values",()=>b.innerType._zod.values),bW(a._zod,"optin",()=>b.innerType._zod.optin),bW(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(dw):dw(d)}});function dw(a){return a.value=Object.freeze(a.value),a}let dx=bp("$ZodCustom",(a,b)=>{cd.init(a,b),cD.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>dy(b,c,d,a));dy(e,c,d,a)}});function dy(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(cc(a))}}Symbol("ZodOutput"),Symbol("ZodInput");class dz{constructor(){this._map=new Map,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}let dA=new dz;function dB(a,b){return new a({type:"string",format:"email",check:"string_format",abort:!1,...b5(b)})}function dC(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...b5(b)})}function dD(a,b){return new cf({check:"less_than",...b5(b),value:a,inclusive:!1})}function dE(a,b){return new cf({check:"less_than",...b5(b),value:a,inclusive:!0})}function dF(a,b){return new cg({check:"greater_than",...b5(b),value:a,inclusive:!1})}function dG(a,b){return new cg({check:"greater_than",...b5(b),value:a,inclusive:!0})}function dH(a,b){return new ch({check:"multiple_of",...b5(b),value:a})}function dI(a,b){return new cj({check:"max_length",...b5(b),maximum:a})}function dJ(a,b){return new ck({check:"min_length",...b5(b),minimum:a})}function dK(a,b){return new cl({check:"length_equals",...b5(b),length:a})}function dL(a){return new ct({check:"overwrite",tx:a})}let dM=bp("ZodISODateTime",(a,b)=>{cR.init(a,b),d$.init(a,b)}),dN=bp("ZodISODate",(a,b)=>{cS.init(a,b),d$.init(a,b)}),dO=bp("ZodISOTime",(a,b)=>{cT.init(a,b),d$.init(a,b)}),dP=bp("ZodISODuration",(a,b)=>{cU.init(a,b),d$.init(a,b)}),dQ=(a,b)=>{cw.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,bT,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,bT,2)}},isEmpty:{get:()=>0===a.issues.length}})};bp("ZodError",dQ);let dR=bp("ZodError",dQ,{Parent:Error}),dS=(a,b,c,d)=>{let e=c?Object.assign(c,{async:!1}):{async:!1},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise)throw new bq;if(f.issues.length){let a=new(d?.Err??dR)(f.issues.map(a=>ca(a,e,bs())));throw b$(a,d?.callee),a}return f.value},dT=async(a,b,c,d)=>{let e=c?Object.assign(c,{async:!0}):{async:!0},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise&&(f=await f),f.issues.length){let a=new(d?.Err??dR)(f.issues.map(a=>ca(a,e,bs())));throw b$(a,d?.callee),a}return f.value},dU=cy(dR),dV=cA(dR),dW=bp("ZodType",(a,b)=>(cD.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>b4(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>dS(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>dU(a,b,c),a.parseAsync=async(b,c)=>dT(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>dV(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(function(a,b={}){return new eR({type:"custom",check:"custom",fn:a,...b5(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a){let b=new cd({check:"custom"});return b._zod.check=a,b}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(cc(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(cc(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(dL(b)),a.optional=()=>eH(a),a.nullable=()=>eJ(a),a.nullish=()=>eH(eJ(a)),a.nonoptional=b=>new eM({type:"nonoptional",innerType:a,...b5(b)}),a.array=()=>ew(a),a.or=b=>new ez({type:"union",options:[a,b],...b5(void 0)}),a.and=b=>new eA({type:"intersection",left:a,right:b}),a.transform=b=>eP(a,new eF({type:"transform",transform:b})),a.default=b=>(function(a,b){return new eK({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.prefault=b=>(function(a,b){return new eL({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.catch=b=>(function(a,b){return new eN({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>eP(a,b),a.readonly=()=>new eQ({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return dA.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>dA.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return dA.get(a);let c=a.clone();return dA.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),dX=bp("_ZodString",(a,b)=>{cE.init(a,b),dW.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(function(a,b){return new cn({check:"string_format",format:"regex",...b5(b),pattern:a})}(...b)),a.includes=(...b)=>a.check(function(a,b){return new cq({check:"string_format",format:"includes",...b5(b),includes:a})}(...b)),a.startsWith=(...b)=>a.check(function(a,b){return new cr({check:"string_format",format:"starts_with",...b5(b),prefix:a})}(...b)),a.endsWith=(...b)=>a.check(function(a,b){return new cs({check:"string_format",format:"ends_with",...b5(b),suffix:a})}(...b)),a.min=(...b)=>a.check(dJ(...b)),a.max=(...b)=>a.check(dI(...b)),a.length=(...b)=>a.check(dK(...b)),a.nonempty=(...b)=>a.check(dJ(1,...b)),a.lowercase=b=>a.check(new co({check:"string_format",format:"lowercase",...b5(b)})),a.uppercase=b=>a.check(new cp({check:"string_format",format:"uppercase",...b5(b)})),a.trim=()=>a.check(dL(a=>a.trim())),a.normalize=(...b)=>a.check(function(a){return dL(b=>b.normalize(a))}(...b)),a.toLowerCase=()=>a.check(dL(a=>a.toLowerCase())),a.toUpperCase=()=>a.check(dL(a=>a.toUpperCase()))}),dY=bp("ZodString",(a,b)=>{cE.init(a,b),dX.init(a,b),a.email=b=>a.check(dB(d_,b)),a.url=b=>a.check(new d2({type:"string",format:"url",check:"string_format",abort:!1,...b5(b)})),a.jwt=b=>a.check(new eh({type:"string",format:"jwt",check:"string_format",abort:!1,...b5(b)})),a.emoji=b=>a.check(new d3({type:"string",format:"emoji",check:"string_format",abort:!1,...b5(b)})),a.guid=b=>a.check(dC(d0,b)),a.uuid=b=>a.check(new d1({type:"string",format:"uuid",check:"string_format",abort:!1,...b5(b)})),a.uuidv4=b=>a.check(new d1({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...b5(b)})),a.uuidv6=b=>a.check(new d1({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...b5(b)})),a.uuidv7=b=>a.check(new d1({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...b5(b)})),a.nanoid=b=>a.check(new d4({type:"string",format:"nanoid",check:"string_format",abort:!1,...b5(b)})),a.guid=b=>a.check(dC(d0,b)),a.cuid=b=>a.check(new d5({type:"string",format:"cuid",check:"string_format",abort:!1,...b5(b)})),a.cuid2=b=>a.check(new d6({type:"string",format:"cuid2",check:"string_format",abort:!1,...b5(b)})),a.ulid=b=>a.check(new d7({type:"string",format:"ulid",check:"string_format",abort:!1,...b5(b)})),a.base64=b=>a.check(new ee({type:"string",format:"base64",check:"string_format",abort:!1,...b5(b)})),a.base64url=b=>a.check(new ef({type:"string",format:"base64url",check:"string_format",abort:!1,...b5(b)})),a.xid=b=>a.check(new d8({type:"string",format:"xid",check:"string_format",abort:!1,...b5(b)})),a.ksuid=b=>a.check(new d9({type:"string",format:"ksuid",check:"string_format",abort:!1,...b5(b)})),a.ipv4=b=>a.check(new ea({type:"string",format:"ipv4",check:"string_format",abort:!1,...b5(b)})),a.ipv6=b=>a.check(new eb({type:"string",format:"ipv6",check:"string_format",abort:!1,...b5(b)})),a.cidrv4=b=>a.check(new ec({type:"string",format:"cidrv4",check:"string_format",abort:!1,...b5(b)})),a.cidrv6=b=>a.check(new ed({type:"string",format:"cidrv6",check:"string_format",abort:!1,...b5(b)})),a.e164=b=>a.check(new eg({type:"string",format:"e164",check:"string_format",abort:!1,...b5(b)})),a.datetime=b=>a.check(new dM({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...b5(b)})),a.date=b=>a.check(new dN({type:"string",format:"date",check:"string_format",...b5(b)})),a.time=b=>a.check(new dO({type:"string",format:"time",check:"string_format",precision:null,...b5(b)})),a.duration=b=>a.check(new dP({type:"string",format:"duration",check:"string_format",...b5(b)}))});function dZ(a){return new dY({type:"string",...b5(a)})}let d$=bp("ZodStringFormat",(a,b)=>{cF.init(a,b),dX.init(a,b)}),d_=bp("ZodEmail",(a,b)=>{cI.init(a,b),d$.init(a,b)}),d0=bp("ZodGUID",(a,b)=>{cG.init(a,b),d$.init(a,b)}),d1=bp("ZodUUID",(a,b)=>{cH.init(a,b),d$.init(a,b)}),d2=bp("ZodURL",(a,b)=>{cJ.init(a,b),d$.init(a,b)}),d3=bp("ZodEmoji",(a,b)=>{cK.init(a,b),d$.init(a,b)}),d4=bp("ZodNanoID",(a,b)=>{cL.init(a,b),d$.init(a,b)}),d5=bp("ZodCUID",(a,b)=>{cM.init(a,b),d$.init(a,b)}),d6=bp("ZodCUID2",(a,b)=>{cN.init(a,b),d$.init(a,b)}),d7=bp("ZodULID",(a,b)=>{cO.init(a,b),d$.init(a,b)}),d8=bp("ZodXID",(a,b)=>{cP.init(a,b),d$.init(a,b)}),d9=bp("ZodKSUID",(a,b)=>{cQ.init(a,b),d$.init(a,b)}),ea=bp("ZodIPv4",(a,b)=>{cV.init(a,b),d$.init(a,b)}),eb=bp("ZodIPv6",(a,b)=>{cW.init(a,b),d$.init(a,b)}),ec=bp("ZodCIDRv4",(a,b)=>{cX.init(a,b),d$.init(a,b)}),ed=bp("ZodCIDRv6",(a,b)=>{cY.init(a,b),d$.init(a,b)}),ee=bp("ZodBase64",(a,b)=>{c$.init(a,b),d$.init(a,b)}),ef=bp("ZodBase64URL",(a,b)=>{c_.init(a,b),d$.init(a,b)}),eg=bp("ZodE164",(a,b)=>{c0.init(a,b),d$.init(a,b)}),eh=bp("ZodJWT",(a,b)=>{c1.init(a,b),d$.init(a,b)}),ei=bp("ZodNumber",(a,b)=>{c2.init(a,b),dW.init(a,b),a.gt=(b,c)=>a.check(dF(b,c)),a.gte=(b,c)=>a.check(dG(b,c)),a.min=(b,c)=>a.check(dG(b,c)),a.lt=(b,c)=>a.check(dD(b,c)),a.lte=(b,c)=>a.check(dE(b,c)),a.max=(b,c)=>a.check(dE(b,c)),a.int=b=>a.check(el(b)),a.safe=b=>a.check(el(b)),a.positive=b=>a.check(dF(0,b)),a.nonnegative=b=>a.check(dG(0,b)),a.negative=b=>a.check(dD(0,b)),a.nonpositive=b=>a.check(dE(0,b)),a.multipleOf=(b,c)=>a.check(dH(b,c)),a.step=(b,c)=>a.check(dH(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function ej(a){return new ei({type:"number",checks:[],...b5(a)})}let ek=bp("ZodNumberFormat",(a,b)=>{c3.init(a,b),ei.init(a,b)});function el(a){return new ek({type:"number",check:"number_format",abort:!1,format:"safeint",...b5(a)})}let em=bp("ZodBoolean",(a,b)=>{c4.init(a,b),dW.init(a,b)});function en(a){return new em({type:"boolean",...b5(a)})}let eo=bp("ZodAny",(a,b)=>{c5.init(a,b),dW.init(a,b)});function ep(){return new eo({type:"any"})}let eq=bp("ZodUnknown",(a,b)=>{c6.init(a,b),dW.init(a,b)});function er(){return new eq({type:"unknown"})}let es=bp("ZodNever",(a,b)=>{c7.init(a,b),dW.init(a,b)}),et=bp("ZodDate",(a,b)=>{c8.init(a,b),dW.init(a,b),a.min=(b,c)=>a.check(dG(b,c)),a.max=(b,c)=>a.check(dE(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function eu(a){return new et({type:"date",...b5(a)})}let ev=bp("ZodArray",(a,b)=>{da.init(a,b),dW.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(dJ(b,c)),a.nonempty=b=>a.check(dJ(1,b)),a.max=(b,c)=>a.check(dI(b,c)),a.length=(b,c)=>a.check(dK(b,c)),a.unwrap=()=>a.element});function ew(a,b){return new ev({type:"array",element:a,...b5(b)})}let ex=bp("ZodObject",(a,b)=>{dc.init(a,b),dW.init(a,b),bW(a,"shape",()=>b.shape),a.keyof=()=>eE(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:er()}),a.loose=()=>a.clone({...a._zod.def,catchall:er()}),a.strict=()=>a.clone({...a._zod.def,catchall:new es({type:"never",...b5(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>(function(a,b){if(!b1(b))throw Error("Invalid input to extend: expected a plain object");let c=bY(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return bX(this,"shape",c),c},checks:[]});return b4(a,c)})(a,b),a.merge=b=>(function(a,b){let c=bY(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return bX(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return b4(a,c)})(a,b),a.pick=b=>(function(a,b){let c=a._zod.def,d=bY(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return bX(this,"shape",a),a},checks:[]});return b4(a,d)})(a,b),a.omit=b=>(function(a,b){let c=a._zod.def,d=bY(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return bX(this,"shape",d),d},checks:[]});return b4(a,d)})(a,b),a.partial=(...b)=>(function(a,b,c){let d=bY(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return bX(this,"shape",e),e},checks:[]});return b4(b,d)})(eG,a,b[0]),a.required=(...b)=>(function(a,b,c){let d=bY(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return bX(this,"shape",e),e},checks:[]});return b4(b,d)})(eM,a,b[0])});function ey(a,b){return new ex({type:"object",get shape(){return bX(this,"shape",{...a}),this.shape},...b5(b)})}let ez=bp("ZodUnion",(a,b)=>{de.init(a,b),dW.init(a,b),a.options=b.options}),eA=bp("ZodIntersection",(a,b)=>{df.init(a,b),dW.init(a,b)}),eB=bp("ZodRecord",(a,b)=>{dh.init(a,b),dW.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function eC(a,b,c){return new eB({type:"record",keyType:a,valueType:b,...b5(c)})}let eD=bp("ZodEnum",(a,b)=>{di.init(a,b),dW.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new eD({...b,checks:[],...b5(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new eD({...b,checks:[],...b5(d),entries:e})}});function eE(a,b){return new eD({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...b5(b)})}let eF=bp("ZodTransform",(a,b)=>{dj.init(a,b),dW.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(cc(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(cc(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),eG=bp("ZodOptional",(a,b)=>{dk.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType});function eH(a){return new eG({type:"optional",innerType:a})}let eI=bp("ZodNullable",(a,b)=>{dl.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType});function eJ(a){return new eI({type:"nullable",innerType:a})}let eK=bp("ZodDefault",(a,b)=>{dm.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),eL=bp("ZodPrefault",(a,b)=>{dp.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType}),eM=bp("ZodNonOptional",(a,b)=>{dq.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType}),eN=bp("ZodCatch",(a,b)=>{ds.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),eO=bp("ZodPipe",(a,b)=>{dt.init(a,b),dW.init(a,b),a.in=b.in,a.out=b.out});function eP(a,b){return new eO({type:"pipe",in:a,out:b})}let eQ=bp("ZodReadonly",(a,b)=>{dv.init(a,b),dW.init(a,b),a.unwrap=()=>a._zod.def.innerType}),eR=bp("ZodCustom",(a,b)=>{dx.init(a,b),dW.init(a,b)});function eS(a){return new dY({type:"string",coerce:!0,...b5(a)})}function eT(a){return new em({type:"boolean",coerce:!0,...b5(a)})}let eU=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a));function eV(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function eW(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function eX(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}let eY={encode(a,b={}){let c=eV(!1);return eW("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=eV(a.includes("-")||a.includes("_"));return eX(a,b)}},eZ={encode(a,b={}){let c=eV(!0);return eW("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=eV(a.includes("-")||a.includes("_"));return eX(a,b)}};function e$(a,b){return{digest:async c=>{let d=new TextEncoder,e="string"==typeof c?d.encode(c):c,f=await E.digest(a,e);return"hex"===b?Array.from(new Uint8Array(f)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?eZ.encode(f,{padding:"base64urlnopad"!==b}):eY.encode(f):f}}}function e_(a){if(!Number.isSafeInteger(a)||a<0)throw Error(`positive integer expected, not ${a}`)}function e0(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function e1(a){return a instanceof Uint8Array||null!=a&&"object"==typeof a&&"Uint8Array"===a.constructor.name}function e2(a,...b){if(!e1(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error(`Uint8Array expected of length ${b}, not of length=${a.length}`)}function e3(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let e4=a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4));if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");let e5=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0")),e6={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function e7(a){return a>=e6._0&&a<=e6._9?a-e6._0:a>=e6._A&&a<=e6._F?a-(e6._A-10):a>=e6._a&&a<=e6._f?a-(e6._a-10):void 0}function e8(a){if("string"!=typeof a)throw Error(`string expected, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}function e9(a){if("string"==typeof a)a=e8(a);else if(e1(a))a=fb(a);else throw Error(`Uint8Array expected, got ${typeof a}`);return a}function fa(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function fb(a){return Uint8Array.from(a)}function fc(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let fd=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),fe=fd("expand 16-byte k"),ff=fd("expand 32-byte k"),fg=e4(fe),fh=e4(ff);function fi(a,b){return a<<b|a>>>32-b}function fj(a){return a.byteOffset%4==0}fh.slice();let fk=0x100000000-1,fl=new Uint32Array;function fm(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return e_(e),e_(g),e0(f),e0(c),(b,h,i,j,k=0)=>{e2(b),e2(h),e2(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),e2(j),e_(k),k<0||k>=fk)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=fb(b)),p=fh;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=fg,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);fj(h)||m.push(h=fb(h));let q=e4(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,e4(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return!function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=e4(j),l=fj(e)&&fj(f),m=l?e4(e):fl,n=l?e4(f):fl;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=fk)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,e4(h),i,j,k,g),fc(...m),j}}let fn=(a,b)=>255&a[b++]|(255&a[b++])<<8;class fo{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e2(a=e9(a),32);let b=fn(a,0),c=fn(a,2),d=fn(a,4),e=fn(a,6),f=fn(a,8),g=fn(a,10),h=fn(a,12),i=fn(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=fn(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=fn(a,b+0),q=fn(a,b+2),r=fn(a,b+4),s=fn(a,b+6),t=fn(a,b+8),u=fn(a,b+10),v=fn(a,b+12),w=fn(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;fc(c)}update(a){e3(this);let{buffer:b,blockLen:c}=this,d=(a=e9(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){fc(this.h,this.r,this.buffer,this.pad)}digestInto(a){e3(this);e2(a);let b=this.outputLen;if(a.length<b)throw Error(`digestInto() expects output buffer of length at least ${b}`);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let fp=function(a){let b=(b,c)=>a(c).update(e9(b)).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new fo(a));function fq(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=fi(H^(v=v+z|0),16))|0,v=v+(z=fi(z^D,12))|0,D=D+(H=fi(H^v,8))|0,z=fi(z^D,7),E=E+(I=fi(I^(w=w+A|0),16))|0,w=w+(A=fi(A^E,12))|0,E=E+(I=fi(I^w,8))|0,A=fi(A^E,7),F=F+(J=fi(J^(x=x+B|0),16))|0,x=x+(B=fi(B^F,12))|0,F=F+(J=fi(J^x,8))|0,B=fi(B^F,7),G=G+(K=fi(K^(y=y+C|0),16))|0,y=y+(C=fi(C^G,12))|0,G=G+(K=fi(K^y,8))|0,C=fi(C^G,7),F=F+(K=fi(K^(v=v+A|0),16))|0,v=v+(A=fi(A^F,12))|0,F=F+(K=fi(K^v,8))|0,A=fi(A^F,7),G=G+(H=fi(H^(w=w+B|0),16))|0,w=w+(B=fi(B^G,12))|0,G=G+(H=fi(H^w,8))|0,B=fi(B^G,7),D=D+(I=fi(I^(x=x+C|0),16))|0,x=x+(C=fi(C^D,12))|0,D=D+(I=fi(I^x,8))|0,C=fi(C^D,7),E=E+(J=fi(J^(y=y+z|0),16))|0,y=y+(z=fi(z^E,12))|0,E=E+(J=fi(J^y,8))|0,z=fi(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0}let fr=fm(fq,{counterRight:!1,counterLength:4,allowShortKeys:!1}),fs=fm(fq,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=fi(q^(e=e+i|0),16))|0,e=e+(i=fi(i^m,12))|0,m=m+(q=fi(q^e,8))|0,i=fi(i^m,7),n=n+(r=fi(r^(f=f+j|0),16))|0,f=f+(j=fi(j^n,12))|0,n=n+(r=fi(r^f,8))|0,j=fi(j^n,7),o=o+(s=fi(s^(g=g+k|0),16))|0,g=g+(k=fi(k^o,12))|0,o=o+(s=fi(s^g,8))|0,k=fi(k^o,7),p=p+(t=fi(t^(h=h+l|0),16))|0,h=h+(l=fi(l^p,12))|0,p=p+(t=fi(t^h,8))|0,l=fi(l^p,7),o=o+(t=fi(t^(e=e+j|0),16))|0,e=e+(j=fi(j^o,12))|0,o=o+(t=fi(t^e,8))|0,j=fi(j^o,7),p=p+(q=fi(q^(f=f+k|0),16))|0,f=f+(k=fi(k^p,12))|0,p=p+(q=fi(q^f,8))|0,k=fi(k^p,7),m=m+(r=fi(r^(g=g+l|0),16))|0,g=g+(l=fi(l^m,12))|0,m=m+(r=fi(r^g,8))|0,l=fi(l^m,7),n=n+(s=fi(s^(h=h+i|0),16))|0,h=h+(i=fi(i^n,12))|0,n=n+(s=fi(s^h,8))|0,i=fi(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),ft=new Uint8Array(16),fu=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(ft.subarray(c))},fv=new Uint8Array(32);function fw(a,b,c,d,e){let f=a(b,c,fv),g=fp.create(f);e&&fu(g,e),fu(g,d);let h=new Uint8Array(16),i=new DataView(h.buffer,h.byteOffset,h.byteLength);fa(i,0,BigInt(e?e.length:0),!0),fa(i,8,BigInt(d.length),!0),g.update(h);let j=g.digest();return fc(f,h),j}let fx=a=>(b,c,d)=>(e2(b,32),e2(c),{encrypt(e,f){let g=e.length,h=g+16;f?e2(f,h):f=new Uint8Array(h),a(b,c,e,f,1);let i=fw(a,b,c,f.subarray(0,-16),d);return f.set(i,g),fc(i),f},decrypt(e,f){let g=e.length,h=g-16;if(g<16)throw Error("encrypted data must be at least 16 bytes");f?e2(f,h):f=new Uint8Array(h);let i=e.subarray(0,-16),j=e.subarray(-16),k=fw(a,b,c,i,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(j,k))throw Error("invalid tag");return a(b,c,i,f,1),fc(k),f}});fx(fr);let fy=((a,b)=>(Object.assign(b,a),b))({blockSize:64,nonceLength:24,tagLength:16},fx(fs)),fz=D&&"object"==typeof D&&"webcrypto"in D?C.webcrypto:void 0;function fA(){if(fz&&"object"==typeof fz.subtle&&null!=fz.subtle)return fz.subtle;throw Error("crypto.subtle must be defined")}function fB(a){return e_(a.nonceLength),(b,...c)=>({encrypt(d,...e){let{nonceLength:f}=a,g=function(a=32){if(fz&&"function"==typeof fz.getRandomValues)return fz.getRandomValues(new Uint8Array(a));throw Error("crypto.getRandomValues must be defined")}(f),h=a(b,g,...c).encrypt(d,...e),i=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];e2(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(g,h);return h.fill(0),i},decrypt(d,...e){let{nonceLength:f}=a,g=d.subarray(0,f),h=d.subarray(f);return a(b,g,...c).decrypt(h,...e)}})}let fC={async encrypt(a,b,c,d){let e=fA(),f=await e.importKey("raw",a,b,!0,["encrypt"]);return new Uint8Array(await e.encrypt(c,f,d))},async decrypt(a,b,c,d){let e=fA(),f=await e.importKey("raw",a,b,!0,["decrypt"]);return new Uint8Array(await e.decrypt(c,f,d))}},fD={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function fE(a){return(b,c,d)=>{e2(b),e2(c);let e={name:a,length:8*b.length},f=function(a,b,c){if(a===fD.CBC)return{name:fD.CBC,iv:b};if(a===fD.CTR)return{name:fD.CTR,counter:b,length:64};if(a===fD.GCM)if(c)return{name:fD.GCM,iv:b,additionalData:c};else return{name:fD.GCM,iv:b};throw Error("unknown aes block mode")}(a,c,d);return{encrypt:a=>(e2(a),fC.encrypt(b,e,f,a)),decrypt:a=>(e2(a),fC.decrypt(b,e,f,a))}}}fE(fD.CBC),fE(fD.CTR),fE(fD.GCM);let fF=require("node:buffer"),fG=new TextEncoder,fH=new TextDecoder;function fI(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}let fJ=a=>fF.Buffer.from(a).toString("base64url"),fK=a=>new Uint8Array(fF.Buffer.from(function(a){let b=a;return b instanceof Uint8Array&&(b=fH.decode(b)),b}(a),"base64url")),fL=require("node:util");class fM extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class fN extends fM{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class fO extends fM{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class fP extends fM{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class fQ extends fM{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class fR extends fM{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class fS extends fM{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class fT extends fM{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class fU extends fM{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class fV extends fM{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class fW extends fM{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class fX extends fM{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}function fY(a){switch(a){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new fQ(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}let fZ=C.webcrypto,f$=a=>fL.types.isCryptoKey(a),f_=a=>fL.types.isKeyObject(a);function f0(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let f1=(a,...b)=>f0("Key must be ",a,...b);function f2(a,b,...c){return f0(`Key for the ${a} algorithm must be `,b,...c)}let f3=a=>f_(a)||f$(a),f4=["KeyObject"];function f5(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}function f6(a){return f5(a)&&"string"==typeof a.kty}(globalThis.CryptoKey||fZ?.CryptoKey)&&f4.push("CryptoKey"),new WeakMap;let f7=(a,b)=>{let c;try{c=a instanceof C.KeyObject?a.asymmetricKeyDetails?.modulusLength:Buffer.from(a.n,"base64url").byteLength<<3}catch{}if("number"!=typeof c||c<2048)throw TypeError(`${b} requires key modulusLength to be 2048 bits or larger`)},f8=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function f9(a,b){let c,d,e,f;if(b instanceof C.KeyObject)c=b.asymmetricKeyType,d=b.asymmetricKeyDetails;else switch(e=!0,b.kty){case"RSA":c="rsa";break;case"EC":c="ec";break;case"OKP":if("Ed25519"===b.crv){c="ed25519";break}if("Ed448"===b.crv){c="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(a){case"Ed25519":if("ed25519"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(c))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");f7(b,a);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===c){let{hashAlgorithm:b,mgf1HashAlgorithm:c,saltLength:e}=d,f=parseInt(a.slice(-3),10);if(void 0!==b&&(b!==`sha${f}`||c!==b))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${a}`);if(void 0!==e&&e>f>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${a}`)}else if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");f7(b,a),f={padding:C.constants.RSA_PKCS1_PSS_PADDING,saltLength:C.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let d=((a,b)=>{let c;if(f$(a))c=C.KeyObject.from(a);else if(f_(a))c=a;else if(f6(a))return a.crv;else throw TypeError(f1(a,...f4));if("secret"===c.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(c.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${c.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${c.asymmetricKeyType.slice(1)}`;case"ec":{let a=c.asymmetricKeyDetails.namedCurve;if(b)return a;switch(a){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new fQ("Unsupported key curve for this operation")}}default:throw TypeError("Invalid asymmetric key type for this operation")}})(b),e=f8.get(a);if(d!==e)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${e}, got ${d}`);f={dsaEncoding:"ieee-p1363"};break}default:throw new fQ(`alg ${a} is not supported either by JOSE or your javascript runtime`)}return e?{format:"jwk",key:b,...f}:f?{...f,key:b}:b}function ga(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function gb(a,b){return a.name===b}function gc(a){return parseInt(a.name.slice(4),10)}function gd(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(f1(b,...f4));return(0,C.createSecretKey)(b)}if(b instanceof C.KeyObject)return b;if(f$(b))return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!gb(a.algorithm,"HMAC"))throw ga("HMAC");let c=parseInt(b.slice(2),10);if(gc(a.algorithm.hash)!==c)throw ga(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!gb(a.algorithm,"RSASSA-PKCS1-v1_5"))throw ga("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(gc(a.algorithm.hash)!==c)throw ga(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!gb(a.algorithm,"RSA-PSS"))throw ga("RSA-PSS");let c=parseInt(b.slice(2),10);if(gc(a.algorithm.hash)!==c)throw ga(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw ga("Ed25519 or Ed448");break;case"Ed25519":if(!gb(a.algorithm,"Ed25519"))throw ga("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!gb(a.algorithm,"ECDSA"))throw ga("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw ga(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c.length&&!c.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(c.length>2){let b=c.pop();a+=`one of ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of ${c[0]} or ${c[1]}.`:a+=`${c[0]}.`;throw TypeError(a)}}(b,a,c),C.KeyObject.from(b);if(f6(b))return a.startsWith("HS")?(0,C.createSecretKey)(Buffer.from(b.k,"base64url")):b;throw TypeError(f1(b,...f4,"Uint8Array","JSON Web Key"))}let ge=(0,fL.promisify)(C.sign),gf=async(a,b,c)=>{let d=gd(a,b,"sign");if(a.startsWith("HS")){let b=C.createHmac(function(a){switch(a){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new fQ(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}(a),d);return b.update(c),b.digest()}return ge(fY(a),c,f9(a,d))},gg=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0},gh=a=>a?.[Symbol.toStringTag],gi=(a,b,c)=>{if(void 0!==b.use&&"sig"!==b.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==b.key_ops&&b.key_ops.includes?.(c)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${c}`);if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, when present its alg must be ${a}`);return!0};function gj(a,b,c,d){b.startsWith("HS")||"dir"===b||b.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(b)?((a,b,c,d)=>{if(!(b instanceof Uint8Array)){if(d&&f6(b)){var e;if(f6(e=b)&&"oct"===e.kty&&"string"==typeof e.k&&gi(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!f3(b))throw TypeError(f2(a,b,...f4,"Uint8Array",d?"JSON Web Key":null));if("secret"!==b.type)throw TypeError(`${gh(b)} instances for symmetric algorithms must be of type "secret"`)}})(b,c,d,a):((a,b,c,d)=>{var e,f;if(d&&f6(b))switch(c){case"sign":if("oct"!==(e=b).kty&&"string"==typeof e.d&&gi(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==(f=b).kty&&void 0===f.d&&gi(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!f3(b))throw TypeError(f2(a,b,...f4,d?"JSON Web Key":null));if("secret"===b.type)throw TypeError(`${gh(b)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${gh(b)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${gh(b)} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${gh(b)} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${gh(b)} instances for asymmetric algorithm encryption must be of type "public"`)})(b,c,d,a)}gj.bind(void 0,!1);let gk=gj.bind(void 0,!0),gl=function(a,b,c,d,e){let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new fQ(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)};class gm{_payload;_protectedHeader;_unprotectedHeader;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=a}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}async sign(a,b){let c;if(!this._protectedHeader&&!this._unprotectedHeader)throw new fR("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!gg(this._protectedHeader,this._unprotectedHeader))throw new fR("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this._protectedHeader,...this._unprotectedHeader},e=gl(fR,new Map([["b64",!0]]),b?.crit,this._protectedHeader,d),f=!0;if(e.has("b64")&&"boolean"!=typeof(f=this._protectedHeader.b64))throw new fR('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:g}=d;if("string"!=typeof g||!g)throw new fR('JWS "alg" (Algorithm) Header Parameter missing or invalid');gk(g,a,"sign");let h=this._payload;f&&(h=fG.encode(fJ(h)));let i=fI(c=this._protectedHeader?fG.encode(fJ(JSON.stringify(this._protectedHeader))):fG.encode(""),fG.encode("."),h),j={signature:fJ(await gf(g,a,i)),payload:""};return f&&(j.payload=fH.decode(h)),this._unprotectedHeader&&(j.header=this._unprotectedHeader),this._protectedHeader&&(j.protected=fH.decode(c)),j}}class gn{_flattened;constructor(a){this._flattened=new gm(a)}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}async sign(a,b){let c=await this._flattened.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}let go=a=>Math.floor(a.getTime()/1e3),gp=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,gq=a=>{let b,c=gp.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b};function gr(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}class gs{_payload;constructor(a={}){if(!f5(a))throw TypeError("JWT Claims Set MUST be an object");this._payload=a}setIssuer(a){return this._payload={...this._payload,iss:a},this}setSubject(a){return this._payload={...this._payload,sub:a},this}setAudience(a){return this._payload={...this._payload,aud:a},this}setJti(a){return this._payload={...this._payload,jti:a},this}setNotBefore(a){return"number"==typeof a?this._payload={...this._payload,nbf:gr("setNotBefore",a)}:a instanceof Date?this._payload={...this._payload,nbf:gr("setNotBefore",go(a))}:this._payload={...this._payload,nbf:go(new Date)+gq(a)},this}setExpirationTime(a){return"number"==typeof a?this._payload={...this._payload,exp:gr("setExpirationTime",a)}:a instanceof Date?this._payload={...this._payload,exp:gr("setExpirationTime",go(a))}:this._payload={...this._payload,exp:go(new Date)+gq(a)},this}setIssuedAt(a){return void 0===a?this._payload={...this._payload,iat:go(new Date)}:a instanceof Date?this._payload={...this._payload,iat:gr("setIssuedAt",go(a))}:"string"==typeof a?this._payload={...this._payload,iat:gr("setIssuedAt",go(new Date)+gq(a))}:this._payload={...this._payload,iat:gr("setIssuedAt",a)},this}}class gt extends gs{_protectedHeader;setProtectedHeader(a){return this._protectedHeader=a,this}async sign(a,b){let c=new gn(fG.encode(JSON.stringify(this._payload)));if(c.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new fS("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}function gu(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function gv(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function gw(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");gu(a.outputLen),gu(a.blockLen)}function gx(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function gy(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function gz(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function gA(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function gB(a,b){return a<<32-b|a>>>b}function gC(a,b){return a<<b|a>>>32-b>>>0}let gD=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},gE="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,gF={_0:48,_9:57,A:65,F:70,a:97,f:102};function gG(a){return a>=gF._0&&a<=gF._9?a-gF._0:a>=gF.A&&a<=gF.F?a-(gF.A-10):a>=gF.a&&a<=gF.f?a-(gF.a-10):void 0}let gH=async()=>{};async function gI(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await gH(),d+=a)}}function gJ(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function gK(a){return"string"==typeof a&&(a=gJ(a)),gv(a),a}function gL(a){return"string"==typeof a&&(a=gJ(a)),gv(a),a}function gM(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options should be object or undefined");return Object.assign(a,b)}class gN{}class gO extends gN{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,gw(a);let c=gK(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),gz(e)}update(a){return gx(this),this.iHash.update(a),this}digestInto(a){gx(this),gv(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let gP=(a,b,c)=>new gO(a,b).update(c).digest();function gQ(a,b,c,d){var e;let f,{c:g,dkLen:h,DK:i,PRF:j,PRFSalt:k}=function(a,b,c,d){gw(a);let{c:e,dkLen:f,asyncTick:g}=gM({dkLen:32,asyncTick:10},d);if(gu(e),gu(f),gu(g),e<1)throw Error("iterations (c) should be >= 1");let h=gL(b),i=gL(c),j=new Uint8Array(f),k=gP.create(a,h),l=k._cloneInto().update(i);return{c:e,dkLen:f,asyncTick:g,DK:j,PRF:k,PRFSalt:l}}(a,b,c,d),l=new Uint8Array(4),m=gA(l),n=new Uint8Array(j.outputLen);for(let a=1,b=0;b<h;a++,b+=j.outputLen){let c=i.subarray(b,b+j.outputLen);m.setInt32(0,a,!1),(f=k._cloneInto(f)).update(l).digestInto(n),c.set(n.subarray(0,c.length));for(let a=1;a<g;a++){j._cloneInto(f).update(n).digestInto(n);for(let a=0;a<c.length;a++)c[a]^=n[a]}}return e=f,j.destroy(),k.destroy(),e&&e.destroy(),gz(n),i}gP.create=(a,b)=>new gO(a,b);class gR extends gN{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=gA(this.buffer)}update(a){gx(this),gv(a=gK(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=gA(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){gx(this);gv(a);let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,gz(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;!function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}(d,e-8,BigInt(8*this.length),f),this.process(d,0);let h=gA(a),i=this.outputLen;if(i%4)throw Error("_sha2: outputLen should be aligned to 32bit");let j=i/4,k=this.get();if(j>k.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<j;a++)h.setUint32(4*a,k[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let gS=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),gT=BigInt(0x100000000-1),gU=BigInt(32),gV=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),gW=new Uint32Array(64);class gX extends gR{constructor(a=32){super(64,a,8,!1),this.A=0|gS[0],this.B=0|gS[1],this.C=0|gS[2],this.D=0|gS[3],this.E=0|gS[4],this.F=0|gS[5],this.G=0|gS[6],this.H=0|gS[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)gW[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=gW[a-15],c=gW[a-2],d=gB(b,7)^gB(b,18)^b>>>3,e=gB(c,17)^gB(c,19)^c>>>10;gW[a]=e+gW[a-7]+d+gW[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(gB(g,6)^gB(g,11)^gB(g,25))+((k=g)&h^~k&i)+gV[a]+gW[a]|0,o=(gB(c,2)^gB(c,13)^gB(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){gz(gW)}destroy(){this.set(0,0,0,0,0,0,0,0),gz(this.buffer)}}!function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&gT),l:Number(a>>gU&gT)}:{h:0|Number(a>>gU&gT),l:0|Number(a&gT)}}(a[f],b);[d[f],e[f]]=[c,g]}}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a)));let gY=function(a){let b=b=>a().update(gK(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}(()=>new gX);function gZ(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],o=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v;for(let a=0;a<8;a+=2)A^=gC(w+I|0,7),E^=gC(A+w|0,9),I^=gC(E+A|0,13),w^=gC(I+E|0,18),F^=gC(B+x|0,7),J^=gC(F+B|0,9),x^=gC(J+F|0,13),B^=gC(x+J|0,18),K^=gC(G+C|0,7),y^=gC(K+G|0,9),C^=gC(y+K|0,13),G^=gC(C+y|0,18),z^=gC(L+H|0,7),D^=gC(z+L|0,9),H^=gC(D+z|0,13),L^=gC(H+D|0,18),x^=gC(w+z|0,7),y^=gC(x+w|0,9),z^=gC(y+x|0,13),w^=gC(z+y|0,18),C^=gC(B+A|0,7),D^=gC(C+B|0,9),A^=gC(D+C|0,13),B^=gC(A+D|0,18),H^=gC(G+F|0,7),E^=gC(H+G|0,9),F^=gC(E+H|0,13),G^=gC(F+E|0,18),I^=gC(L+K|0,7),J^=gC(I+L|0,9),K^=gC(J+I|0,13),L^=gC(K+J|0,18);e[f++]=g+w|0,e[f++]=h+x|0,e[f++]=i+y|0,e[f++]=j+z|0,e[f++]=k+A|0,e[f++]=l+B|0,e[f++]=m+C|0,e[f++]=n+D|0,e[f++]=o+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0}function g$(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)gZ(c,g,a,b,c,f),d>0&&(g+=16),gZ(c,f,a,b+=16,c,g)}async function g_(a,b,c){let{N:d,r:e,p:f,dkLen:g,blockSize32:h,V:i,B32:j,B:k,tmp:l,blockMixCb:m,asyncTick:n}=function(a,b,c){let{N:d,r:e,p:f,dkLen:g,asyncTick:h,maxmem:i,onProgress:j}=gM({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(gu(d),gu(e),gu(f),gu(g),gu(h),gu(i),void 0!==j&&"function"!=typeof j)throw Error("progressCb should be function");let k=128*e,l=k/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(f<0||f>0x1fffffffe0/k)throw Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(g<0||g>0x1fffffffe0)throw Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(k*(d+f)>i)throw Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+i);let m=gQ(gY,a,b,{c:1,dkLen:k*f}),n=gy(m),o=gy(new Uint8Array(k*d)),p=gy(new Uint8Array(k)),q=()=>{};if(j){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;q=()=>{c++,j&&(!(c%b)||c===a)&&j(c/a)}}return{N:d,r:e,p:f,dkLen:g,blockSize32:l,V:o,B32:n,B:m,tmp:p,blockMixCb:q,asyncTick:h}}(a,b,c);gD(j);for(let a=0;a<f;a++){let b=h*a;for(let a=0;a<h;a++)i[a]=j[b+a];let c=0;await gI(d-1,n,()=>{g$(i,c,i,c+=h,e),m()}),g$(i,(d-1)*h,j,b,e),m(),await gI(d,n,()=>{let a=j[b+h-16]%d;for(let c=0;c<h;c++)l[c]=j[b+c]^i[a*h+c];g$(l,0,j,b,e),m()})}gD(j);let o=gQ(gY,a,k,{c:1,dkLen:g});return gz(k,i,l),o}let g0={encode:a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c},decode:a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)}};function g1(a){switch(a){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${a}`)}}function g2(...a){let b=a.map(g1).join("");if(0===b.length)throw Error("No valid characters provided for random string generation.");let c=b.length;return(a,...d)=>{let e;if(a<=0)throw Error("Length must be a positive integer.");let f=b,g=c;d.length>0&&(g=(f=d.map(g1).join("")).length);let h=Math.floor(256/g)*g,i=new Uint8Array(2*a),j=i.length,k="",l=j;for(;k.length<a;)l>=j&&(F(i),l=0),(e=i[l++])<h&&(k+=f[e%g]);return k}}let g3=g2("a-z","0-9","A-Z","-_");async function g4(a,b,c=3600){return await new gt(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}let g5={N:16384,r:16,p:1,dkLen:64};async function g6(a,b){return await g_(a.normalize("NFKC"),b,{N:g5.N,p:g5.p,r:g5.r,dkLen:g5.dkLen,maxmem:128*g5.N*g5.r*2})}let g7=async a=>{let b=g0.encode(F(new Uint8Array(16))),c=await g6(a,b);return`${b}:${g0.encode(c)}`},g8=async({hash:a,password:b})=>{let[c,d]=a.split(":");return function(a,b){let c=new Uint8Array(a),d=new Uint8Array(b);if(c.length!==d.length)return!1;let e=0;for(let a=0;a<c.length;a++)e|=c[a]^d[a];return 0===e}(await g6(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(gE)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=gG(a.charCodeAt(e)),f=gG(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))},g9=async({key:a,data:b})=>{let c=await e$("SHA-256").digest(a),d=e8(b);return function(a){e2(a);let b="";for(let c=0;c<a.length;c++)b+=e5[a[c]];return b}(fB(fy)(new Uint8Array(c)).encrypt(d))},ha=async({key:a,data:b})=>{let c=await e$("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("padded hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=e7(a.charCodeAt(e)),f=e7(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),e=fB(fy)(new Uint8Array(c));return new TextDecoder().decode(e.decrypt(d))};var hb=Object.defineProperty,hc=Object.defineProperties,hd=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,hf=Object.prototype.hasOwnProperty,hg=Object.prototype.propertyIsEnumerable,hh=(a,b,c)=>b in a?hb(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,hi=(a,b)=>{for(var c in b||(b={}))hf.call(b,c)&&hh(a,c,b[c]);if(he)for(var c of he(b))hg.call(b,c)&&hh(a,c,b[c]);return a},hj=(a,b)=>hc(a,hd(b)),hk=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},hl=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},hm=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},hn=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},ho=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},hp=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function hq(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function hr(a){try{return JSON.parse(a)}catch(b){return a}}function hs(a){return"function"==typeof a}async function ht(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await ho(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=hq(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var hu=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function hv(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new hu(c.issues);return c.value}var hw=["get","post","put","patch","delete"],hx=async(a,b)=>{var c,d,e,f,g,h,i,j;let{hooks:k,url:l,options:m}=await hl(a,b),n=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&hs(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&hs(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(m),o=new AbortController,p=null!=(c=m.signal)?c:o.signal,q=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];hw.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(l,m),r=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(hq(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(m),s=await ht(m),t=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return hw.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(l,m),u=hj(hi({},m),{url:q,headers:s,body:r,method:t,signal:p});for(let a of k.onRequest)if(a){let b=await a(u);b instanceof Object&&(u=b)}("pipeTo"in u&&"function"==typeof u.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in u)&&(u.duplex="half");let{clearTimeout:v}=function(a,b){let c;return!(null==a?void 0:a.signal)&&(null==a?void 0:a.timeout)&&(c=setTimeout(()=>null==b?void 0:b.abort(),null==a?void 0:a.timeout)),{abortTimeout:c,clearTimeout:()=>{c&&clearTimeout(c)}}}(m,o),w=await n(u.url,u);v();let x={response:w,request:u};for(let a of k.onResponse)if(a){let c=await a(hj(hi({},x),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?w.clone():w}));c instanceof Response?w=c:c instanceof Object&&(w=c.response)}if(w.ok){if("HEAD"===u.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return hp.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(w),c={data:"",response:w,request:u};if("json"===a||"text"===a){let a=await w.text(),b=null!=(f=u.jsonParser)?f:hr;c.data=await b(a)}else c.data=await w[a]();for(let a of((null==u?void 0:u.output)&&u.output&&!u.disableValidation&&(c.data=await hv(u.output,c.data)),k.onSuccess))a&&await a(hj(hi({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?w.clone():w}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let y=null!=(h=null==b?void 0:b.jsonParser)?h:hr,z=await w.text(),A=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(z),B=A?await y(z):null,C={response:w,responseText:z,request:u,error:hj(hi({},B),{status:w.status,statusText:w.statusText})};for(let a of k.onError)a&&await a(hj(hi({},C),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?w.clone():w}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new hm({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new hm(a);case"exponential":return new hn(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,w)){for(let a of k.onRetry)a&&await a(x);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await hx(a,hj(hi({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new hk(w.status,w.statusText,A?B:z);return{data:null,error:hj(hi({},B),{status:w.status,statusText:w.statusText})}};let hy=(0,fL.promisify)(C.verify),hz=async(a,b,c,d)=>{let e=gd(a,b,"verify");if(a.startsWith("HS")){let b=await gf(a,e,d);try{return C.timingSafeEqual(c,b)}catch{return!1}}let f=fY(a),g=f9(a,e);try{return await hy(f,d,g,c)}catch{return!1}};async function hA(a,b){if(!f5(a))throw TypeError("JWK must be an object");switch(b||=a.alg,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return fK(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new fQ('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":var c;return(c={...a,alg:b}).d?(0,C.createPrivateKey)({format:"jwk",key:c}):(0,C.createPublicKey)({format:"jwk",key:c});default:throw new fQ('Unsupported "kty" (Key Type) Parameter value')}}async function hB(a,b,c){let d,e;if(!f5(a))throw new fR("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new fR('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new fR("JWS Protected Header incorrect type");if(void 0===a.payload)throw new fR("JWS Payload missing");if("string"!=typeof a.signature)throw new fR("JWS Signature missing or incorrect type");if(void 0!==a.header&&!f5(a.header))throw new fR("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=fK(a.protected);f=JSON.parse(fH.decode(b))}catch{throw new fR("JWS Protected Header is invalid")}if(!gg(f,a.header))throw new fR("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=gl(fR,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new fR('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new fR('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(k&&!k.has(j))throw new fP('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new fR("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new fR("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b?(b=await b(f,a),l=!0,gk(j,b,"verify"),f6(b)&&(b=await hA(b,j))):gk(j,b,"verify");let m=fI(fG.encode(a.protected??""),fG.encode("."),"string"==typeof a.payload?fG.encode(a.payload):a.payload);try{d=fK(a.signature)}catch{throw new fR("Failed to base64url decode the signature")}if(!await hz(j,b,d,m))throw new fX;if(i)try{e=fK(a.payload)}catch{throw new fR("Failed to base64url decode the payload")}else e="string"==typeof a.payload?fG.encode(a.payload):a.payload;let n={payload:e};return(void 0!==a.protected&&(n.protectedHeader=f),void 0!==a.header&&(n.unprotectedHeader=a.header),l)?{...n,key:b}:n}async function hC(a,b,c){if(a instanceof Uint8Array&&(a=fH.decode(a)),"string"!=typeof a)throw new fR("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new fR("Invalid Compact JWS");let h=await hB({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}let hD=a=>a.toLowerCase().replace(/^application\//,"");async function hE(a,b,c){let d=await hC(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new fS("JWTs MUST NOT use unencoded payload");let e={payload:((a,b,c={})=>{let d,e,f,g;try{d=JSON.parse(fH.decode(b))}catch{}if(!f5(d))throw new fS("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||hD(a.typ)!==hD(h)))throw new fN('unexpected "typ" JWT header value',d,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in d))throw new fN(`missing required "${a}" claim`,d,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(d.iss))throw new fN('unexpected "iss" claim value',d,"iss","check_failed");if(k&&d.sub!==k)throw new fN('unexpected "sub" claim value',d,"sub","check_failed");if(l&&(f=d.aud,g="string"==typeof l?[l]:l,"string"==typeof f?!g.includes(f):!(!!Array.isArray(f)&&g.some(Set.prototype.has.bind(new Set(f))))))throw new fN('unexpected "aud" claim value',d,"aud","check_failed");switch(typeof c.clockTolerance){case"string":e=gq(c.clockTolerance);break;case"number":e=c.clockTolerance;break;case"undefined":e=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=go(o||new Date);if((void 0!==d.iat||m)&&"number"!=typeof d.iat)throw new fN('"iat" claim must be a number',d,"iat","invalid");if(void 0!==d.nbf){if("number"!=typeof d.nbf)throw new fN('"nbf" claim must be a number',d,"nbf","invalid");if(d.nbf>p+e)throw new fN('"nbf" claim timestamp check failed',d,"nbf","check_failed")}if(void 0!==d.exp){if("number"!=typeof d.exp)throw new fN('"exp" claim must be a number',d,"exp","invalid");if(d.exp<=p-e)throw new fO('"exp" claim timestamp check failed',d,"exp","check_failed")}if(m){let a=p-d.iat;if(a-e>("number"==typeof m?m:gq(m)))throw new fO('"iat" claim timestamp check failed (too far in the past)',d,"iat","check_failed");if(a<0-e)throw new fN('"iat" claim timestamp check failed (it should be in the past)',d,"iat","check_failed")}return d})(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}function hF(a){let b,c;if("string"!=typeof a)throw new fS("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new fS("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new fS("Invalid JWT");if(!d)throw new fS("JWTs must contain a payload");try{b=fK(d)}catch{throw new fS("Failed to base64url decode the payload")}try{c=JSON.parse(fH.decode(b))}catch{throw new fS("Failed to parse the decoded payload as JSON")}if(!f5(c))throw new fS("Invalid JWT Claims Set");return c}let hG=require("node:http"),hH=require("node:https"),hI=require("node:events"),hJ=async(a,b,c)=>{let d;switch(a.protocol){case"https:":d=hH.get;break;case"http:":d=hG.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:e,headers:f}=c,g=d(a.href,{agent:e,timeout:b,headers:f}),[h]=await Promise.race([(0,hI.once)(g,"response"),(0,hI.once)(g,"timeout")]);if(!h)throw g.destroy(),new fW;if(200!==h.statusCode)throw new fM("Expected 200 OK from the JSON Web Key Set HTTP response");let i=[];for await(let a of h)i.push(a);try{return JSON.parse(fH.decode(fI(...i)))}catch{throw new fM("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function hK(a){return f5(a)}function hL(a){return"function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a))}class hM{_jwks;_cached=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(hK)}(a))throw new fT("JSON Web Key Set malformed");this._jwks=hL(a)}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new fQ('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this._jwks.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&"string"==typeof a.alg&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES256K":b="secp256k1"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":b="Ed25519"===a.crv;break;case"EdDSA":b="Ed25519"===a.crv||"Ed448"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new fU;if(1!==h){let a=new fV,{_cached:b}=this;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await hN(b,a,c)}catch{}},a}return hN(this._cached,g,c)}}async function hN(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await hA({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new fT("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function hO(a){let b=new hM(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>hL(b._jwks),enumerable:!0,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(d="jose/v5.10.0");let hP=Symbol();class hQ{_url;_timeoutDuration;_cooldownDuration;_cacheMaxAge;_jwksTimestamp;_pendingFetch;_options;_local;_cache;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(a.href),this._options={agent:b?.agent,headers:b?.headers},this._timeoutDuration="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,b?.[hP]!==void 0&&(this._cache=b?.[hP],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!f5(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,f5)}(b?.[hP],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=hO(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(a,b){this._local&&this.fresh()||await this.reload();try{return await this._local(a,b)}catch(c){if(c instanceof fU&&!1===this.coolingDown())return await this.reload(),this._local(a,b);throw c}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let a=new Headers(this._options.headers);d&&!a.has("User-Agent")&&(a.set("User-Agent",d),this._options.headers=Object.fromEntries(a.entries())),this._pendingFetch||=hJ(this._url,this._timeoutDuration,this._options).then(a=>{this._local=hO(a),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=a),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(a=>{throw this._pendingFetch=void 0,a}),await this._pendingFetch}}let hR=Object.create(null),hS=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?hR:globalThis),hT=new Proxy(hR,{get:(a,b)=>hS()[b]??hR[b],has:(a,b)=>b in hS()||b in hR,set:(a,b,c)=>(hS(!0)[b]=c,!0),deleteProperty(a,b){if(!b)return!1;let c=hS(!0);return delete c[b],!0},ownKeys:()=>Object.keys(hS(!0))}),hU="undefined"!=typeof process&&process.env&&"production"||"",hV="production"===hU,hW="dev"===hU||"development"===hU,hX="test"===hU||function(a){return!!a&&"false"!==a}(hT.TEST);class hY extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}}function hZ(a,b="/api/auth"){return!function(a){try{let b=new URL(a);return"/"!==b.pathname}catch(b){throw new hY(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a)?(b=b.startsWith("/")?b:`/${b}`,`${a.replace(/\/+$/,"")}${b}`):a}function h$(a,b,c){if(a)return hZ(a,b);let d=hT.BETTER_AUTH_URL||hT.NEXT_PUBLIC_BETTER_AUTH_URL||hT.PUBLIC_BETTER_AUTH_URL||hT.NUXT_PUBLIC_BETTER_AUTH_URL||hT.NUXT_PUBLIC_AUTH_URL||("/"!==hT.BASE_URL?hT.BASE_URL:void 0);if(d)return hZ(d,b);let e=c?.headers.get("x-forwarded-host"),f=c?.headers.get("x-forwarded-proto");if(e&&f)return hZ(`${f}://${e}`,b);if(c){let a=h_(c.url);if(!a)throw new hY("Could not get origin from request. Please provide a valid base URL.");return hZ(a,b)}if("undefined"!=typeof window&&window.location)return hZ(window.location.origin,b)}function h_(a){try{return new URL(a).origin}catch(a){return null}}function h0(a){try{return new URL(a).protocol}catch(a){return null}}function h1(a){try{return new URL(a).host}catch(b){return a}}let h2=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>E.importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await E.sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?g0.encode(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?eZ.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=g0.decode(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await eY.decode(e)),E.verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c},h3=new Map,h4={decode:(a,b="utf-8")=>(h3.has(b)||h3.set(b,new TextDecoder(b)),h3.get(b).decode(a)),encode:new TextEncoder().encode},h5=(a,b)=>{let c={t:`${a}${b}`,value:a,tFormat:b,toMilliseconds:()=>{switch(b){case"ms":return a;case"s":return 1e3*a;case"m":return 1e3*a*60;case"h":return 1e3*a*3600;case"d":return 1e3*a*86400;case"w":return 1e3*a*604800;case"y":return 1e3*a*31536e3}},toSeconds:()=>c.toMilliseconds()/1e3,toMinutes:()=>c.toSeconds()/60,toHours:()=>c.toMinutes()/60,toDays:()=>c.toHours()/24,toWeeks:()=>c.toDays()/7,toYears:()=>c.toDays()/365,getDate:()=>new Date(Date.now()+c.toMilliseconds()),add:a=>{let b="string"==typeof a?h6(a).toMilliseconds():a.toMilliseconds();return h5(c.toMilliseconds()+b,"ms")},subtract:a=>{let b="string"==typeof a?h6(a).toMilliseconds():a.toMilliseconds();return h5(c.toMilliseconds()-b,"ms")},multiply:a=>h5(c.toMilliseconds()*a,"ms"),divide:a=>h5(c.toMilliseconds()/a,"ms"),equals:a=>{let b="string"==typeof a?h6(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()===b},lessThan:a=>{let b="string"==typeof a?h6(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()<b},greaterThan:a=>{let b="string"==typeof a?h6(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()>b},format:a=>{let b=c.getDate();return a.replace(/YYYY|MM|DD|HH|mm|ss/g,a=>{switch(a){case"YYYY":return b.getFullYear().toString();case"MM":return(b.getMonth()+1).toString().padStart(2,"0");case"DD":return b.getDate().toString().padStart(2,"0");case"HH":return b.getHours().toString().padStart(2,"0");case"mm":return b.getMinutes().toString().padStart(2,"0");case"ss":return b.getSeconds().toString().padStart(2,"0");default:return a}})},fromNow:()=>{let a=c.toMilliseconds();return a<0?c.ago():a<1e3?"in a few seconds":a<6e4?`in ${Math.round(a/1e3)} seconds`:a<36e5?`in ${Math.round(a/6e4)} minutes`:a<864e5?`in ${Math.round(a/36e5)} hours`:a<6048e5?`in ${Math.round(a/864e5)} days`:a<26298e5?`in ${Math.round(a/6048e5)} weeks`:a<315576e5?`in ${Math.round(a/26298e5)} months`:`in ${Math.round(a/315576e5)} years`},ago:()=>{let a=-c.toMilliseconds();return a<0?c.fromNow():a<1e3?"a few seconds ago":a<6e4?`${Math.round(a/1e3)} seconds ago`:a<36e5?`${Math.round(a/6e4)} minutes ago`:a<864e5?`${Math.round(a/36e5)} hours ago`:a<6048e5?`${Math.round(a/864e5)} days ago`:a<26298e5?`${Math.round(a/6048e5)} weeks ago`:a<315576e5?`${Math.round(a/26298e5)} months ago`:`${Math.round(a/315576e5)} years ago`}};return c},h6=a=>{let b=a.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!b)throw Error("Invalid time format");return h5(parseInt(b[1]),b[2])};function h7(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):hV)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new hY("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}async function h8(a,b){if(a.context.options.session?.cookieCache?.enabled){let c={session:Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),user:b.user},d=eU(a.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),e=eZ.encode(JSON.stringify({session:c,expiresAt:d,signature:await h2("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...c,expiresAt:d}))}),{padding:!1});if(e.length>4093)throw new hY("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");a.setCookie(a.context.authCookies.sessionData.name,e,a.context.authCookies.sessionData.options)}}async function h9(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await h8(a,b),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function ia(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0}),a.setCookie(a.context.authCookies.sessionData.name,"",{...a.context.authCookies.sessionData.options,maxAge:0}),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}function ib(a){try{return JSON.parse(a,function(a,b){if("string"==typeof b&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(b)){let a=new Date(b);if(!isNaN(a.getTime()))return a}return b})}catch{return null}}let ic=a=>g2("a-z","A-Z","0-9")(a||32),id=["info","success","warn","error","debug"],ie={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"}},ig={info:ie.fg.blue,success:ie.fg.green,warn:ie.fg.yellow,error:ie.fg.red,debug:ie.fg.magenta},ih=a=>{let b=a?.disabled!==!0,c=a?.level??"error";return Object.fromEntries(id.map(d=>[d,(...[e,...f])=>((d,e,f=[])=>{if(!b||!(id.indexOf(d)<=id.indexOf(c)))return;let g=((a,b)=>{let c=new Date().toISOString();return`${ie.dim}${c}${ie.reset} ${ig[a]}${a.toUpperCase()}${ie.reset} ${ie.bright}[Better Auth]:${ie.reset} ${b}`})(d,e);if(!a||"function"!=typeof a.log)return void("error"===d?console.error(g,...f):"warn"===d?console.warn(g,...f):console.log(g,...f));a.log("success"===d?"info":d,e,...f)})(d,e,f)]))},ii=ih();function ij(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function ik(a,b){let c={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let d of a.plugins||[])d.schema&&d.schema[b]&&(c={...c,...d.schema[b].fields});return c}function il(a,b){return ij(b,{fields:ik(a,"user")})}function im(a,b){return ij(b,{fields:ik(a,"session")})}function io(a,b,c){return function(a,b){let c=b.action||"create",d=b.fields,e={};for(let b in d){if(b in a){if(!1===d[b].input){d[b].defaultValue&&(e[b]=d[b].defaultValue);continue}if(d[b].validator?.input&&void 0!==a[b]){e[b]=d[b].validator.input.parse(a[b]);continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(d[b].defaultValue&&"create"===c){e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new M("BAD_REQUEST",{message:`${b} is required`})}return e}(b||{},{fields:ik(a,"user"),action:c})}function ip(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function iq(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!ip(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:ip(g)&&ip(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}ey({id:dZ(),providerId:dZ(),accountId:dZ(),userId:eS(),accessToken:dZ().nullish(),refreshToken:dZ().nullish(),idToken:dZ().nullish(),accessTokenExpiresAt:eu().nullish(),refreshTokenExpiresAt:eu().nullish(),scope:dZ().nullish(),password:dZ().nullish(),createdAt:eu().default(()=>new Date),updatedAt:eu().default(()=>new Date)}),ey({id:dZ(),email:dZ().transform(a=>a.toLowerCase()),emailVerified:en().default(!1),name:dZ(),image:dZ().nullish(),createdAt:eu().default(()=>new Date),updatedAt:eu().default(()=>new Date)}),ey({id:dZ(),userId:eS(),expiresAt:eu(),createdAt:eu().default(()=>new Date),updatedAt:eu().default(()=>new Date),token:dZ(),ipAddress:dZ().nullish(),userAgent:dZ().nullish()}),ey({id:dZ(),value:dZ(),createdAt:eu().default(()=>new Date),updatedAt:eu().default(()=>new Date),expiresAt:eu(),identifier:dZ()});let ir=iq();iq((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),iq((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let is=_(async()=>({})),it=_.create({use:[is,_(async()=>({}))]}),iu=aa.create({use:[is]});function iv(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function iw(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function ix(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b)){let d=b.map(b=>`^${a(b,c)}$`);return`(?:${d.join("|")})`}let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=iv(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=iv(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=iv(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=iw.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}let iy=it(async a=>{if(a.request?.method!=="POST"||!a.request)return;let{body:b,query:c,context:d}=a,e=a.headers?.get("origin")||a.headers?.get("referer")||"",f=b?.callbackURL||c?.callbackURL,g=b?.redirectTo,h=b?.errorCallbackURL,i=b?.newUserCallbackURL,j=Array.isArray(d.options.trustedOrigins)?d.trustedOrigins:[...d.trustedOrigins,...await d.options.trustedOrigins?.(a.request)||[]],k=a.headers?.has("cookie"),l=(b,c)=>{if(b&&!j.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?ix(b)(h_(a)||a):ix(b)(h1(a));let c=h0(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===h_(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${j}`),new M("FORBIDDEN",{message:`Invalid ${c}`})};k&&!a.context.options.advanced?.disableCSRFCheck&&l(e,"origin"),f&&l(f,"callbackURL"),g&&l(g,"redirectURL"),h&&l(h,"errorCallbackURL"),i&&l(i,"newUserCallbackURL")}),iz=a=>it(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?ix(b)(h_(a)||a):ix(b)(h1(a));let c=h0(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===h_(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new M("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")}),iA={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."},iB=()=>iu("/get-session",{method:"GET",query:eH(ey({disableCookieCache:eT().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:eT().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=a.getCookie(a.context.authCookies.sessionData.name),d=c?ib(h4.decode(eY.decode(c))):null;if(d&&!await h2("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...d.session,expiresAt:d.expiresAt}),d.signature)){let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session;if(!(d.expiresAt<Date.now()||b.session.expiresAt<new Date))return a.context.session=b,a.json(b);{let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return ia(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh)return a.json(f);let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:eU(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return ia(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;return await h9(a,{session:b,user:f.user},!1,{maxAge:c}),a.json({session:b,user:f.user})}return await h8(a,f),a.json(f)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new M("INTERNAL_SERVER_ERROR",{message:iA.FAILED_TO_GET_SESSION})}}),iC=async(a,b)=>{if(a.context.session)return a.context.session;let c=await iB()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},iD=it(async a=>{let b=await iC(a);if(!b?.session)throw new M("UNAUTHORIZED");return{session:b}});it(async a=>{let b=await iC(a);if(!b?.session&&(a.request||a.headers))throw new M("UNAUTHORIZED");return{session:b}});let iE=it(async a=>{let b=await iC(a);if(!b?.session)throw new M("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=b.session.updatedAt?.valueOf()||b.session.createdAt.valueOf();if(!(Date.now()-d<1e3*c))throw new M("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),iF=iu("/revoke-session",{method:"POST",body:ey({token:dZ().meta({description:"The token to revoke"})}),use:[iD],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token,c=await a.context.internalAdapter.findSession(b);if(!c)throw new M("BAD_REQUEST",{message:"Session not found"});if(c.session.userId!==a.context.session.user.id)throw new M("UNAUTHORIZED");try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new M("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),iG=iu("/revoke-sessions",{method:"POST",use:[iD],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new M("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),iH=iu("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[iD],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new M("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});async function iI(a,b,c,d=3600){return await g4({email:b.toLowerCase(),updateTo:c},a,d)}async function iJ(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new M("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await iI(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:d,token:c},a.request)}let iK=iu("/send-verification-email",{method:"POST",body:ey({email:dB(d_,void 0).meta({description:"The email to send the verification email to"}),callbackURL:dZ().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new M("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await iC(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c&&await iJ(a,c.user),a.json({status:!0})}if(c?.user.emailVerified)throw new M("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new M("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await iJ(a,c.user),a.json({status:!0})}),iL=iu("/verify-email",{method:"GET",query:ey({token:dZ().meta({description:"The token to verify the email"}),callbackURL:dZ().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[iz(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new M("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await hE(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof fO)return c("token_expired");return c("invalid_token")}let e=ey({email:dZ().email(),updateTo:dZ().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await iC(a);if(!b||b.user.email!==e.email){if(a.query.callbackURL)throw a.redirect(`${a.query.callbackURL}?error=unauthorized`);return c("unauthorized")}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1},a),f=await iI(a.context.secret,e.updateTo);if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${f}&callbackURL=${a.query.callbackURL||"/"}`,token:f},a.request),await h9(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0},a);if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await iC(a);if(b&&b.user.email===e.email)await h9(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id,a);if(!b)throw new M("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await h9(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}),iM={isAction:!1};async function iN(a,b){let c=a.body?.callbackURL||a.context.options.baseURL;if(!c)throw new M("BAD_REQUEST",{message:"callbackURL is required"});let d=g3(128),e=g3(32),f=JSON.stringify({callbackURL:c,codeVerifier:d,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp}),g=new Date;g.setMinutes(g.getMinutes()+10);let h=await a.context.internalAdapter.createVerificationValue({value:f,identifier:e,expiresAt:g},a);if(!h)throw a.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new M("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:h.identifier,codeVerifier:d}}async function iO(a){let b=a.query.state||a.body.state,c=await a.context.internalAdapter.findVerificationValue(b);if(!c){a.context.logger.error("State Mismatch. Verification not found",{state:b});let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=please_restart_the_process`)}let d=ey({callbackURL:dZ(),codeVerifier:dZ(),errorURL:dZ().optional(),newUserURL:dZ().optional(),expiresAt:ej(),link:ey({email:dZ(),userId:eS()}).optional(),requestSignUp:en().optional()}).parse(JSON.parse(c.value));if(d.errorURL||(d.errorURL=`${a.context.baseURL}/error`),d.expiresAt<Date.now()){await a.context.internalAdapter.deleteVerificationValue(c.id);let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=please_restart_the_process`)}return await a.context.internalAdapter.deleteVerificationValue(c.id),d}async function iP(a){let b=await e$("SHA-256").digest(a);return eZ.encode(new Uint8Array(b),{padding:!1})}function iQ(a){return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?eU(a.expires_in,"sec"):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?eU(a.refresh_token_expires_in,"sec"):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token}}function iR(a,b){return b.options.account?.encryptOAuthTokens&&a?g9({key:b.secret,data:a}):a}async function iS(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let g=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{ii.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),h=g?.user,i=!h;if(g){let d=g.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await iR(c.accessToken,a.context),refreshToken:await iR(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b,a)}}else{let d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return hW&&ii.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:g.user.id,accessToken:await iR(c.accessToken,a.context),refreshToken:await iR(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope},a)}catch(a){return ii.error("Unable to link account",a),{error:"unable to link account",data:null}}}if(f){let{id:c,...d}=b;await a.context.internalAdapter.updateUser(g.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===g.user.email&&g.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b;if(h=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},{accessToken:await iR(c.accessToken,a.context),refreshToken:await iR(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},a).then(a=>a?.user),!b.emailVerified&&h&&a.context.options.emailVerification?.sendOnSignUp){let b=await iI(a.context.secret,h.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:h,url:c,token:b},a.request)}}catch(a){if(ii.error(a),a instanceof M)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!h)return{error:"unable to create user",data:null,isRegister:!1};let j=await a.context.internalAdapter.createSession(h.id,a);return j?{data:{session:j,user:h},error:null,isRegister:i}:{error:"unable to create session",data:null,isRegister:!1}}async function iT({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);if(s.searchParams.set("response_type",l||"code"),s.searchParams.set("client_id",b.clientId),s.searchParams.set("state",d),s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await iP(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function iU({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={}}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...h};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),g&&j.set("device_id",g),j.set("redirect_uri",d.redirectURI||c),j.set("client_id",d.clientId),"basic"===f){let a=eY.encode(`${d.clientId}:${d.clientSecret}`);k.authorization=`Basic ${a}`}else j.set("client_secret",d.clientSecret);for(let[a,b]of Object.entries(i))j.has(a)||j.append(a,b);let{data:l,error:m}=await hx(e,{method:"POST",body:j,headers:k});if(m)throw m;return iQ(l)}async function iV({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e,grantType:f="refresh_token"}){let g=new URLSearchParams,h={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(g.set("grant_type",f),g.set("refresh_token",a),"basic"===d?h.authorization=eY.encode(`${b.clientId}:${b.clientSecret}`):(g.set("client_id",b.clientId),g.set("client_secret",b.clientSecret)),e)for(let[a,b]of Object.entries(e))g.set(a,b);let{data:i,error:j}=await hx(c,{method:"POST",body:g,headers:h});if(j)throw j;let k={accessToken:i.access_token,refreshToken:i.refresh_token,tokenType:i.token_type,scopes:i.scope?.split(" "),idToken:i.id_token};return i.expires_in&&(k.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*i.expires_in)),k}let iW=async a=>{let{data:b}=await hx("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new M("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await hA(c,c.alg)},iX=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://");var iY=(a=>(a[a.RUS=0]="RUS",a[a.UKR=1]="UKR",a[a.ENG=3]="ENG",a[a.SPA=4]="SPA",a[a.GERMAN=6]="GERMAN",a[a.POL=15]="POL",a[a.FRA=16]="FRA",a[a.TURKEY=82]="TURKEY",a))(iY||{});let iZ={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await iT({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>iU({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=function(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(fH.decode(fK(b)));if(!f5(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}(b);if(!d||!e)return!1;let f=await iW(d),{payload:g}=await hE(b,f,{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.appBundleIdentifier||a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==g[a]&&(g[a]=!!g[a])}),(!c||g.nonce===c)&&!!g},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=hF(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:d,emailVerified:e,email:c.email,...f},data:c}},options:a}),discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];return c&&e.push(...c),a.scope&&e.push(...a.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar){let a="0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5;c.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await iT({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{let{payload:d}=await hE(b,function(a,b){let c=new hQ(a,void 0),d=async(a,b)=>c.getKey(a,b);return Object.defineProperties(d,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!c._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>c._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),d}(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&d.nonce!==c)return!1;return!!d}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=hF(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!0});return{user:{...d,emailVerified:!0,...e},data:c}}let c=["id","name","email","picture",...a?.fields||[]],{data:d,error:e}=await hx("https://graph.facebook.com/me?fields="+c.join(","),{auth:{type:"Bearer",token:b.accessToken}});if(e)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.id,name:d.name,email:d.email,image:d.picture.data.url,emailVerified:d.email_verified,...f},data:d}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await hx("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=`https://login.microsoftonline.com/${b}/oauth2/v2.0/authorize`,d=`https://login.microsoftonline.com/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let d=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&d.push(...a.scope),b.scopes&&d.push(...b.scopes),iT({id:"microsoft",options:a,authorizationEndpoint:c,state:b.state,codeVerifier:b.codeVerifier,scopes:d,redirectURI:b.redirectURI,prompt:a.prompt})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:e})=>iU({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=hF(b.idToken),d=a.profilePhotoSize||48;await hx(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=b.response.clone(),d=await a.arrayBuffer(),e=eY.encode(d);c.picture=`data:image/jpeg;base64, ${e}`}catch(a){ii.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:!0,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),iV({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:d})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw ii.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new hY("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new hY("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),"select_account+consent"===a.prompt&&(a.prompt="select_account consent"),await iT({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>iU({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`,{data:e}=await hx(d);return!!e&&e.aud===a.clientId&&("https://accounts.google.com"===e.iss||"accounts.google.com"===e.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=hF(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>iU({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>iU({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iT({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return ii.error("No idToken found in token"),null;let d=hF(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),iT({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>iU({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await hx("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await iT({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await iU({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>iU({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!0,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>iU({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>iV({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!0,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await iT({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await iU({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>iV({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let{authorizationEndpoint:b,tokenEndpoint:c,userinfoEndpoint:d}=(a=>{let b=a||"https://gitlab.com";return{authorizationEndpoint:iX(`${b}/oauth/authorize`),tokenEndpoint:iX(`${b}/oauth/token`),userinfoEndpoint:iX(`${b}/api/v4/user`)}})(a.issuer),e="gitlab";return{id:e,name:"Gitlab",createAuthorizationURL:async({state:c,scopes:d,codeVerifier:f,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await iT({id:e,options:a,authorizationEndpoint:b,scopes:i,state:c,redirectURI:h,codeVerifier:f,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:d,codeVerifier:e})=>iU({code:b,redirectURI:d,options:a,codeVerifier:e,tokenEndpoint:c}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:e}=await hx(d,{headers:{authorization:`Bearer ${b.accessToken}`}});if(e||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&client_secret=${a.clientSecret}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iT({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),e={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${eY.encode(`${a.clientId}:${a.clientSecret}`)}`},{data:f,error:g}=await hx("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:e,body:d.toString()});if(g)throw g;return iQ(f)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>iU({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!0,...e},data:{...c}}},options:a}),vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>iU({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>iV({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await hx("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e||!d.user.email)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,...f},data:d}},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await iP(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>iU({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await hx("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),iT({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>iU({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>iV({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await hx("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}}},i$=eE(Object.keys(iZ)).or(dZ()),i_=iu("/sign-in/social",{method:"POST",body:ey({callbackURL:dZ().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:dZ().optional(),errorCallbackURL:dZ().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:i$,disableRedirect:en().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:eH(ey({token:dZ().meta({description:"ID token from the provider"}),nonce:dZ().meta({description:"Nonce used to generate the token"}).optional(),accessToken:dZ().meta({description:"Access token from the provider"}).optional(),refreshToken:dZ().meta({description:"Refresh token from the provider"}).optional(),expiresAt:ej().meta({description:"Expiry date of the token"}).optional()})),scopes:ew(dZ()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:en().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:dZ().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new M("NOT_FOUND",{message:iA.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new M("NOT_FOUND",{message:iA.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.USER_EMAIL_NOT_FOUND});let f=await iS(a,{userInfo:{...e.user,email:e.user.email,id:e.user.id,name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:e.user.id,accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new M("UNAUTHORIZED",{message:f.error});return await h9(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:{id:f.data.user.id,email:f.data.user.email,name:f.data.user.name,image:f.data.user.image,emailVerified:f.data.user.emailVerified,createdAt:f.data.user.createdAt,updatedAt:f.data.user.updatedAt}})}let{codeVerifier:c,state:d}=await iN(a),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),i0=iu("/sign-in/email",{method:"POST",body:ey({email:dZ().meta({description:"Email of the user"}),password:dZ().meta({description:"Password of the user"}),callbackURL:dZ().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:en().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new M("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!dZ().email().safeParse(b).success)throw new M("BAD_REQUEST",{message:iA.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new M("UNAUTHORIZED",{message:iA.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw a.context.logger.error("Credential account not found",{email:b}),new M("UNAUTHORIZED",{message:iA.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw a.context.logger.error("Password not found",{email:b}),new M("UNAUTHORIZED",{message:iA.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new M("UNAUTHORIZED",{message:iA.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new M("FORBIDDEN",{message:iA.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await iI(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:c,token:b},a.request)}throw new M("FORBIDDEN",{message:iA.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,a,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new M("UNAUTHORIZED",{message:iA.FAILED_TO_CREATE_SESSION});return await h9(a,{session:g,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:{id:d.user.id,email:d.user.email,name:d.user.name,image:d.user.image,emailVerified:d.user.emailVerified,createdAt:d.user.createdAt,updatedAt:d.user.updatedAt}})}),i1=ey({code:dZ().optional(),error:dZ().optional(),device_id:dZ().optional(),error_description:dZ().optional(),state:dZ().optional(),user:dZ().optional()}),i2=iu("/callback/:id",{method:["GET","POST"],body:i1.optional(),query:i1.optional(),metadata:iM},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{if("GET"===a.method)b=i1.parse(a.query);else if("POST"===a.method)b=i1.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(g)throw a.redirect(`${e}?error=${g}&error_description=${i}`);if(!h)throw a.context.logger.error("State not found",g),a.redirect(`${e}?error=state_not_found`);let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await iO(a);function q(b){let c=n||e;throw c=c.includes("?")?`${c}&error=${b}`:`${c}?error=${b}`,a.redirect(c)}if(!f)throw a.context.logger.error("Code not found"),q("no_code");let r=a.context.socialProviders.find(b=>b.id===a.params.id);if(!r)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),q("oauth_provider_not_found");try{c=await r.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${r.id}`})}catch(b){throw a.context.logger.error("",b),q("invalid_code")}let s=await r.getUserInfo({...c,user:a.body?.user?ib(a.body.user):void 0}).then(a=>a?.user);if(!s)return a.context.logger.error("Unable to get user info"),q("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),q("no_callback_url");if(m){let b,d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(r.id)&&!s.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),q("unable_to_link_account");let e=await a.context.internalAdapter.findAccount(s.id);if(e){if(e.userId.toString()!==m.userId.toString())return q("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await iR(c.accessToken,a.context),refreshToken:await iR(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(e.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:r.id,accountId:s.id,...c,accessToken:await iR(c.accessToken,a.context),refreshToken:await iR(c.refreshToken,a.context),scope:c.scopes?.join(",")},a))return q("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!s.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),q("email_not_found");let t=await iS(a,{userInfo:{...s,email:s.email,name:s.name||s.email},account:{providerId:r.id,accountId:s.id,...c,scope:c.scopes?.join(",")},callbackURL:l,disableSignUp:r.disableImplicitSignUp&&!p||r.options?.disableSignUp,overrideUserInfo:r.options?.overrideUserInfoOnSignIn});if(t.error)return a.context.logger.error(t.error.split(" ").join("_")),q(t.error.split(" ").join("_"));let{session:u,user:v}=t.data;await h9(a,{session:u,user:v});try{d=(t.isRegister&&o||l).toString()}catch{d=t.isRegister&&o||l}throw a.redirect(d)}),i3=iu("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)throw ia(a),new M("BAD_REQUEST",{message:iA.FAILED_TO_GET_SESSION});return await a.context.internalAdapter.deleteSession(b),ia(a),a.json({success:!0})});function i4(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let i5=iu("/request-password-reset",{method:"POST",body:ey({email:dB(d_,void 0).meta({description:"The email address of the user to send a password reset email to"}),redirectTo:dZ().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new M("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=eU(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=ic(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request),a.json({status:!0})}),i6=iu("/forget-password",{method:"POST",body:ey({email:dZ().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:dZ().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new M("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=eU(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=ic(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request),a.json({status:!0})}),i7=iu("/reset-password/:token",{method:"GET",query:ey({callbackURL:dZ().meta({description:"The URL to redirect the user to reset their password"})}),use:[iz(a=>a.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{let{token:b}=a.params,{callbackURL:c}=a.query;if(!b||!c)throw a.redirect(i4(a.context,c,{error:"INVALID_TOKEN"}));let d=await a.context.internalAdapter.findVerificationValue(`reset-password:${b}`);if(!d||d.expiresAt<new Date)throw a.redirect(i4(a.context,c,{error:"INVALID_TOKEN"}));throw a.redirect(function(a,b,c){let d=new URL(b,a.baseURL);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}(a.context,c,{token:b}))}),i8=iu("/reset-password",{method:"POST",query:ey({token:dZ().optional()}).optional(),body:ey({newPassword:dZ().meta({description:"The new password to set"}),token:dZ().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new M("BAD_REQUEST",{message:iA.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_SHORT});if(c.length>e)throw new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new M("BAD_REQUEST",{message:iA.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i,a):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h},a),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),i9=iu("/change-password",{method:"POST",body:ey({newPassword:dZ().meta({description:"The new password to set"}),currentPassword:dZ().meta({description:"The current password is required"}),revokeOtherSessions:en().meta({description:"Must be a boolean value"}).optional()}),use:[iD],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new M("BAD_REQUEST",{message:iA.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new M("BAD_REQUEST",{message:iA.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let j=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id,a);if(!b)throw new M("INTERNAL_SERVER_ERROR",{message:iA.FAILED_TO_GET_SESSION});await h9(a,{session:b,user:e.user}),j=b.token}return a.json({token:j,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),ja=iu("/set-password",{method:"POST",body:ey({newPassword:dZ().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[iD]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g},a),a.json({status:!0});throw new M("BAD_REQUEST",{message:"user already has a password"})}),jb=iu("/delete-user",{method:"POST",use:[iD],body:ey({callbackURL:dZ().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:dZ().meta({description:"The password of the user is required to delete the user"}).optional(),token:dZ().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options",{session:a.context.session}),new M("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new M("BAD_REQUEST",{message:iA.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new M("BAD_REQUEST",{message:iA.INVALID_PASSWORD})}if(a.body.token)return await jc({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=g3(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},a);let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=b.session.createdAt.getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new M("BAD_REQUEST",{message:iA.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),ia(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),jc=iu("/delete-user/callback",{method:"GET",query:ey({token:dZ().meta({description:"The token to verify the deletion request"}),callbackURL:dZ().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[iz(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new M("NOT_FOUND");let b=await iC(a);if(!b)throw new M("NOT_FOUND",{message:iA.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new M("NOT_FOUND",{message:iA.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),ia(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),jd=iu("/change-email",{method:"POST",body:ey({newEmail:dB(d_,void 0).meta({description:"The new email address to set must be a valid email address"}),callbackURL:dZ().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[iD],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new M("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new M("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new M("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==a.context.session.user.emailVerified){if(await a.context.internalAdapter.findUserByEmail(b))throw new M("UNPROCESSABLE_ENTITY",{message:iA.USER_ALREADY_EXISTS});if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b},a),await h9(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await iI(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(!a.context.options.user.changeEmail.sendChangeEmailVerification)throw a.context.logger.error("Verification email isn't enabled."),new M("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await iI(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.changeEmail.sendChangeEmailVerification({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}),je=iu("/error",{method:"GET",metadata:{...iM,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>new Response(((a="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`)(new URL(a.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),jf=iu("/ok",{method:"GET",metadata:{...iM,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0})),jg=iu("/list-accounts",{method:"GET",use:[iD],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,provider:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,scopes:a.scope?.split(",")||[]})))}),jh=iu("/link-social",{method:"POST",requireHeaders:!0,body:ey({callbackURL:dZ().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:i$,idToken:ey({token:dZ(),nonce:dZ().optional(),accessToken:dZ().optional(),refreshToken:dZ().optional(),scopes:ew(dZ()).optional()}).optional(),requestSignUp:en().optional(),scopes:ew(dZ()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:dZ().meta({description:"The URL to redirect to if there is an error during the link process"}).optional()}),use:[iD],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new M("NOT_FOUND",{message:iA.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new M("NOT_FOUND",{message:iA.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.FAILED_TO_GET_USER_INFO});if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new M("UNAUTHORIZED",{message:iA.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===f.user.id))return a.json({redirect:!1,url:"",status:!0});let g=a.context.options.account?.accountLinking?.trustedProviders;if(!g?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new M("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new M("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:f.user.id.toString(),accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")},a)}catch(a){throw new M("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({redirect:!1,url:"",status:!0})}let d=await iN(a,{userId:b.user.id,email:b.user.email}),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!0})}),ji=iu("/unlink-account",{method:"POST",body:ey({providerId:dZ(),accountId:dZ().optional()}),use:[iE],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new M("BAD_REQUEST",{message:iA.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new M("BAD_REQUEST",{message:iA.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),jj=iu("/get-access-token",{method:"POST",body:ey({providerId:dZ().meta({description:"The provider ID for the OAuth provider"}),accountId:dZ().meta({description:"The account ID associated with the refresh token"}).optional(),userId:dZ().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await iC(a);if(e&&!f)throw a.error("UNAUTHORIZED");let g=f?.user?.id||d;if(!g)throw new M("BAD_REQUEST",{message:"Either userId or session is required"});if(!a.context.socialProviders.find(a=>a.id===b))throw new M("BAD_REQUEST",{message:`Provider ${b} is not supported.`});let h=(await a.context.internalAdapter.findAccounts(g)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!h)throw new M("BAD_REQUEST",{message:"Account not found"});let i=a.context.socialProviders.find(a=>a.id===b);if(!i)throw new M("BAD_REQUEST",{message:`Provider ${b} not found.`});try{let b=null,c=h.accessTokenExpiresAt&&new Date(h.accessTokenExpiresAt).getTime()-Date.now()<5e3;h.refreshToken&&c&&i.refreshAccessToken&&(b=await i.refreshAccessToken(h.refreshToken),await a.context.internalAdapter.updateAccount(h.id,{accessToken:await iR(b.accessToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshToken:await iR(b.refreshToken,a.context),refreshTokenExpiresAt:b.refreshTokenExpiresAt}));let d={accessToken:await function(a,b){return a&&b.options.account?.encryptOAuthTokens?ha({key:b.secret,data:a}):a}(b?.accessToken??h.accessToken??"",a.context),accessTokenExpiresAt:b?.accessTokenExpiresAt??h.accessTokenExpiresAt??void 0,scopes:h.scope?.split(",")??[],idToken:b?.idToken??h.idToken??void 0};return a.json(d)}catch(a){throw new M("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),jk=iu("/refresh-token",{method:"POST",body:ey({providerId:dZ().meta({description:"The provider ID for the OAuth provider"}),accountId:dZ().meta({description:"The account ID associated with the refresh token"}).optional(),userId:dZ().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await iC(a);if(e&&!f)throw a.error("UNAUTHORIZED");let g=f?.user?.id||d;if(!g)throw new M("BAD_REQUEST",{message:"Either userId or session is required"});let h=(await a.context.internalAdapter.findAccounts(g)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!h)throw new M("BAD_REQUEST",{message:"Account not found"});let i=a.context.socialProviders.find(a=>a.id===b);if(!i)throw new M("BAD_REQUEST",{message:`Provider ${b} not found.`});if(!i.refreshAccessToken)throw new M("BAD_REQUEST",{message:`Provider ${b} does not support token refreshing.`});try{let b=await i.refreshAccessToken(h.refreshToken);return await a.context.internalAdapter.updateAccount(h.id,{accessToken:await iR(b.accessToken,a.context),refreshToken:await iR(b.refreshToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshTokenExpiresAt:b.refreshTokenExpiresAt}),a.json(b)}catch(a){throw new M("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),jl=iu("/account-info",{method:"POST",use:[iD],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:ey({accountId:dZ().meta({description:"The provider given account id for which to get the account info"})})},async a=>{let b=await a.context.internalAdapter.findAccount(a.body.accountId);if(!b||b.userId!==a.context.session.user.id)throw new M("BAD_REQUEST",{message:"Account not found"});let c=a.context.socialProviders.find(a=>a.id===b.providerId);if(!c)throw new M("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let d=await jj({...a,body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1});if(!d.accessToken)throw new M("BAD_REQUEST",{message:"Access token not found"});let e=await c.getUserInfo({...d,accessToken:d.accessToken});return a.json(e)});function jm(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if(hX)return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,/^(\d{1,3}\.){3}\d{1,3}$/.test(d)?d.split(".").map(Number).every(a=>a>=0&&a<=255):/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(d))return a}}return null}let jn=new Map;async function jo(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,e=b.rateLimit.max,f=jm(a,b.options);if(!f)return void console.warn("No IP address found for rate limiting");let g=f+c,h=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(h&&(d=h.window,e=h.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,e=b.max;break}}if(b.rateLimit.customRules){let f=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?ix(a)(c):a===c);if(f){let c=b.rateLimit.customRules[f],g="function"==typeof c?await c(a):c;g&&(d=g.window,e=g.max)}}let i=function(a){if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;if("secondary-storage"===a.rateLimit.storage)return{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?JSON.parse(c):void 0},set:async(b,c)=>{await a.options.secondaryStorage?.set?.(b,JSON.stringify(c))}};if("memory"===a.rateLimit.storage)return{get:async a=>jn.get(a),async set(a,b,c){jn.set(a,b)}};let b="rateLimit",c=a.adapter;return{get:async a=>{let d=(await c.findMany({model:b,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof d?.lastRequest&&(d.lastRequest=Number(d.lastRequest)),d},set:async(d,e,f)=>{try{f?await c.updateMany({model:b,where:[{field:"key",value:d}],update:{count:e.count,lastRequest:e.lastRequest}}):await c.create({model:b,data:{key:d,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}}}(b),j=await i.get(g),k=Date.now();if(j){var l,m,n,o;let a=k-j.lastRequest;if(l=e,m=d,n=j,Date.now()-n.lastRequest<1e3*m&&n.count>=l){return o=Math.ceil((j.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":o.toString()}})}a>1e3*d?await i.set(g,{...j,count:1,lastRequest:k},!0):await i.set(g,{...j,count:j.count+1,lastRequest:k},!0)}else await i.set(g,{key:g,count:1,lastRequest:k})}async function jp(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=ir(d,c);continue}return b}}return{context:c}}async function jq(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(a=>{if(a instanceof M)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function jr(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{}),d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>b.middleware({...c,context:{...a,...c.context}});return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0},{beforeHooks:f,afterHooks:g}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),h=await jp(d,f);if("context"in h&&h.context&&"object"==typeof h.context){let{headers:a,...b}=h.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=ir(b,d)}else if(h)return h;d.asResponse=!1,d.returnHeaders=!0;let i=await e(d).catch(a=>{if(a instanceof M)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});d.context.returned=i.response,d.context.responseHeaders=i.headers;let j=await jq(d,g);if(j.response&&(i.response=j.response),i.response instanceof M&&!a?.asResponse)throw i.response;return a?.asResponse?P(i.response,{headers:i.headers}):a?.returnHeaders?{headers:i.headers,response:i.response}:i.response},c[d].path=e.path,c[d].options=e.options;return c}({...{signInSocial:i_,callbackOAuth:i2,getSession:iB(),signOut:i3,signUpEmail:iu("/sign-up/email",{method:"POST",body:eC(dZ(),ep()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new M("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...j}=c;if(!dB(d_,void 0).safeParse(e).success)throw new M("BAD_REQUEST",{message:iA.INVALID_EMAIL});let k=a.context.password.config.minPasswordLength;if(f.length<k)throw a.context.logger.error("Password is too short"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_SHORT});let l=a.context.password.config.maxPasswordLength;if(f.length>l)throw a.context.logger.error("Password is too long"),new M("BAD_REQUEST",{message:iA.PASSWORD_TOO_LONG});let m=await a.context.internalAdapter.findUserByEmail(e);if(m?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new M("UNPROCESSABLE_ENTITY",{message:iA.USER_ALREADY_EXISTS});let n=io(a.context.options,j),o=await a.context.password.hash(f);try{if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...n,emailVerified:!1},a)))throw new M("BAD_REQUEST",{message:iA.FAILED_TO_CREATE_USER})}catch(b){if(hW&&a.context.logger.error("Failed to create user",b),b instanceof M)throw b;throw new M("UNPROCESSABLE_ENTITY",{message:iA.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new M("UNPROCESSABLE_ENTITY",{message:iA.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:o},a),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await iI(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${c.callbackURL||"/"}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:b,url:e,token:d},a.request)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}});let p=await a.context.internalAdapter.createSession(b.id,a,!1===i);if(!p)throw new M("BAD_REQUEST",{message:iA.FAILED_TO_CREATE_SESSION});return await h9(a,{session:p,user:b},!1===i),a.json({token:p.token,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}})}),signInEmail:i0,forgetPassword:i6,resetPassword:i8,verifyEmail:iL,sendVerificationEmail:iK,changeEmail:jd,changePassword:i9,setPassword:ja,updateUser:iu("/update-user",{method:"POST",body:eC(dZ().meta({description:"Field name must be a string"}),ep()),use:[iD],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new M("BAD_REQUEST",{message:iA.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session;if(void 0===d&&void 0===c&&0===Object.keys(e).length)return a.json({status:!0});let g=io(a.context.options,e,"update"),h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g},a);return await h9(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:jb,forgetPasswordCallback:i7,requestPasswordReset:i5,requestPasswordResetCallback:i7,listSessions:iu("/list-sessions",{method:"GET",use:[iD],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:iF,revokeSessions:iG,revokeOtherSessions:iH,linkSocialAccount:jh,listUserAccounts:jg,deleteUserCallback:jc,unlinkAccount:ji,refreshToken:jk,getAccessToken:jj,accountInfo:jl},...c,ok:jf,error:je},a),middlewares:d}}let js=a=>{let b=a.plugins?.reduce((a,b)=>{let c=b.schema;if(!c)return a;for(let[b,d]of Object.entries(c))a[b]={fields:{...a[b]?.fields,...d.fields},modelName:d.modelName||b};return a},{}),c=a.rateLimit?.storage==="database",d={rateLimit:{modelName:a.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:a.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:a.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:a.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:e,session:f,account:g,...h}=b||{},i={session:{modelName:a.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:a.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:a.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:a.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:a.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:a.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:a.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:a.session?.fields?.userId||"userId",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...f?.fields,...a.session?.additionalFields},order:2}};return{user:{modelName:a.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:a.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:a.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:a.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:a.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.updatedAt||"updatedAt"},...e?.fields,...a.user?.additionalFields},order:1},...!a.secondaryStorage||a.session?.storeSessionInDatabase?i:{},account:{modelName:a.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:a.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:a.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:a.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:a.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:a.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:a.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:a.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:a.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:a.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:a.account?.fields?.updatedAt||"updatedAt"},...g?.fields},order:3},verification:{modelName:a.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:a.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:a.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:a.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:a.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:a.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...c?d:{}}};var jt=c(7880),ju=c(2325),jv=c(8706);function jw(a,b){return jv.z.createWithChildren([jv.z.createWithSql(`${a} `),ju.O.create(b)])}var jx=c(6331),jy=c(5788),jz=c(7717);class jA{#b;#c=new jC;#d;#e;constructor(a){this.#b=(0,jy.CN)({...a})}async init(){this.#d=(0,jy.Tn)(this.#b.database)?await this.#b.database():this.#b.database,this.#e=new jB(this.#d),this.#b.onCreateConnection&&await this.#b.onCreateConnection(this.#e)}async acquireConnection(){return await this.#c.lock(),this.#e}async beginTransaction(a){await a.executeQuery(jx.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(jx.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(jx.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(jw("savepoint",b),(0,jz.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(jw("rollback to",b),(0,jz.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(jw("release",b),(0,jz.a)()))}async releaseConnection(){this.#c.unlock()}async destroy(){this.#d?.close()}}class jB{#d;constructor(a){this.#d=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#d.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#d.prepare(c);if(jt.L.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class jC{#f;#g;async lock(){for(;this.#f;)await this.#f;this.#f=new Promise(a=>{this.#g=a})}unlock(){let a=this.#g;this.#f=void 0,this.#g=void 0,a?.()}}var jD=c(2368);let jE=/"/g;class jF extends jD.n{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(jE,'""')}visitDefaultInsertValue(a){this.append("null")}}var jG=c(9302),jH=c(5400);class jI{#d;constructor(a){this.#d=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#h(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#i(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",jG.kQ).where("name","!=",jG.sy)),c}async #h(a){let b=await this.#i(this.#d,a).execute(),c=await this.#d.with("table_list",b=>this.#i(b,a)).selectFrom(["table_list as tl",(0,jH.l)`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class jJ{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class jK extends jJ{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class jL{#b;constructor(a){this.#b=(0,jy.CN)({...a})}createDriver(){return new jA(this.#b)}createQueryCompiler(){return new jF}createAdapter(){return new jK}createIntrospector(a){return new jI(a)}}function jM(a,b){var c;if(c=a,(0,jy.Gv)(c)&&(0,jy.Kg)(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}let jN=Symbol();class jO{#b;#j=new WeakMap;#k;constructor(a){this.#b=(0,jy.CN)({...a})}async init(){this.#k=(0,jy.Tn)(this.#b.pool)?await this.#b.pool():this.#b.pool}async acquireConnection(){let a=await this.#l(),b=this.#j.get(a);return!b&&(b=new jP(a),this.#j.set(a,b),this.#b?.onCreateConnection&&await this.#b.onCreateConnection(b)),this.#b?.onReserveConnection&&await this.#b.onReserveConnection(b),b}async #l(){return new Promise((a,b)=>{this.#k.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(jx.E.raw(d))}await a.executeQuery(jx.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(jx.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(jx.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(jw("savepoint",b),(0,jz.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(jw("rollback to",b),(0,jz.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(jw("release savepoint",b),(0,jz.a)()))}async releaseConnection(a){a[jN]()}async destroy(){return new Promise((a,b)=>{this.#k.end(c=>{c?b(c):a()})})}}class jP{#m;constructor(a){this.#m=a}async executeQuery(a){try{let b=await this.#n(a);if((0,jy.Gv)(b)&&"insertId"in b&&"affectedRows"in b){let{insertId:a,affectedRows:c,changedRows:d}=b;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=c?BigInt(c):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(b))return{rows:b};return{rows:[]}}catch(a){throw jM(a,Error())}}#n(a){return new Promise((b,c)=>{this.#m.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#m.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[jN](){this.#m.release()}}let jQ=/`/g;class jR extends jD.n{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(jQ,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class jS{#d;constructor(a){this.#d=a}async getSchemas(){return(await this.#d.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#d.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",(0,jH.l)`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",jG.kQ).where("columns.TABLE_NAME","!=",jG.sy));let c=await b.execute();return this.#o(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#o(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.TABLE_NAME);return c||(c=(0,jy.CN)({name:b.TABLE_NAME,isView:"VIEW"===b.TABLE_TYPE,schema:b.TABLE_SCHEMA,columns:[]}),a.push(c)),c.columns.push((0,jy.CN)({name:b.COLUMN_NAME,dataType:b.DATA_TYPE,isNullable:"YES"===b.IS_NULLABLE,isAutoIncrementing:b.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==b.COLUMN_DEFAULT,comment:""===b.COLUMN_COMMENT?void 0:b.COLUMN_COMMENT})),a},[])}}let jT="ea586330-2c93-47c8-908d-981d9d270f9d";class jU extends jJ{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await (0,jH.l)`select get_lock(${jH.l.lit(jT)}, ${jH.l.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await (0,jH.l)`select release_lock(${jH.l.lit(jT)})`.execute(a)}}class jV{#b;constructor(a){this.#b=a}createDriver(){return new jO(this.#b)}createQueryCompiler(){return new jR}createAdapter(){return new jU}createIntrospector(a){return new jS(a)}}let jW=Symbol();class jX{#b;#j=new WeakMap;#k;constructor(a){this.#b=(0,jy.CN)({...a})}async init(){this.#k=(0,jy.Tn)(this.#b.pool)?await this.#b.pool():this.#b.pool}async acquireConnection(){let a=await this.#k.connect(),b=this.#j.get(a);return!b&&(b=new jY(a,{cursor:this.#b.cursor??null}),this.#j.set(a,b),this.#b.onCreateConnection&&await this.#b.onCreateConnection(b)),this.#b.onReserveConnection&&await this.#b.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(jx.E.raw(c))}else await a.executeQuery(jx.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(jx.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(jx.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(jw("savepoint",b),(0,jz.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(jw("rollback to",b),(0,jz.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(jw("release",b),(0,jz.a)()))}async releaseConnection(a){a[jW]()}async destroy(){if(this.#k){let a=this.#k;this.#k=void 0,await a.end()}}}class jY{#p;#q;constructor(a,b){this.#p=a,this.#q=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#p.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw jM(a,Error())}}async *streamQuery(a,b){if(!this.#q.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#p.query(new this.#q.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[jW](){this.#p.release()}}class jZ{#d;constructor(a){this.#d=a}async getSchemas(){return(await this.#d.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#d.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",(0,jH.l)`col_description(a.attrelid, a.attnum)`.as("column_description"),(0,jH.l)`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",jG.kQ).where("c.relname","!=",jG.sy));let c=await b.execute();return this.#o(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#o(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=(0,jy.CN)({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push((0,jy.CN)({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}let j$=/"/g;class j_ extends jD.n{sanitizeIdentifier(a){return a.replace(j$,'""')}}let j0=BigInt("3853314791062309107");class j1 extends jJ{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await (0,jH.l)`select pg_advisory_xact_lock(${jH.l.lit(j0)})`.execute(a)}async releaseMigrationLock(a,b){}}class j2{#b;constructor(a){this.#b=a}createDriver(){return new jX(this.#b)}createQueryCompiler(){return new j_}createAdapter(){return new j1}createIntrospector(a){return new jZ(a)}}class j3 extends jJ{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await (0,jH.l)`exec sp_getapplock @DbPrincipal = ${jH.l.lit("dbo")}, @Resource = ${jH.l.lit(jG.kQ)}, @LockMode = ${jH.l.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var j4=c(1584),j5=c(7004);let j6=Symbol(),j7=Symbol(),j8=Symbol();class j9{#b;#k;constructor(a){this.#b=(0,jy.CN)({...a});let{tarn:b,tedious:c,validateConnections:d}=this.#b,{validateConnections:e,...f}=b.options;this.#k=new b.Pool({...f,create:async()=>{let a=await c.connectionFactory();return await new ka(a,c).connect()},destroy:async a=>{await a[j7]()},validate:!1===d||!1===e?void 0:a=>a[j8]()})}async init(){}async acquireConnection(){return await this.#k.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#b.resetConnectionsOnRelease||this.#b.tedious.resetConnectionOnRelease)&&await a[j6](),this.#k.release(a)}async destroy(){await this.#k.destroy()}}class ka{#e;#r;#s;constructor(a,b){this.#e=a,this.#r=!1,this.#s=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#e.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,j4.D)(8):void 0,b?this.#t(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#e.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new j5.c;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#e.connect(a=>{if(a)return b(a);c()}),this.#e.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#r=!0),console.error(a),b(a)}),this.#e.once("end",d),await a,this.#e.off("end",d),this}async executeQuery(a){try{let b=new j5.c,c=new kb({compiledQuery:a,tedious:this.#s,onDone:b});this.#e.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw jM(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#e.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#e.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new kb({compiledQuery:a,streamChunkSize:b,tedious:this.#s});this.#e.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#u(c)}}#t(a){let{ISOLATION_LEVEL:b}=this.#s,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#u(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#e.cancel()||(a.request.off("requestCompleted",b),b())})}[j7](){return"closed"in this.#e&&this.#e.closed?Promise.resolve():new Promise(a=>{this.#e.once("end",a),this.#e.close()})}async [j6](){await new Promise((a,b)=>{this.#e.reset(c=>{if(c)return b(c);a()})})}async [j8](){if(this.#r||this.#v())return!1;try{let a=new j5.c,b=new kb({compiledQuery:jx.E.raw("select 1"),onDone:a,tedious:this.#s});return this.#e.execSql(b.request),await a.promise,!0}catch{return!1}}#v(){return"closed"in this.#e&&!!this.#e.closed}}class kb{#w;#x;#y;#z;#s;#A;constructor(a){let{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#x=[],this.#y=d,this.#z={},this.#s=e,c){let a="onDone";this.#z[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#z[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#A,rows:this.#x})}}}this.#w=new this.#s.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#z).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#A=b}),this.#B(b.parameters),this.#C()}get request(){return this.#w}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#z[a]=(d,e)=>{if(delete this.#z[a],"error"===d)return c(e);b(this.#x.splice(0,this.#y))},this.#w.resume()})}#B(a){for(let b=0;b<a.length;b++){let c=a[b];this.#w.addParameter(String(b+1),this.#D(c),c)}}#C(){let a=this.#y?()=>{this.#y<=this.#x.length&&(this.#w.pause(),Object.values(this.#z).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#x.push(c),a()};this.#w.on("row",b),this.#w.once("requestCompleted",()=>{Object.values(this.#z).forEach(a=>a("completed")),this.#w.off("row",b)})}#D(a){if((0,jy.kZ)(a)||(0,jy.b0)(a)||(0,jy.Kg)(a))return this.#s.TYPES.NVarChar;if((0,jy.sI)(a)||(0,jy.Et)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#s.TYPES.BigInt;else return this.#s.TYPES.Int;return(0,jy.Et)(a)?this.#s.TYPES.Float:(0,jy.Lm)(a)?this.#s.TYPES.Bit:(0,jy.$P)(a)?this.#s.TYPES.DateTime:(0,jy.Pe)(a)?this.#s.TYPES.VarBinary:this.#s.TYPES.NVarChar}}class kc{#d;constructor(a){this.#d=a}async getSchemas(){return await this.#d.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let b=await this.#d.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",jG.kQ).where("tables.name","!=",jG.sy)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#d.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),c={};for(let a of b){let b=`${a.table_schema_name}.${a.table_name}`;(c[b]=c[b]||(0,jy.CN)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,jy.CN)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(c)}async getMetadata(a){return{tables:await this.getTables(a)}}}let kd=/^[a-z0-9_]$/i;class ke extends jD.n{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!kd.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class kf{#b;constructor(a){this.#b=a}createDriver(){return new j9(this.#b)}createQueryCompiler(){return new ke}createAdapter(){return new j3}createIntrospector(a){return new kc(a)}}let kg=(0,jy.CN)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,jy.CN)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>(0,jy.CN)({...a,...b}),cloneWithColumnAlteration:(a,b)=>(0,jy.CN)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),kh=(0,jy.CN)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,jy.CN)({kind:"CreateIndexNode",name:ju.O.create(a)}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,jy.CN)({...a,columns:[...a.columns||[],...b]})}),ki=(0,jy.CN)({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"CreateSchemaNode",schema:ju.O.create(a),...b}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});var kj=c(5144),kk=c(7668);let kl=(0,jy.CN)({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"DropIndexNode",name:kk.y.create(a),...b}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),km=(0,jy.CN)({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"DropSchemaNode",schema:ju.O.create(a),...b}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),kn=(0,jy.CN)({is:a=>"DropTableNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});var ko=c(9758);let kp=(0,jy.CN)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,jy.CN)({kind:"AddColumnNode",column:a})});var kq=c(1078);let kr=(0,jy.CN)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"ColumnDefinitionNode",column:kq.Z.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>(0,jy.CN)({...a,frontModifiers:a.frontModifiers?(0,jy.CN)([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>(0,jy.CN)({...a,endModifiers:a.endModifiers?(0,jy.CN)([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),ks=(0,jy.CN)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,jy.CN)({kind:"DropColumnNode",column:kq.Z.create(a)})}),kt=(0,jy.CN)({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"RenameColumnNode",column:kq.Z.create(a),renameTo:kq.Z.create(b)})}),ku=(0,jy.CN)({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"CheckConstraintNode",expression:a,name:b?ju.O.create(b):void 0})}),kv=["no action","restrict","cascade","set null","set default"],kw=(0,jy.CN)({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"ReferencesNode",table:a,columns:(0,jy.CN)([...b])}),cloneWithOnDelete:(a,b)=>(0,jy.CN)({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>(0,jy.CN)({...a,onUpdate:b})});var kx=c(6502),ky=c(4757),kz=c(9865),kA=c(2863);function kB(a){return(0,kz.N)(a)?a.toOperationNode():kA.q.createImmediate(a)}let kC=(0,jy.CN)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,jy.CN)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,jy.CN)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),kD=(0,jy.CN)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,jy.CN)({kind:"DefaultValueNode",defaultValue:a})});function kE(a){if(kv.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class kF{#E;constructor(a){this.#E=a}autoIncrement(){return new kF(kr.cloneWith(this.#E,{autoIncrement:!0}))}identity(){return new kF(kr.cloneWith(this.#E,{identity:!0}))}primaryKey(){return new kF(kr.cloneWith(this.#E,{primaryKey:!0}))}references(a){let b=(0,ky.q5)(a);if(!b.table||kx.U.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new kF(kr.cloneWith(this.#E,{references:kw.create(b.table,[b.column])}))}onDelete(a){if(!this.#E.references)throw Error("on delete constraint can only be added for foreign keys");return new kF(kr.cloneWith(this.#E,{references:kw.cloneWithOnDelete(this.#E.references,kE(a))}))}onUpdate(a){if(!this.#E.references)throw Error("on update constraint can only be added for foreign keys");return new kF(kr.cloneWith(this.#E,{references:kw.cloneWithOnUpdate(this.#E.references,kE(a))}))}unique(){return new kF(kr.cloneWith(this.#E,{unique:!0}))}notNull(){return new kF(kr.cloneWith(this.#E,{notNull:!0}))}unsigned(){return new kF(kr.cloneWith(this.#E,{unsigned:!0}))}defaultTo(a){return new kF(kr.cloneWith(this.#E,{defaultTo:kD.create(kB(a))}))}check(a){return new kF(kr.cloneWith(this.#E,{check:ku.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new kF(kr.cloneWith(this.#E,{generated:kC.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new kF(kr.cloneWith(this.#E,{generated:kC.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new kF(kr.cloneWith(this.#E,{generated:kC.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#E.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new kF(kr.cloneWith(this.#E,{generated:kC.cloneWith(this.#E.generated,{stored:!0})}))}modifyFront(a){return new kF(kr.cloneWithFrontModifier(this.#E,a.toOperationNode()))}nullsNotDistinct(){return new kF(kr.cloneWith(this.#E,{nullsNotDistinct:!0}))}ifNotExists(){return new kF(kr.cloneWith(this.#E,{ifNotExists:!0}))}modifyEnd(a){return new kF(kr.cloneWithEndModifier(this.#E,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#E}}let kG=(0,jy.CN)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,jy.CN)({kind:"ModifyColumnNode",column:a})});var kH=c(3859);let kI=(0,jy.CN)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>(0,jy.CN)({kind:"ForeignKeyConstraintNode",columns:a,references:kw.create(b,c),name:d?ju.O.create(d):void 0}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});class kJ{#E;constructor(a){this.#E=a}onDelete(a){return new kJ(kI.cloneWith(this.#E,{onDelete:kE(a)}))}onUpdate(a){return new kJ(kI.cloneWith(this.#E,{onUpdate:kE(a)}))}deferrable(){return new kJ(kI.cloneWith(this.#E,{deferrable:!0}))}notDeferrable(){return new kJ(kI.cloneWith(this.#E,{deferrable:!1}))}initiallyDeferred(){return new kJ(kI.cloneWith(this.#E,{initiallyDeferred:!0}))}initiallyImmediate(){return new kJ(kI.cloneWith(this.#E,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#E}}let kK=(0,jy.CN)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,jy.CN)({kind:"AddConstraintNode",constraint:a})}),kL=(0,jy.CN)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>(0,jy.CN)({kind:"UniqueConstraintNode",columns:(0,jy.CN)(a.map(kq.Z.create)),name:b?ju.O.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),kM=(0,jy.CN)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,jy.CN)({kind:"DropConstraintNode",constraintName:ju.O.create(a)}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),kN=(0,jy.CN)({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>(0,jy.CN)({kind:"AlterColumnNode",column:kq.Z.create(a),[b]:c})});class kO{#F;constructor(a){this.#F=a}setDataType(a){return new kP(kN.create(this.#F,"dataType",(0,kH.Q)(a)))}setDefault(a){return new kP(kN.create(this.#F,"setDefault",kB(a)))}dropDefault(){return new kP(kN.create(this.#F,"dropDefault",!0))}setNotNull(){return new kP(kN.create(this.#F,"setNotNull",!0))}dropNotNull(){return new kP(kN.create(this.#F,"dropNotNull",!0))}$call(a){return a(this)}}class kP{#G;constructor(a){this.#G=a}toOperationNode(){return this.#G}}class kQ{#a;constructor(a){this.#a=(0,jy.CN)(a)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class kR{#a;constructor(a){this.#a=(0,jy.CN)(a)}onDelete(a){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.onDelete(a)})}onUpdate(a){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.onUpdate(a)})}deferrable(){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.deferrable()})}notDeferrable(){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new kR({...this.#a,constraintBuilder:this.#a.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(kg.cloneWithTableProps(this.#a.node,{addConstraint:kK.create(this.#a.constraintBuilder.toOperationNode())}),this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class kS{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifExists(){return new kS({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{dropConstraint:kM.cloneWith(this.#a.node.dropConstraint,{ifExists:!0})})})}cascade(){return new kS({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{dropConstraint:kM.cloneWith(this.#a.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new kS({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{dropConstraint:kM.cloneWith(this.#a.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}let kT=(0,jy.CN)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"PrimaryKeyConstraintNode",columns:(0,jy.CN)(a.map(kq.Z.create)),name:b?ju.O.create(b):void 0}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})}),kU=(0,jy.CN)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,jy.CN)({kind:"AddIndexNode",name:ju.O.create(a)}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,jy.CN)({...a,columns:[...a.columns||[],...b]})});class kV{#a;constructor(a){this.#a=(0,jy.CN)(a)}unique(){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.cloneWith(this.#a.node.addIndex,{unique:!0})})})}column(a){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.cloneWithColumns(this.#a.node.addIndex,[(0,ky.Ow)(a)])})})}columns(a){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.cloneWithColumns(this.#a.node.addIndex,a.map(ky.Ow))})})}expression(a){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.cloneWithColumns(this.#a.node.addIndex,[a.toOperationNode()])})})}using(a){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.cloneWith(this.#a.node.addIndex,{using:jv.z.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class kW{#E;constructor(a){this.#E=a}nullsNotDistinct(){return new kW(kL.cloneWith(this.#E,{nullsNotDistinct:!0}))}deferrable(){return new kW(kL.cloneWith(this.#E,{deferrable:!0}))}notDeferrable(){return new kW(kL.cloneWith(this.#E,{deferrable:!1}))}initiallyDeferred(){return new kW(kL.cloneWith(this.#E,{initiallyDeferred:!0}))}initiallyImmediate(){return new kW(kL.cloneWith(this.#E,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#E}}class kX{#E;constructor(a){this.#E=a}deferrable(){return new kX(kT.cloneWith(this.#E,{deferrable:!0}))}notDeferrable(){return new kX(kT.cloneWith(this.#E,{deferrable:!1}))}initiallyDeferred(){return new kX(kT.cloneWith(this.#E,{initiallyDeferred:!0}))}initiallyImmediate(){return new kX(kT.cloneWith(this.#E,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#E}}class kY{#E;constructor(a){this.#E=a}$call(a){return a(this)}toOperationNode(){return this.#E}}let kZ=(0,jy.CN)({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>(0,jy.CN)({kind:"RenameConstraintNode",oldName:ju.O.create(a),newName:ju.O.create(b)})});class k${#a;constructor(a){this.#a=(0,jy.CN)(a)}renameTo(a){return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{renameTo:(0,ko.M$)(a)})})}setSchema(a){return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{setSchema:ju.O.create(a)})})}alterColumn(a,b){let c=b(new kO(a));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,c.toOperationNode())})}dropColumn(a){return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,ks.create(a))})}renameColumn(a,b){return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kt.create(a,b))})}addColumn(a,b,c=jy.lQ){let d=c(new kF(kr.create(a,(0,kH.Q)(b))));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kp.create(d.toOperationNode()))})}modifyColumn(a,b,c=jy.lQ){let d=c(new kF(kr.create(a,(0,kH.Q)(b))));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kG.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=jy.lQ){let d=c(new kW(kL.create(b,a)));return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addConstraint:kK.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=jy.lQ){let d=c(new kY(ku.create(b.toOperationNode(),a)));return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addConstraint:kK.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=jy.lQ){let f=e(new kJ(kI.create(b.map(kq.Z.create),(0,ko.M$)(c),d.map(kq.Z.create),a)));return new kR({...this.#a,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=jy.lQ){let d=c(new kX(kT.create(b,a)));return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addConstraint:kK.create(d.toOperationNode())})})}dropConstraint(a){return new kS({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{dropConstraint:kM.create(a)})})}renameConstraint(a,b){return new kS({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{renameConstraint:kZ.create(a,b)})})}addIndex(a){return new kV({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{addIndex:kU.create(a)})})}dropIndex(a){return new kQ({...this.#a,node:kg.cloneWithTableProps(this.#a.node,{dropIndex:kl.create(a)})})}$call(a){return a(this)}}class k_{#a;constructor(a){this.#a=(0,jy.CN)(a)}alterColumn(a,b){let c=b(new kO(a));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,c.toOperationNode())})}dropColumn(a){return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,ks.create(a))})}renameColumn(a,b){return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kt.create(a,b))})}addColumn(a,b,c=jy.lQ){let d=c(new kF(kr.create(a,(0,kH.Q)(b))));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kp.create(d.toOperationNode()))})}modifyColumn(a,b,c=jy.lQ){let d=c(new kF(kr.create(a,(0,kH.Q)(b))));return new k_({...this.#a,node:kg.cloneWithColumnAlteration(this.#a.node,kG.create(d.toOperationNode()))})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}var k0=c(9411),k1=c(2618),k2=c(7052),k3=c(7460);class k4 extends k2.V{transformPrimitiveValueList(a){return k3.s.create(a.values.map(kA.q.createImmediate))}transformValue(a){return kA.q.createImmediate(a.value)}}class k5{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifNotExists(){return new k5({...this.#a,node:kh.cloneWith(this.#a.node,{ifNotExists:!0})})}unique(){return new k5({...this.#a,node:kh.cloneWith(this.#a.node,{unique:!0})})}nullsNotDistinct(){return new k5({...this.#a,node:kh.cloneWith(this.#a.node,{nullsNotDistinct:!0})})}on(a){return new k5({...this.#a,node:kh.cloneWith(this.#a.node,{table:(0,ko.M$)(a)})})}column(a){return new k5({...this.#a,node:kh.cloneWithColumns(this.#a.node,[(0,ky.Ow)(a)])})}columns(a){return new k5({...this.#a,node:kh.cloneWithColumns(this.#a.node,a.map(ky.Ow))})}expression(a){return new k5({...this.#a,node:kh.cloneWithColumns(this.#a.node,[a.toOperationNode()])})}using(a){return new k5({...this.#a,node:kh.cloneWith(this.#a.node,{using:jv.z.createWithSql(a)})})}where(...a){let b=new k4;return new k5({...this.#a,node:k1.L.cloneWithWhere(this.#a.node,b.transformNode((0,k0.GB)(a),this.#a.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class k6{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifNotExists(){return new k6({...this.#a,node:ki.cloneWith(this.#a.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}var k7=c(5397);class k8{#a;constructor(a){this.#a=(0,jy.CN)(a)}temporary(){return new k8({...this.#a,node:kj.B.cloneWith(this.#a.node,{temporary:!0})})}onCommit(a){return new k8({...this.#a,node:kj.B.cloneWith(this.#a.node,{onCommit:function(a){if(kj.o.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new k8({...this.#a,node:kj.B.cloneWith(this.#a.node,{ifNotExists:!0})})}addColumn(a,b,c=jy.lQ){let d=c(new kF(kr.create(a,(0,kH.Q)(b))));return new k8({...this.#a,node:kj.B.cloneWithColumn(this.#a.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=jy.lQ){let d=c(new kX(kT.create(b,a)));return new k8({...this.#a,node:kj.B.cloneWithConstraint(this.#a.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=jy.lQ){let d=c(new kW(kL.create(b,a)));return new k8({...this.#a,node:kj.B.cloneWithConstraint(this.#a.node,d.toOperationNode())})}addCheckConstraint(a,b,c=jy.lQ){let d=c(new kY(ku.create(b.toOperationNode(),a)));return new k8({...this.#a,node:kj.B.cloneWithConstraint(this.#a.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=jy.lQ){let f=e(new kJ(kI.create(b.map(kq.Z.create),(0,ko.M$)(c),d.map(kq.Z.create),a)));return new k8({...this.#a,node:kj.B.cloneWithConstraint(this.#a.node,f.toOperationNode())})}modifyFront(a){return new k8({...this.#a,node:kj.B.cloneWithFrontModifier(this.#a.node,a.toOperationNode())})}modifyEnd(a){return new k8({...this.#a,node:kj.B.cloneWithEndModifier(this.#a.node,a.toOperationNode())})}as(a){return new k8({...this.#a,node:kj.B.cloneWith(this.#a.node,{selectQuery:(0,k7.YK)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class k9{#a;constructor(a){this.#a=(0,jy.CN)(a)}on(a){return new k9({...this.#a,node:kl.cloneWith(this.#a.node,{table:(0,ko.M$)(a)})})}ifExists(){return new k9({...this.#a,node:kl.cloneWith(this.#a.node,{ifExists:!0})})}cascade(){return new k9({...this.#a,node:kl.cloneWith(this.#a.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class la{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifExists(){return new la({...this.#a,node:km.cloneWith(this.#a.node,{ifExists:!0})})}cascade(){return new la({...this.#a,node:km.cloneWith(this.#a.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class lb{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifExists(){return new lb({...this.#a,node:kn.cloneWith(this.#a.node,{ifExists:!0})})}cascade(){return new lb({...this.#a,node:kn.cloneWith(this.#a.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}var lc=c(8789),ld=c(4586);class le{#H=new k4;transformQuery(a){return this.#H.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class lf{#a;constructor(a){this.#a=(0,jy.CN)(a)}temporary(){return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{temporary:!0})})}materialized(){return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{materialized:!0})})}ifNotExists(){return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{ifNotExists:!0})})}orReplace(){return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{orReplace:!0})})}columns(a){return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{columns:a.map(ky.RY)})})}as(a){let b=a.withPlugin(new le).toOperationNode();return new lf({...this.#a,node:ld.Y.cloneWith(this.#a.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}let lg=(0,jy.CN)({is:a=>"DropViewNode"===a.kind,create:a=>(0,jy.CN)({kind:"DropViewNode",name:kk.y.create(a)}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});class lh{#a;constructor(a){this.#a=(0,jy.CN)(a)}materialized(){return new lh({...this.#a,node:lg.cloneWith(this.#a.node,{materialized:!0})})}ifExists(){return new lh({...this.#a,node:lg.cloneWith(this.#a.node,{ifExists:!0})})}cascade(){return new lh({...this.#a,node:lg.cloneWith(this.#a.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}let li=(0,jy.CN)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,jy.CN)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>(0,jy.CN)({...a,enum:k3.s.create(b.map(kA.q.createImmediate))})});class lj{#a;constructor(a){this.#a=(0,jy.CN)(a)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}asEnum(a){return new lj({...this.#a,node:li.cloneWithEnum(this.#a.node,a)})}$call(a){return a(this)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}let lk=(0,jy.CN)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,jy.CN)({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});class ll{#a;constructor(a){this.#a=(0,jy.CN)(a)}ifExists(){return new ll({...this.#a,node:lk.cloneWith(this.#a.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}function lm(a){if(!a.includes("."))return kk.y.create(a);{let b=a.split(".").map(ln);if(2===b.length)return kk.y.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function ln(a){return a.trim()}let lo=(0,jy.CN)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,jy.CN)({kind:"RefreshMaterializedViewNode",name:kk.y.create(a)}),cloneWith:(a,b)=>(0,jy.CN)({...a,...b})});class lp{#a;constructor(a){this.#a=(0,jy.CN)(a)}concurrently(){return new lp({...this.#a,node:lo.cloneWith(this.#a.node,{concurrently:!0,withNoData:!1})})}withData(){return new lp({...this.#a,node:lo.cloneWith(this.#a.node,{withNoData:!1})})}withNoData(){return new lp({...this.#a,node:lo.cloneWith(this.#a.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#a.executor.transformQuery(this.#a.node,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){await this.#a.executor.executeQuery(this.compile())}}class lq{#I;constructor(a){this.#I=a}createTable(a){return new k8({queryId:(0,jz.a)(),executor:this.#I,node:kj.B.create((0,ko.M$)(a))})}dropTable(a){return new lb({queryId:(0,jz.a)(),executor:this.#I,node:kn.create((0,ko.M$)(a))})}createIndex(a){return new k5({queryId:(0,jz.a)(),executor:this.#I,node:kh.create(a)})}dropIndex(a){return new k9({queryId:(0,jz.a)(),executor:this.#I,node:kl.create(a)})}createSchema(a){return new k6({queryId:(0,jz.a)(),executor:this.#I,node:ki.create(a)})}dropSchema(a){return new la({queryId:(0,jz.a)(),executor:this.#I,node:km.create(a)})}alterTable(a){return new k$({queryId:(0,jz.a)(),executor:this.#I,node:kg.create((0,ko.M$)(a))})}createView(a){return new lf({queryId:(0,jz.a)(),executor:this.#I,node:ld.Y.create(a)})}refreshMaterializedView(a){return new lp({queryId:(0,jz.a)(),executor:this.#I,node:lo.create(a)})}dropView(a){return new lh({queryId:(0,jz.a)(),executor:this.#I,node:lg.create(a)})}createType(a){return new lj({queryId:(0,jz.a)(),executor:this.#I,node:li.create(lm(a))})}dropType(a){return new ll({queryId:(0,jz.a)(),executor:this.#I,node:lk.create(lm(a))})}withPlugin(a){return new lq(this.#I.withPlugin(a))}withoutPlugins(){return new lq(this.#I.withoutPlugins())}withSchema(a){return new lq(this.#I.withPluginAtFront(new lc.B(a)))}}var lr=c(3995),ls=c(2102);class lt{ref(a){return new lr.g(a)}table(a){return new ls.bj(a)}}class lu{#J;constructor(a){this.#J=a}async provideConnection(a){let b=await this.#J.acquireConnection();try{return await a(b)}finally{await this.#J.releaseConnection(b)}}}var lv=c(7515),lw=c(6569);class lx extends lw.R{#K;#L;#M;constructor(a,b,c,d=[]){super(d),this.#K=a,this.#L=b,this.#M=c}get adapter(){return this.#L}compileQuery(a,b){return this.#K.compileQuery(a,b)}provideConnection(a){return this.#M.provideConnection(a)}withPlugins(a){return new lx(this.#K,this.#L,this.#M,[...this.plugins,...a])}withPlugin(a){return new lx(this.#K,this.#L,this.#M,[...this.plugins,a])}withPluginAtFront(a){return new lx(this.#K,this.#L,this.#M,[a,...this.plugins])}withConnectionProvider(a){return new lx(this.#K,this.#L,a,[...this.plugins])}withoutPlugins(){return new lx(this.#K,this.#L,this.#M,[])}}function ly(){return"undefined"!=typeof performance&&(0,jy.Tn)(performance.now)?performance.now():Date.now()}class lz{#J;#N;#O;#P;#Q;#j=new WeakSet;constructor(a,b){this.#P=!1,this.#J=a,this.#N=b}async init(){if(this.#Q)throw Error("driver has already been destroyed");this.#O||(this.#O=this.#J.init().then(()=>{this.#P=!0}).catch(a=>(this.#O=void 0,Promise.reject(a)))),await this.#O}async acquireConnection(){if(this.#Q)throw Error("driver has already been destroyed");this.#P||await this.init();let a=await this.#J.acquireConnection();return this.#j.has(a)||(this.#R()&&this.#S(a),this.#j.add(a)),a}async releaseConnection(a){await this.#J.releaseConnection(a)}beginTransaction(a,b){return this.#J.beginTransaction(a,b)}commitTransaction(a){return this.#J.commitTransaction(a)}rollbackTransaction(a){return this.#J.rollbackTransaction(a)}savepoint(a,b,c){if(this.#J.savepoint)return this.#J.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#J.rollbackToSavepoint)return this.#J.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#J.releaseSavepoint)return this.#J.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#O&&(await this.#O,this.#Q||(this.#Q=this.#J.destroy().catch(a=>(this.#Q=void 0,Promise.reject(a)))),await this.#Q)}#R(){return this.#N.isLevelEnabled("query")||this.#N.isLevelEnabled("error")}#S(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=ly();try{return await b.call(a,c)}catch(a){throw e=a,await d.#T(a,c,f),a}finally{e||await d.#U(c,f)}},a.streamQuery=async function*(b,e){let f,g=ly();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#T(a,b,g),a}finally{f||await d.#U(b,g,!0)}}}async #T(a,b,c){await this.#N.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#V(c)}))}async #U(a,b,c=!1){await this.#N.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#V(b)}))}#V(a){return ly()-a}}let lA=()=>{};class lB{#e;#W;constructor(a){this.#e=a}async provideConnection(a){for(;this.#W;)await this.#W.catch(lA);return this.#W=this.#X(a).finally(()=>{this.#W=void 0}),this.#W}async #X(a){return await a(this.#e)}}let lC=["read only","read write"],lD=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function lE(a){if(a.accessMode&&!lC.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!lD.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var lF=c(7655);(0,jy.CN)(["query","error"]);class lG{#Y;#Z;constructor(a){(0,jy.Tn)(a)?(this.#Z=a,this.#Y=(0,jy.CN)({query:!0,error:!0})):(this.#Z=lH,this.#Y=(0,jy.CN)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#Y[a]}async query(a){this.#Y.query&&await this.#Z(a())}async error(a){this.#Y.error&&await this.#Z(a())}}function lH(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var lI=c(813),lJ=c(3300),lK=c(2642),lL=c(5147);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class lM extends lv.n{#a;constructor(a){let b,c;if(function(a){return(0,jy.Gv)(a)&&(0,jy.Gv)(a.config)&&(0,jy.Gv)(a.driver)&&(0,jy.Gv)(a.executor)&&(0,jy.Gv)(a.dialect)}(a))b={executor:a.executor},c={...a};else{let d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new lz(e,new lG(a.log??[])),i=new lx(f,g,new lu(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#a=(0,jy.CN)(c)}get schema(){return new lq(this.#a.executor)}get dynamic(){return new lt}get introspection(){return this.#a.dialect.createIntrospector(this.withoutPlugins())}case(a){return new lI.OU({node:lJ.P.create((0,jy.b0)(a)?void 0:(0,k7.YK)(a))})}get fn(){return(0,lF.t)()}transaction(){return new lP({...this.#a})}startTransaction(){return new lQ({...this.#a})}connection(){return new lO({...this.#a})}withPlugin(a){return new lM({...this.#a,executor:this.#a.executor.withPlugin(a)})}withoutPlugins(){return new lM({...this.#a,executor:this.#a.executor.withoutPlugins()})}withSchema(a){return new lM({...this.#a,executor:this.#a.executor.withPluginAtFront(new lc.B(a))})}withTables(){return new lM({...this.#a})}async destroy(){await this.#a.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#a.executor}executeQuery(a,b){void 0!==b&&(0,lL.u)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let c=(0,jy.Gv)(a)&&(0,jy.Tn)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c)}async [Symbol.asyncDispose](){await this.destroy()}}class lN extends lM{#a;constructor(a){super(a),this.#a=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new lN({...this.#a,executor:this.#a.executor.withPlugin(a)})}withoutPlugins(){return new lN({...this.#a,executor:this.#a.executor.withoutPlugins()})}withSchema(a){return new lN({...this.#a,executor:this.#a.executor.withPluginAtFront(new lc.B(a))})}withTables(){return new lN({...this.#a})}}class lO{#a;constructor(a){this.#a=(0,jy.CN)(a)}async execute(a){return this.#a.executor.provideConnection(async b=>{let c=this.#a.executor.withConnectionProvider(new lB(b)),d=new lM({...this.#a,executor:c});return await a(d)})}}class lP{#a;constructor(a){this.#a=(0,jy.CN)(a)}setAccessMode(a){return new lP({...this.#a,accessMode:a})}setIsolationLevel(a){return new lP({...this.#a,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#a,e={isolationLevel:b,accessMode:c};return lE(e),this.#a.executor.provideConnection(async b=>{let c=this.#a.executor.withConnectionProvider(new lB(b)),f=new lN({...d,executor:c});try{await this.#a.driver.beginTransaction(b,e);let c=await a(f);return await this.#a.driver.commitTransaction(b),c}catch(a){throw await this.#a.driver.rollbackTransaction(b),a}})}}class lQ{#a;constructor(a){this.#a=(0,jy.CN)(a)}setAccessMode(a){return new lQ({...this.#a,accessMode:a})}setIsolationLevel(a){return new lQ({...this.#a,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#a,d={isolationLevel:a,accessMode:b};lE(d);let e=await (0,lK.G)(this.#a.executor);return await this.#a.driver.beginTransaction(e.connection,d),new lR({...c,connection:e,executor:this.#a.executor.withConnectionProvider(new lB(e.connection))})}}class lR extends lN{#a;#$;#_;constructor(a){let b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new lU(a.executor,b)};super(d),this.#a=(0,jy.CN)(a),this.#_=b;let e=(0,jz.a)();this.#$=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#_.isCommitted}get isRolledBack(){return this.#_.isRolledBack}commit(){return lT(this.#_),new lS(async()=>{await this.#a.driver.commitTransaction(this.#a.connection.connection),this.#_.isCommitted=!0,this.#a.connection.release()})}rollback(){return lT(this.#_),new lS(async()=>{await this.#a.driver.rollbackTransaction(this.#a.connection.connection),this.#_.isRolledBack=!0,this.#a.connection.release()})}savepoint(a){return lT(this.#_),new lS(async()=>(await this.#a.driver.savepoint?.(this.#a.connection.connection,a,this.#$),new lR({...this.#a})))}rollbackToSavepoint(a){return lT(this.#_),new lS(async()=>(await this.#a.driver.rollbackToSavepoint?.(this.#a.connection.connection,a,this.#$),new lR({...this.#a})))}releaseSavepoint(a){return lT(this.#_),new lS(async()=>(await this.#a.driver.releaseSavepoint?.(this.#a.connection.connection,a,this.#$),new lR({...this.#a})))}withPlugin(a){return new lR({...this.#a,executor:this.#a.executor.withPlugin(a)})}withoutPlugins(){return new lR({...this.#a,executor:this.#a.executor.withoutPlugins()})}withSchema(a){return new lR({...this.#a,executor:this.#a.executor.withPluginAtFront(new lc.B(a))})}withTables(){return new lR({...this.#a})}}class lS{#aa;constructor(a){this.#aa=a}async execute(){return await this.#aa()}}function lT(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class lU{#I;#_;constructor(a,b){a instanceof lU?this.#I=a.#I:this.#I=a,this.#_=b}get adapter(){return this.#I.adapter}get plugins(){return this.#I.plugins}transformQuery(a,b){return this.#I.transformQuery(a,b)}compileQuery(a,b){return this.#I.compileQuery(a,b)}provideConnection(a){return this.#I.provideConnection(a)}executeQuery(a){return lT(this.#_),this.#I.executeQuery(a)}stream(a,b){return lT(this.#_),this.#I.stream(a,b)}withConnectionProvider(a){return new lU(this.#I.withConnectionProvider(a),this.#_)}withPlugin(a){return new lU(this.#I.withPlugin(a),this.#_)}withPlugins(a){return new lU(this.#I.withPlugins(a),this.#_)}withPluginAtFront(a){return new lU(this.#I.withPluginAtFront(a),this.#_)}withoutPlugins(){return new lU(this.#I.withoutPlugins(),this.#_)}}let lV=[],lW=-1,lX={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{yellow:"\x1b[33m",magenta:"\x1b[35m"},bg:{black:"\x1b[40m"}},lY=({adapter:a,config:b})=>c=>{let d={...b,supportsBooleans:b.supportsBooleans??!0,supportsDates:b.supportsDates??!0,supportsJSON:b.supportsJSON??!1,adapterName:b.adapterName??b.adapterId,supportsNumericIds:b.supportsNumericIds??!0};if(c.advanced?.database?.useNumberId===!0&&!1===d.supportsNumericIds)throw Error(`[${d.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let e=js(c),f=({field:a,model:b})=>{if("id"===a||"_id"===a)return"id";let c=g(b),d=e[c]?.fields[a];if(d||(d=Object.values(e[c]?.fields).find(b=>b.fieldName===a)),!d)throw j(`Field ${a} not found in model ${c}`),j("Schema:",e),Error(`Field ${a} not found in model ${c}`);return a},g=a=>{if(d.usePlural&&"s"===a.charAt(a.length-1)){let b=a.slice(0,-1),c=e[b]?b:void 0;if(c||(c=Object.entries(e).find(([a,c])=>c.modelName===b)?.[0]),c)return c}let b=e[a]?a:void 0;if(b||(b=Object.entries(e).find(([b,c])=>c.modelName===a)?.[0]),!b)throw j(`Model "${a}" not found in schema`),j("Schema:",e),Error(`Model "${a}" not found in schema`);return b},h=a=>{let b=g(a),c=d&&d.usePlural;return e&&e[b]&&e[b].modelName!==a?c?`${e[b].modelName}s`:e[b].modelName:c?`${a}s`:a};function i({model:a,field:b}){let c=g(a),d=f({model:c,field:b});return e[c]?.fields[d]?.fieldName||d}let j=(...a)=>{if(!0===d.debugLogs||"object"==typeof d.debugLogs){if("object"==typeof d.debugLogs&&"isRunningAdapterTests"in d.debugLogs){d.debugLogs.isRunningAdapterTests&&(a.shift(),lV.push(a));return}if("object"!=typeof d.debugLogs||!d.debugLogs.logCondition||d.debugLogs.logCondition?.())if("object"==typeof a[0]&&"method"in a[0]){let b=a.shift().method;if("object"==typeof d.debugLogs){if("create"===b&&!d.debugLogs.create)return;else if("update"===b&&!d.debugLogs.update)return;else if("updateMany"===b&&!d.debugLogs.updateMany)return;else if("findOne"===b&&!d.debugLogs.findOne)return;else if("findMany"===b&&!d.debugLogs.findMany)return;else if("delete"===b&&!d.debugLogs.delete)return;else if("deleteMany"===b&&!d.debugLogs.deleteMany)return;else if("count"===b&&!d.debugLogs.count)return}ii.info(`[${d.adapterName}]`,...a)}else ii.info(`[${d.adapterName}]`,...a)}},k=({customModelName:a,forceAllowId:b})=>{let e=!d.disableIdGeneration&&!c.advanced?.database?.useNumberId&&!b,f=g(a??"id");return{type:c.advanced?.database?.useNumberId?"number":"string",required:!!e,...e?{defaultValue(){if(d.disableIdGeneration)return;let a=c.advanced?.database?.useNumberId,b=c.advanced?.database?.generateId;if(c.advanced?.generateId!==void 0&&(ii.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),b=c.advanced?.generateId),!1!==b&&!a)return b?b({model:f}):d.customIdGenerator?d.customIdGenerator({model:f}):ic()}}:{}}},l=({model:a,field:b})=>{let c=g(a),d=f({field:b,model:a}),h=e[c].fields;return h.id=k({customModelName:c}),h[d]},m=a({options:c,schema:e,debugLog:j,getFieldName:i,getModelName:h,getDefaultModelName:g,getDefaultFieldName:f,getFieldAttributes:l}),n=async(a,b,f,g)=>{let h={},i=e[b].fields,j=d.mapKeysTransformInput??{};for(let l in d.disableIdGeneration||c.advanced?.database?.useNumberId||(i.id=k({customModelName:b,forceAllowId:g&&"id"in a})),i){let g=a[l],k=i[l],m=j[l]||i[l].fieldName||l;if(void 0===g&&(!k.defaultValue&&!k.transform?.input||"update"===f))continue;let n=function(a,b,c){return"update"===c?a:null==a&&void 0!==b.defaultValue?"function"==typeof b.defaultValue?b.defaultValue():b.defaultValue:a}(g,k,f);k.transform?.input&&(n=await k.transform.input(n)),k.references?.field==="id"&&c.advanced?.database?.useNumberId?n=Array.isArray(n)?n.map(Number):Number(n):!1===d.supportsJSON&&"object"==typeof n&&"json"===k.type?n=JSON.stringify(n):!1===d.supportsDates&&n instanceof Date&&"date"===k.type?n=n.toISOString():!1===d.supportsBooleans&&"boolean"==typeof n&&(n=+!!n),d.customTransformInput&&(n=d.customTransformInput({data:n,action:f,field:m,fieldAttributes:k,model:b,schema:e,options:c})),h[m]=n}return h},o=async(a,b,f=[])=>{if(!a)return null;let g=d.mapKeysTransformOutput??{},h={},i=e[b].fields;for(let j in i[Object.entries(g).find(([a,b])=>"id"===b)?.[0]??"id"]={type:c.advanced?.database?.useNumberId?"number":"string"},i){if(f.length&&!f.includes(j))continue;let k=i[j];if(k){let i=k.fieldName||j,l=a[Object.entries(g).find(([a,b])=>b===i)?.[0]||i];k.transform?.output&&(l=await k.transform.output(l));let m=g[j]||j;"id"===i||k.references?.field==="id"?void 0!==l&&(l=String(l)):!1===d.supportsJSON&&"string"==typeof l&&"json"===k.type?l=ib(l):!1===d.supportsDates&&"string"==typeof l&&"date"===k.type?l=new Date(l):!1===d.supportsBooleans&&"number"==typeof l&&"boolean"===k.type&&(l=1===l),d.customTransformOutput&&(l=d.customTransformOutput({data:l,field:m,fieldAttributes:k,select:f,model:b,schema:e,options:c})),h[m]=l}}return h},p=({model:a,where:b})=>{if(!b)return;let e=d.mapKeysTransformInput??{};return b.map(b=>{let{field:d,value:h,operator:j="eq",connector:k="AND"}=b;if("in"===j&&!Array.isArray(h))throw Error("Value must be an array");let m=g(a),n=f({field:d,model:a}),o=e[n]||i({field:n,model:m}),p=l({field:n,model:m});return("id"===n||p.references?.field==="id")&&c.advanced?.database?.useNumberId?Array.isArray(h)?{operator:j,connector:k,field:o,value:h.map(Number)}:{operator:j,connector:k,field:o,value:Number(h)}:{operator:j,connector:k,field:o,value:h}})};return{create:async({data:a,model:b,select:c,forceAllowId:e=!1})=>{let f=++lW,g=h(b);if("id"in a&&!e){ii.warn(`[${d.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let b=Error();console.log(b.stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","Create method with `id` being called at:")),a.id=void 0}j({method:"create"},`${lZ(f)} ${l$(1,4)}`,`${l_("create")} ${l0("Unsafe Input")}:`,{model:g,data:a});let i=await n(a,b,"create",e);j({method:"create"},`${lZ(f)} ${l$(2,4)}`,`${l_("create")} ${l0("Parsed Input")}:`,{model:g,data:i});let k=await m.create({data:i,model:g});j({method:"create"},`${lZ(f)} ${l$(3,4)}`,`${l_("create")} ${l0("DB Result")}:`,{model:g,res:k});let l=await o(k,b,c);return j({method:"create"},`${lZ(f)} ${l$(4,4)}`,`${l_("create")} ${l0("Parsed Result")}:`,{model:g,data:l}),l},update:async({model:a,where:b,update:c})=>{let d=++lW,e=h(a),f=p({model:a,where:b});j({method:"update"},`${lZ(d)} ${l$(1,4)}`,`${l_("update")} ${l0("Unsafe Input")}:`,{model:e,data:c});let g=await n(c,a,"update");j({method:"update"},`${lZ(d)} ${l$(2,4)}`,`${l_("update")} ${l0("Parsed Input")}:`,{model:e,data:g});let i=await m.update({model:e,where:f,update:g});j({method:"update"},`${lZ(d)} ${l$(3,4)}`,`${l_("update")} ${l0("DB Result")}:`,{model:e,data:i});let k=await o(i,a);return j({method:"update"},`${lZ(d)} ${l$(4,4)}`,`${l_("update")} ${l0("Parsed Result")}:`,{model:e,data:k}),k},updateMany:async({model:a,where:b,update:c})=>{let d=++lW,e=h(a),f=p({model:a,where:b});j({method:"updateMany"},`${lZ(d)} ${l$(1,4)}`,`${l_("updateMany")} ${l0("Unsafe Input")}:`,{model:e,data:c});let g=await n(c,a,"update");j({method:"updateMany"},`${lZ(d)} ${l$(2,4)}`,`${l_("updateMany")} ${l0("Parsed Input")}:`,{model:e,data:g});let i=await m.updateMany({model:e,where:f,update:g});return j({method:"updateMany"},`${lZ(d)} ${l$(3,4)}`,`${l_("updateMany")} ${l0("DB Result")}:`,{model:e,data:i}),j({method:"updateMany"},`${lZ(d)} ${l$(4,4)}`,`${l_("updateMany")} ${l0("Parsed Result")}:`,{model:e,data:i}),i},findOne:async({model:a,where:b,select:c})=>{let d=++lW,e=h(a),f=p({model:a,where:b});j({method:"findOne"},`${lZ(d)} ${l$(1,3)}`,`${l_("findOne")}:`,{model:e,where:f,select:c});let g=await m.findOne({model:e,where:f,select:c});j({method:"findOne"},`${lZ(d)} ${l$(2,3)}`,`${l_("findOne")} ${l0("DB Result")}:`,{model:e,data:g});let i=await o(g,a,c);return j({method:"findOne"},`${lZ(d)} ${l$(3,3)}`,`${l_("findOne")} ${l0("Parsed Result")}:`,{model:e,data:i}),i},findMany:async({model:a,where:b,limit:d,sortBy:e,offset:f})=>{let g=++lW,i=d??c.advanced?.database?.defaultFindManyLimit??100,k=h(a),l=p({model:a,where:b});j({method:"findMany"},`${lZ(g)} ${l$(1,3)}`,`${l_("findMany")}:`,{model:k,where:l,limit:i,sortBy:e,offset:f});let n=await m.findMany({model:k,where:l,limit:i,sortBy:e,offset:f});j({method:"findMany"},`${lZ(g)} ${l$(2,3)}`,`${l_("findMany")} ${l0("DB Result")}:`,{model:k,data:n});let q=await Promise.all(n.map(async b=>await o(b,a)));return j({method:"findMany"},`${lZ(g)} ${l$(3,3)}`,`${l_("findMany")} ${l0("Parsed Result")}:`,{model:k,data:q}),q},delete:async({model:a,where:b})=>{let c=++lW,d=h(a),e=p({model:a,where:b});j({method:"delete"},`${lZ(c)} ${l$(1,2)}`,`${l_("delete")}:`,{model:d,where:e}),await m.delete({model:d,where:e}),j({method:"delete"},`${lZ(c)} ${l$(2,2)}`,`${l_("delete")} ${l0("DB Result")}:`,{model:d})},deleteMany:async({model:a,where:b})=>{let c=++lW,d=h(a),e=p({model:a,where:b});j({method:"deleteMany"},`${lZ(c)} ${l$(1,2)}`,`${l_("deleteMany")} ${l0("DeleteMany")}:`,{model:d,where:e});let f=await m.deleteMany({model:d,where:e});return j({method:"deleteMany"},`${lZ(c)} ${l$(2,2)}`,`${l_("deleteMany")} ${l0("DB Result")}:`,{model:d,data:f}),f},count:async({model:a,where:b})=>{let c=++lW,d=h(a),e=p({model:a,where:b});j({method:"count"},`${lZ(c)} ${l$(1,2)}`,`${l_("count")}:`,{model:d,where:e});let f=await m.count({model:d,where:e});return j({method:"count"},`${lZ(c)} ${l$(2,2)}`,`${l_("count")}:`,{model:d,data:f}),f},createSchema:m.createSchema?async(a,b)=>{let d=js(c);return c.secondaryStorage&&!c.session?.storeSessionInDatabase&&delete d.session,c.rateLimit&&"database"===c.rateLimit.storage&&(void 0===c.rateLimit.enabled||!0===c.rateLimit.enabled)&&(d.ratelimit={modelName:c.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:c.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:c.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:c.rateLimit.fields?.lastRequest??"lastRequest"}}}),m.createSchema({file:b,tables:d})}:void 0,options:{adapterConfig:d,...m.options??{}},id:d.adapterId,...d.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){lV=[]},printDebugLogs(){let a=`\u2500`.repeat(80);console.log(...lV.reverse().map(a=>(a[0]=`
${a[0]}`,[...a,"\n"])).reduce((a,b)=>[...b,...a],[`
${a}`]))}}}:{}}};function lZ(a){return`${lX.fg.magenta}#${a}${lX.reset}`}function l$(a,b){return`${lX.bg.black}${lX.fg.yellow}[${a}/${b}]${lX.reset}`}function l_(a){return`${lX.bright}${a}${lX.reset}`}function l0(a){return`${lX.dim}(${a})${lX.reset}`}let l1=async a=>{let b,d=a.database;if(!d)return{kysely:null,databaseType:null};if("db"in d)return{kysely:d.db,databaseType:d.type};if("dialect"in d)return{kysely:new lM({dialect:d.dialect}),databaseType:d.type};let e=function a(b){if(!b)return null;if("dialect"in b)return a(b.dialect);if("createDriver"in b){if(b instanceof jL)return"sqlite";if(b instanceof jV)return"mysql";if(b instanceof j2)return"postgres";if(b instanceof kf)return"mssql"}return"aggregate"in b?"sqlite":"getConnection"in b?"mysql":"connect"in b?"postgres":"fileControl"in b?"sqlite":null}(d);if("createDriver"in d&&(b=d),"aggregate"in d&&(b=new jL({database:d})),"getConnection"in d&&(b=new jV(d)),"connect"in d&&(b=new j2({pool:d})),"fileControl"in d){let{BunSqliteDialect:a}=await c.e(853).then(c.bind(c,1234));b=new a({database:d})}return{kysely:b?new lM({dialect:b}):null,databaseType:e}},l2=(a,b)=>{let c=b.options,d=c.secondaryStorage,e=c.session?.expiresIn||604800,{createWithHooks:f,updateWithHooks:g,updateManyWithHooks:h}=function(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e,f){let g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await a.create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;h="object"==typeof a?a.data:a}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await a.update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;h="object"==typeof a?a.data:a}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await a.updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j}}}(a,b);return{createOAuthUser:async(a,b,c)=>{let d=await f({createdAt:new Date,updatedAt:new Date,...a},"user",void 0,c),e=await f({...b,userId:d.id||a.id,createdAt:new Date,updatedAt:new Date},"account",void 0,c);return{user:d,account:e}},createUser:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,emailVerified:!1,...a,email:a.email?.toLowerCase()},"user",void 0,b),createAccount:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b),listSessions:async c=>{if(d){let a=await d.get(`active-sessions-${c}`);if(!a)return[];let e=ib(a)||[],f=Date.now(),g=e.filter(a=>a.expiresAt>f),h=[];for(let a of g){let c=await d.get(a.token);if(c){let a=JSON.parse(c),d=im(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});h.push(d)}}return h}return await a.findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await a.findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await a.count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async b=>{d&&await d.delete(`active-sessions-${b}`),(!d||c.session?.storeSessionInDatabase)&&await a.deleteMany({model:"session",where:[{field:"userId",value:b}]}),await a.deleteMany({model:"account",where:[{field:"userId",value:b}]}),await a.delete({model:"user",where:[{field:"id",value:b}]})},createSession:async(a,b,g,h,i)=>{let j=b.headers||b.request?.headers,{id:k,...l}=h||{},m={ipAddress:(b.request||b.headers)&&jm(b.request||b.headers,b.context.options)||"",userAgent:j?.get("user-agent")||"",...l,expiresAt:g?eU(86400,"sec"):eU(e,"sec"),userId:a,token:ic(32),createdAt:new Date,updatedAt:new Date,...i?l:{}};return await f(m,"session",d?{fn:async b=>{let c=await d.get(`active-sessions-${a}`),f=[],g=Date.now();return c&&(f=(f=ib(c)||[]).filter(a=>a.expiresAt>g)),f.push({token:m.token,expiresAt:g+1e3*e}),await d.set(`active-sessions-${a}`,JSON.stringify(f),e),b},executeMainFn:c.session?.storeSessionInDatabase}:void 0,b)},findSession:async e=>{if(d){let a=await d.get(e);if(!a&&!c.session?.storeSessionInDatabase)return null;if(a){let c=JSON.parse(a);return{session:im(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:il(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}}}let f=await a.findOne({model:"session",where:[{value:e,field:"token"}]});if(!f)return null;let g=await a.findOne({model:"user",where:[{value:f.userId,field:"id"}]});return g?{session:im(b.options,f),user:il(b.options,g)}:null},findSessions:async b=>{if(d){let a=[];for(let c of b){let b=await d.get(c);if(b){let c=JSON.parse(b),d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let c=await a.findMany({model:"session",where:[{field:"token",value:b,operator:"in"}]}),e=c.map(a=>a.userId);if(!e.length)return[];let f=await a.findMany({model:"user",where:[{field:"id",value:e,operator:"in"}]});return c.map(a=>{let b=f.find(b=>b.id===a.userId);return b?{session:a,user:b}:null})},updateSession:async(a,b,e)=>await g(b,[{field:"token",value:a}],"session",d?{async fn(b){let c=await d.get(a);return c?{...JSON.parse(c).session,...b}:null},executeMainFn:c.session?.storeSessionInDatabase}:void 0,e),deleteSession:async e=>{d&&(await d.delete(e),!c.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)||await a.delete({model:"session",where:[{field:"token",value:e}]})},deleteAccounts:async b=>{await a.deleteMany({model:"account",where:[{field:"userId",value:b}]})},deleteAccount:async b=>{await a.delete({model:"account",where:[{field:"id",value:b}]})},deleteSessions:async e=>{if(d){if("string"==typeof e){let a=await d.get(`active-sessions-${e}`),b=a?ib(a):[];if(!b)return;for(let a of b)await d.delete(a.token)}else for(let a of e)await d.get(a)&&await d.delete(a);if(!c.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await a.deleteMany({model:"session",where:[{field:Array.isArray(e)?"token":"userId",value:e,operator:Array.isArray(e)?"in":void 0}]})},findOAuthUser:async(b,c,d)=>{let e=await a.findMany({model:"account",where:[{value:c,field:"accountId"}]}).then(a=>a.find(a=>a.providerId===d));if(e){let c=await a.findOne({model:"user",where:[{value:e.userId,field:"id"}]});if(c)return{user:c,accounts:[e]};{let c=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[e]}:null}}{let c=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!c)return null;{let b=await a.findMany({model:"account",where:[{value:c.id,field:"userId"}]});return{user:c,accounts:b||[]}}}},findUserByEmail:async(b,c)=>{let d=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!d)return null;if(c?.includeAccounts){let b=await a.findMany({model:"account",where:[{value:d.id,field:"userId"}]});return{user:d,accounts:b}}return{user:d,accounts:[]}},findUserById:async b=>await a.findOne({model:"user",where:[{field:"id",value:b}]}),linkAccount:async(a,b)=>await f({...a,createdAt:new Date,updatedAt:new Date},"account",void 0,b),updateUser:async(a,b,c)=>{let e=await g(b,[{field:"id",value:a}],"user",void 0,c);if(d&&e){let b=await d.get(`active-sessions-${a}`);if(b){let a=Date.now(),c=(ib(b)||[]).filter(b=>b.expiresAt>a);await Promise.all(c.map(async({token:b})=>{let c=await d.get(b);if(!c)return;let f=ib(c);if(!f)return;let g=Math.max(Math.floor((new Date(f.session.expiresAt).getTime()-a)/1e3),0);await d.set(b,JSON.stringify({session:f.session,user:e}),g)}))}}return e},updateUserByEmail:async(a,b,c)=>await g(b,[{field:"email",value:a.toLowerCase()}],"user",void 0,c),updatePassword:async(a,b,c)=>{await h({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0,c)},findAccounts:async b=>await a.findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await a.findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await a.findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await a.findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b,c)=>await g(b,[{field:"id",value:a}],"account",void 0,c),createVerificationValue:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0,b),findVerificationValue:async b=>{let d=await a.findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return c.verification?.disableCleanup||await a.deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),d[0]},deleteVerificationValue:async b=>{await a.delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async b=>{await a.delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b,c)=>await g(b,[{field:"id",value:a}],"verification",void 0,c)}};async function l3(a){let b;if(!a.database){let b,c=Object.keys(js(a)).reduce((a,b)=>(a[b]=[],a),{});return ii.warn("No database configuration provided. Using memory adapter in development"),lY({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:b?.debugLogs||!1,customTransformInput:a=>a.options.advanced?.database?.useNumberId&&"id"===a.field&&"create"===a.action?c[a.model].length+1:a.data},adapter:({getFieldName:a,options:b,debugLog:d})=>{function e(a,b){let d=c[b];if(!d)throw ii.error(`[MemoryAdapter] Model ${b} not found in the DB`,Object.keys(c)),Error(`Model ${b} not found`);return d.filter(b=>a.every(a=>{let{field:c,value:d,operator:e}=a;if("in"===e){if(!Array.isArray(d))throw Error("Value must be an array");return d.includes(b[c])}return"contains"===e?b[c].includes(d):"starts_with"===e?b[c].startsWith(d):"ends_with"===e?b[c].endsWith(d):b[c]===d}))}return{create:async({model:a,data:d})=>(b.advanced?.database?.useNumberId&&(d.id=c[a].length+1),c[a]||(c[a]=[]),c[a].push(d),d),findOne:async({model:a,where:b})=>e(b,a)[0]||null,findMany:async({model:b,where:d,sortBy:f,limit:g,offset:h})=>{let i=c[b];return d&&(i=e(d,b)),f&&(i=i.sort((c,d)=>{let e=a({model:b,field:f.field});return"asc"===f.direction?c[e]>d[e]?1:-1:c[e]<d[e]?1:-1})),void 0!==h&&(i=i.slice(h)),void 0!==g&&(i=i.slice(0,g)),i},count:async({model:a})=>c[a].length,update:async({model:a,where:b,update:c})=>{let d=e(b,a);return d.forEach(a=>{Object.assign(a,c)}),d[0]||null},delete:async({model:a,where:b})=>{let d=c[a],f=e(b,a);c[a]=d.filter(a=>!f.includes(a))},deleteMany:async({model:a,where:b})=>{let d=c[a],f=e(b,a),g=0;return c[a]=d.filter(a=>f.includes(a)?(g++,!1):!f.includes(a)),g},updateMany({model:a,where:b,update:c}){let d=e(b,a);return d.forEach(a=>{Object.assign(a,c)}),d[0]||null}}}})(a)}if("function"==typeof a.database)return a.database(a);let{kysely:c,databaseType:d}=await l1(a);if(!c)throw new hY("Failed to initialize database adapter");return(b={type:d||"sqlite",debugLogs:"debugLogs"in a.database&&a.database.debugLogs},lY({config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:!1},adapter:({getFieldName:a,schema:d})=>{let e=async(d,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=d.id?"id":g.length>0&&g[0].field?g[0].field:"id";if(!d.id&&0===g.length)return await c.selectFrom(f).selectAll().orderBy(a({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=d[b]||g[0].value;return await c.selectFrom(f).selectAll().orderBy(a({model:f,field:b}),"desc").where(a({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function f(c,e){if(!e)return{and:null,or:null};let f=[],g=[];return e.forEach(e=>{let{field:h,value:i,operator:j="=",connector:k="AND"}=e,l=a({model:c,field:h});i=function(a,c,e){if("id"===e)return a;let{type:f="sqlite"}=b||{},g=d[c]?.fields[e];return(g||(g=Object.values(d).find(a=>a.modelName===c)),"boolean"===g.type&&("sqlite"===f||"mssql"===f)&&null!=a)?+!!a:"date"===g.type&&a&&a instanceof Date&&"sqlite"===f?a.toISOString():a}(i,c,h);let m=a=>"in"===j.toLowerCase()?a(l,"in",Array.isArray(i)?i:[i]):"contains"===j?a(l,"like",`%${i}%`):"starts_with"===j?a(l,"like",`${i}%`):"ends_with"===j?a(l,"like",`%${i}`):a(l,"eq"===j?"=":"ne"===j?"<>":"gt"===j?">":"gte"===j?">=":"lt"===j?"<":"lte"===j?"<=":j,i);"OR"===k?g.push(m):f.push(m)}),{and:f.length?f:null,or:g.length?g:null}}return{async create({data:a,model:b}){let d=c.insertInto(b).values(a);return await e(a,d,b,[])},async findOne({model:a,where:b,select:d}){let{and:e,or:g}=f(a,b),h=c.selectFrom(a).selectAll();e&&(h=h.where(a=>a.and(e.map(b=>b(a))))),g&&(h=h.where(a=>a.or(g.map(b=>b(a)))));let i=await h.executeTakeFirst();return i||null},async findMany({model:d,where:e,limit:g,offset:h,sortBy:i}){let{and:j,or:k}=f(d,e),l=c.selectFrom(d);j&&(l=l.where(a=>a.and(j.map(b=>b(a))))),k&&(l=l.where(a=>a.or(k.map(b=>b(a))))),b?.type==="mssql"?h||(l=l.top(g||100)):l=l.limit(g||100),i&&(l=l.orderBy(a({model:d,field:i.field}),i.direction)),h&&(b?.type==="mssql"?(i||(l=l.orderBy(a({model:d,field:"id"}))),l=l.offset(h).fetch(g||100)):l=l.offset(h));let m=await l.selectAll().execute();return m||[]},async update({model:a,where:b,update:d}){let{and:g,or:h}=f(a,b),i=c.updateTable(a).set(d);return g&&(i=i.where(a=>a.and(g.map(b=>b(a))))),h&&(i=i.where(a=>a.or(h.map(b=>b(a))))),await e(d,i,a,b)},async updateMany({model:a,where:b,update:d}){let{and:e,or:g}=f(a,b),h=c.updateTable(a).set(d);return e&&(h=h.where(a=>a.and(e.map(b=>b(a))))),g&&(h=h.where(a=>a.or(g.map(b=>b(a))))),(await h.execute()).length},async count({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.selectFrom(a).select(c.fn.count("id").as("count"));return d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),(await g.execute())[0].count},async delete({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.deleteFrom(a);d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),await g.execute()},async deleteMany({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.deleteFrom(a);return d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),(await g.execute()).length},options:b}}}))(a)}let l4={postgres:{string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamp","date"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"]},mssql:{string:["text","varchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime","date"]}};async function l5(a){let b=function(a){let b=js(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=ih(a.logger),{kysely:d,databaseType:e}=await l1(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f=await d.introspection.getTables(),g=[],h=[];for(let[a,d]of Object.entries(b)){let b=f.find(b=>b.name===a);if(!b){let b=g.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=g.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?g.push(c):g[b].fields={...g[b].fields,...d.fields}:g.splice(e,0,c);continue}let i={};for(let[f,g]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===f);if(!d){i[f]=g;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=l4[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,g.type,e)&&c.warn(`Field ${f} in table ${a} has a different type in the database. Expected ${g.type} but got ${d.dataType}.`)}Object.keys(i).length>0&&h.push({table:a,fields:i,order:d.order||1/0})}let i=[];function j(b,c){let d=b.type,f={string:{sqlite:"text",postgres:"text",mysql:b.unique?"varchar(255)":b.references?"varchar(36)":"text",mssql:b.unique||b.sortable?"varchar(255)":b.references?"varchar(36)":"text"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:b.bigint?"bigint":"integer",postgres:b.bigint?"bigint":"integer",mysql:b.bigint?"bigint":"integer",mssql:b.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamp",mysql:"datetime",mssql:"datetime"},id:{postgres:a.advanced?.database?.useNumberId?"serial":"text",mysql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:a.advanced?.database?.useNumberId?"integer":"text"}};return"id"===c||b.references?.field==="id"?f.id[e]:"sqlite"===e&&("string[]"===d||"number[]"===d)?"text":"string[]"===d||"number[]"===d?"jsonb":Array.isArray(d)?"text":f[d][e||"sqlite"]}if(h.length)for(let a of h)for(let[b,c]of Object.entries(a.fields)){let e=j(c,b),f=d.schema.alterTable(a.table).addColumn(b,e,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(`${c.references.model}.${c.references.field}`)),c.unique&&(a=a.unique()),a));i.push(f)}if(g.length)for(let b of g){let c=d.schema.createTable(b.table).addColumn("id",a.advanced?.database?.useNumberId?"postgres"===e?"serial":"integer":"mysql"===e||"mssql"===e?"varchar(36)":"text",b=>a.advanced?.database?.useNumberId?"postgres"===e?b.primaryKey().notNull():b.autoIncrement().primaryKey().notNull():b.primaryKey().notNull());for(let[a,d]of Object.entries(b.fields)){let b=j(d,a);c=c.addColumn(a,b,a=>(a=!1!==d.required?a.notNull():a,d.references&&(a=a.references(`${d.references.model}.${d.references.field}`)),d.unique&&(a=a.unique()),a))}i.push(c)}return{toBeCreated:g,toBeAdded:h,runMigrations:async function(){for(let a of i)await a.execute()},compileMigrations:async function(){return i.map(a=>a.compile().sql).join(";\n\n")+";"}}}async function l6(a,b){let c=await b.context.internalAdapter.findAccounts(a),d=c?.find(a=>"credential"===a.providerId),e=d?.password;if(!d||!e||!b.body.password)throw new M("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:e,password:b.body.password}))throw new M("BAD_REQUEST",{message:"Invalid password"});return!0}let l7="better-auth-secret-123456789",l8=async a=>{var b;let c=await l3(a),d=a.plugins||[],e=(b=a,b.advanced?.crossSubDomainCookies?.enabled,[]),f=ih(a.logger),g=h$(a.baseURL,a.basePath),h=a.secret||hT.BETTER_AUTH_SECRET||hT.AUTH_SECRET||l7;h===l7&&hV&&f.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");let i=function(a){let b=h7(a),c=b("session_token",{maxAge:a.session?.expiresIn||h5(7,"d").toSeconds()}),d=b("session_data",{maxAge:a.session?.cookieCache?.maxAge||300}),e=b("dont_remember");return{sessionToken:{name:c.name,options:c.attributes},sessionData:{name:d.name,options:d.attributes},dontRememberToken:{name:e.name,options:e.attributes}}}(a={...a,secret:h,baseURL:g?new URL(g).origin:"",basePath:a.basePath||"/api/auth",plugins:d.concat(e)}),j=js(a),k=Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];if(!c||!1===c.enabled)return null;c.clientId||f.warn(`Social provider ${b} is missing clientId or clientSecret`);let d=iZ[b](c);return d.disableImplicitSignUp=c.disableImplicitSignUp,d}).filter(a=>null!==a),{context:l}=function(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c=a.init(d);if("object"==typeof c){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=ir(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=l2(a.adapter,{options:b,hooks:e.filter(a=>void 0!==a),generateId:a.generateId}),d.options=b,{context:d}}({appName:a.appName||"Better Auth",socialProviders:k,options:a,tables:j,trustedOrigins:function(a){let b=h$(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=hT.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new hY("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(a),baseURL:g||"",sessionConfig:{updateAge:a.session?.updateAge!==void 0?a.session.updateAge:86400,expiresIn:a.session?.expiresIn||604800,freshAge:a.session?.freshAge===void 0?86400:a.session.freshAge},secret:h,rateLimit:{...a.rateLimit,enabled:a.rateLimit?.enabled??hV,window:a.rateLimit?.window||10,max:a.rateLimit?.max||100,storage:a.rateLimit?.storage||(a.secondaryStorage?"secondary-storage":"memory")},authCookies:i,logger:f,generateId:({model:b,size:c})=>"function"==typeof a.advanced?.generateId?a.advanced.generateId({model:b,size:c}):"function"==typeof a?.advanced?.database?.generateId?a.advanced.database.generateId({model:b,size:c}):ic(c),session:null,secondaryStorage:a.secondaryStorage,password:{hash:a.emailAndPassword?.password?.hash||g7,verify:a.emailAndPassword?.password?.verify||g8,config:{minPasswordLength:a.emailAndPassword?.minPasswordLength||8,maxPasswordLength:a.emailAndPassword?.maxPasswordLength||128},checkPassword:l6},setNewSession(a){this.newSession=a},newSession:null,adapter:c,internalAdapter:l2(c,{options:a,hooks:a.databaseHooks?[a.databaseHooks]:[]}),createAuthCookie:h7(a),async runMigrations(){if(!a.database||"updateMany"in a.database)throw new hY("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await l5(a);await b()}});return l};class l9{constructor(a,b){this.database=a,this.config=b}async executeQuery(a,b=[]){let c,d=!0===this.config.debugLogs||"object"==typeof this.config.debugLogs&&this.config.debugLogs&&"execute"in this.config.debugLogs&&this.config.debugLogs.execute;if(d&&(console.log(`[Turso Adapter] Executing SQL: ${a}`),console.log("[Turso Adapter] Args:",b)),!a||"string"!=typeof a)throw Error("Invalid SQL query: must be a non-empty string");if(!Array.isArray(b))throw Error("Invalid arguments: must be an array");try{let e;if(!this.database)throw Error("Turso database is not properly initialized");if(/^SELECT\s/i.test(a.trim()))e={rows:this.database.prepare(a).all(...b)||[],rowsAffected:0,lastInsertRowid:void 0};else{let c=this.database.prepare(a).run(...b);this.config.debugLogs&&console.log("[Database Manager] Statement info:",c),e={rows:[],rowsAffected:c.changes||0,lastInsertRowid:c.lastInsertRowid}}c={rows:Array.isArray(e.rows)?e.rows:[],rowsAffected:e.rowsAffected?Number(e.rowsAffected):0,lastInsertRowid:e.lastInsertRowid?Number(e.lastInsertRowid):void 0},d&&console.log(`[Turso Adapter] Query executed successfully. Rows affected: ${c.rowsAffected}, Rows returned: ${c.rows.length}`)}catch(e){let c=e instanceof Error?e.message:"Unknown error";throw d&&(console.error(`[Turso Adapter] Query failed: ${c}`),console.error(`[Turso Adapter] Failed SQL: ${a}`),console.error("[Turso Adapter] Failed args:",b)),e}return c}async batchExecute(a){if(1===a.length){let b=a[0];return[await this.executeQuery(b.sql,b.args||[])]}this.config.debugLogs&&console.log(`[Turso Adapter] Executing batch of ${a.length} operations`);try{let b=[],c=this.database.transaction(a=>{for(let[c,d]of a.entries())try{if(/^SELECT\s/i.test(d.sql.trim())){let a=this.database.prepare(d.sql).all(...d.args||[]);b.push({rows:a||[],rowsAffected:0,lastInsertRowid:void 0,_meta:{batchIndex:c,executionTime:0,cached:!1}})}else{let a=this.database.prepare(d.sql).run(...d.args||[]);b.push({rows:[],rowsAffected:a.changes||0,lastInsertRowid:a.lastInsertRowid,_meta:{batchIndex:c,executionTime:0,cached:!1}})}}catch(a){b.push({error:a})}}),d=a.map(a=>({...a,args:a.args||[]}));return c(d),this.config.debugLogs&&console.log("[Turso Adapter] Batch executed successfully"),b}catch(a){throw console.error("[Turso Adapter] Batch execution failed:",a),a}}async checkHealth(){try{return this.database.prepare("SELECT 1").get(),{healthy:!0}}catch(a){return{healthy:!1,error:a instanceof Error?a.message:String(a)}}}}class ma{constructor(a,b){this.createdTables=new Set,this.columnCache=new Set,this.db=a,this.config=b}async ensureTableExists(a){if(!this.createdTables.has(a))try{let b=await this.db.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name=?",[a]);if(0===b.rows.length){let b=`CREATE TABLE IF NOT EXISTS ${a} (
          id TEXT,
          name TEXT,
          email TEXT,
          emailVerified INTEGER DEFAULT 0,
          image TEXT,
          createdAt TEXT,
          updatedAt TEXT
        )`;for(let c of(await this.db.executeQuery(b,[]),["id","name","email","emailVerified","image","createdAt","updatedAt"]))this.columnCache.add(`${a}.${c}`);this.config.debugLogs&&console.log(`[Turso Adapter] Created table ${a}`)}else for(let b of(await this.db.executeQuery(`PRAGMA table_info(${a})`,[])).rows||[]){let c=b.name||b[1];c&&this.columnCache.add(`${a}.${c}`)}this.createdTables.add(a)}catch(b){throw console.error(`[Turso Adapter] Failed to ensure table ${a} exists:`,b),b}}async ensureColumnExists(a,b){let c=`${a}.${b}`;if(!this.columnCache.has(c))try{let d=await this.db.executeQuery(`PRAGMA table_info(${a})`,[]);if(d.rows?.some(a=>a.name===b||a[1]===b)){this.columnCache.add(c),this.config.debugLogs&&console.log(`[Turso Adapter] Column ${b} already exists in table ${a}`);return}this.config.debugLogs&&console.log(`[Turso Adapter] Column ${b} does not exist in table ${a}, adding it`),await this.db.executeQuery(`ALTER TABLE ${a} ADD COLUMN ${b} TEXT`,[]),this.columnCache.add(c),this.config.debugLogs&&console.log(`[Turso Adapter] Successfully added column ${b} to table ${a}`)}catch(d){this.columnCache.add(c),console.warn(`[Turso Adapter] Could not ensure column ${b} exists in table ${a}:`,d)}}generateSchema(a,b={}){let c=b?.advanced?.database?.useNumberId===!0,d=c?"INTEGER PRIMARY KEY AUTOINCREMENT":"TEXT PRIMARY KEY",e=`-- Better Auth Schema for Turso/libSQL
`;for(let[b,f]of(e+=`-- Generated on: ${new Date().toISOString()}

`,Object.entries(a))){let a=f.fields||{};for(let[f,g]of(e+=`-- Table: ${b}
CREATE TABLE IF NOT EXISTS ${b} (
  id ${d},
`,c&&(e+=`  internalId INTEGER,
`),Object.entries(a))){if("id"===f)continue;let a="TEXT",b="";switch(g.type){case"number":case"int":case"integer":a="INTEGER";break;case"boolean":case"bool":a="BOOLEAN";break;case"date":case"datetime":case"timestamp":a="DATETIME";break;default:a="TEXT"}g.required&&(b+=" NOT NULL"),g.unique&&(b+=" UNIQUE"),void 0!==g.defaultValue&&("string"==typeof g.defaultValue?b+=` DEFAULT '${g.defaultValue}'`:b+=` DEFAULT ${g.defaultValue}`),e+=`  ${f} ${a}${b},
`}"session"===b||"account"===b?e+=`  FOREIGN KEY (userId) REFERENCES user(id) ON DELETE CASCADE
`:e=e.slice(0,-2)+"\n",e+=`);

`}return{code:e,path:"schema.sql"}}}let mb=new Map([["emailverified","emailVerified"],["createdat","createdAt"],["updatedat","updatedAt"],["userid","userId"],["accountid","accountId"],["providerid","providerId"],["accesstoken","accessToken"],["refreshtoken","refreshToken"],["idtoken","idToken"],["expiresat","expiresAt"],["lastinsertrowid","lastInsertRowid"]]),mc=new Map,md=new Map,me={isoDate:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/,json:/^[[{].*[\]}]$/},mf=new Set(["emailVerified","emailverified","verified","active","enabled","isActive","isEnabled","isVerified"]);class mg{static normalizeFieldName(a){let b=mc.get(a);if(void 0!==b)return b;let c=a.toLowerCase(),d=mb.get(c)||a;return mc.size<1e3&&mc.set(a,d),d}static sanitizeValue(a){if(null==a)return null;if(a instanceof Date)return a.toISOString();if("boolean"==typeof a)return+!!a;if("object"==typeof a&&null!==a)try{return JSON.stringify(a)}catch{return String(a)}return a}static deserializeValue(a,b){if(null==a)return a;if("number"==typeof a)return b&&mf.has(b)&&(0===a||1===a)?1===a:a;if("string"!=typeof a)return a;let c=`${typeof a}:${a.length}:${a.slice(0,20)}`,d=md.get(c);if(void 0!==d)return d;let e=a;if(me.isoDate.test(a)){let b=new Date(a);isNaN(b.getTime())||(e=b)}else if(a.length>1&&me.json.test(a))try{e=JSON.parse(a)}catch{e=a}return md.size<1e4?md.set(c,e):md.size>15e3&&(Array.from(md.entries()).splice(0,5e3).forEach(([a])=>md.delete(a)),md.set(c,e)),e}static deserializeRow(a){if(!a||"object"!=typeof a)return a;let b={};for(let[c,d]of Object.entries(a)){let a=this.normalizeFieldName(c);b[a]=this.deserializeValue(d,a)}return b}static processWhereConditions(a){if(!Array.isArray(a)||0===a.length)return{whereClause:"",whereValues:[]};let b=[],c=[];for(let d of a){let a,{field:e,operator:f="eq",value:g,connector:h="AND"}=d;if(!e)continue;let i=this.sanitizeValue(g);switch(f){case"eq":default:a="=";break;case"ne":a="!=";break;case"gt":a=">";break;case"gte":a=">=";break;case"lt":a="<";break;case"lte":a="<=";break;case"in":if(a="IN",Array.isArray(g)){let d=g.map(()=>"?").join(", ");b.push(`${e} ${a} (${d})`),c.push(...g.map(a=>this.sanitizeValue(a)));continue}break;case"contains":a="LIKE",i=`%${g}%`;break;case"startsWith":a="LIKE",i=`${g}%`;break;case"endsWith":a="LIKE",i=`%${g}`}"in"!==f&&(b.push(`${e} ${a} ?`),c.push(i))}return{whereClause:b.length>0?b.join(" AND "):"",whereValues:c}}static extractTableName(a){let b=a.match(/(?:INSERT\s+INTO|UPDATE|DELETE\s+FROM|FROM)\s+(\w+)/i);return b?b[1]:""}static calculateDataSize(a){if(!a)return 0;try{return JSON.stringify(a).length}catch{return String(a).length}}static sleep(a){return new Promise(b=>setTimeout(b,a))}}let mh=(a=>{let b=l8(a),{api:c}=jr(b,a),d=a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{});return{handler:async c=>{let d=await b,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=h$(void 0,e,c);if(a)d.baseURL=a,d.options.baseURL=h_(d.baseURL)||void 0;else throw new hY("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(c):[],d.options.baseURL];let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=jr(a,b),e=new URL(a.baseURL).pathname;return((a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=aa(c.path,{method:"GET"},async b=>new Response(((a,b)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(a)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${b?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(b.logo)}`:void 0} ,
	   	theme: ${b?.theme||"saturn"},
        metaData: {
			title: ${b?.title||"Open API Reference"},
			description: ${b?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`)(await bo(a),c.scalar),{headers:{"Content-Type":"text/html"}}))}let c=H(),d=H();for(let b of Object.values(a))if(!(!b.options||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])K(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)K(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=b?.basePath?e.pathname.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!f?.length)return new Response(null,{status:404,statusText:"Not Found"});let g=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=I(c),g=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let g=a(b,c.param,d,e,f+1);if(g)return g}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==g)return{data:g.data,params:g.paramsMap?J(f,g.paramsMap):void 0}}(c,a.method,f);if(!g?.data)return new Response(null,{status:404,statusText:"Not Found"});let h={};e.searchParams.forEach((a,b)=>{b in h?Array.isArray(h[b])?h[b].push(a):h[b]=[h[b],a]:h[b]=a});let i=g.data,j={path:f,method:a.method,headers:a.headers,params:g.params?JSON.parse(JSON.stringify(g.params)):{},request:a,body:i.options.disableBody?void 0:await N(i.options.cloneRequest?a.clone():a),query:h,_flag:"router",asResponse:!0,context:b?.routerContext};try{let a=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=I(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];a&&g.push(...a)}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?J(e,a.paramsMap):void 0}))}(d,"*",f);if(a?.length)for(let{data:b,params:c}of a){let a=await b({...j,params:c,asResponse:!1});if(a instanceof Response)return a}return await i(j)}catch(a){if(O(a))return P(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=c instanceof Request?c:a,f=await e(d),g=await b?.onResponse?.(f);return g instanceof Response?g:f},endpoints:a}})(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:iy},...d],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(e,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response}return jo(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof M&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?ii:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof M?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return f(c)},api:c,options:a,$context:b,$Infer:{},$ERROR_CODES:{...d,...iA}}})({database:function(a={}){a.performance?.enableQueryCache,a.performance?.enablePreparedStatements,a.performance?.enableBatchOptimization,a.performance?.cacheTtl,a.performance?.maxCacheSize,a.performance?.maxPreparedStatements,a.performance?.batchSize,a.errorHandling?.maxRetries,a.errorHandling?.retryDelay,a.errorHandling?.exponentialBackoff,a.errorHandling;let b=async()=>{try{let a=await Promise.resolve().then(c.t.bind(c,5242,19));return a.default||a}catch{return require("@tursodatabase/turso")}},d=async()=>{try{if(a.database&&"object"==typeof a.database)return a.debugLogs&&console.log("[Turso Adapter] Using provided Turso database instance"),a.database;if("string"==typeof a.database){let c=await b(),d=":memory:"===a.database?":memory:":a.database,e=new c(d);return a.debugLogs&&console.log(`[Turso Adapter] Created Turso database from path: ${d}`),e}{let c=new(await b())(":memory:");return a.debugLogs&&console.log("[Turso Adapter] Created in-memory Turso database"),c}}catch(a){throw console.error("[Turso Adapter] Failed to initialize Turso database:",a),Error(`Failed to initialize Turso database: ${a instanceof Error?a.message:String(a)}`)}};return{adapter:b=>{let c=null,e=null,f=null,g=async()=>{c||(f=new ma(e=new l9(c=await d(),a),a))};return{id:"turso",create:async({model:b,data:c,select:d})=>{let h,i;if(await g(),!e||!f)throw Error("Failed to initialize database managers");for(let d of(a.debugLogs&&console.log(`[Turso Adapter] Creating in ${b}:`,c),await f.ensureTableExists(b),Object.keys(c)))await f.ensureColumnExists(b,d);let j=Object.entries(c).filter(([a,b])=>void 0!==b),k=j.map(([a])=>a),l=j.map(([a,b])=>mg.sanitizeValue(b)),m=k.map(()=>"?").join(", "),n=k.length>0?`INSERT INTO ${b} (${k.join(", ")}) VALUES (${m})`:`INSERT INTO ${b} DEFAULT VALUES`;a.debugLogs&&(console.log("[Turso Adapter] Insert SQL:",n),console.log("[Turso Adapter] Insert values:",l));let o=await e.executeQuery(n,l);if(a.debugLogs&&console.log("[Turso Adapter] Insert result:",o),!o.rowsAffected)throw Error("Failed to create record");if(o.lastInsertRowid&&!c.id)h=`SELECT * FROM ${b} WHERE rowid = ?`,i=[o.lastInsertRowid];else if(c.id)h=`SELECT * FROM ${b} WHERE id = ?`,i=[c.id];else{let a=Object.entries(c).filter(([a,b])=>null!=b&&"object"!=typeof b);if(a.length>0){let c=a.map(([a])=>`${a} = ?`).join(" AND ");h=`SELECT * FROM ${b} WHERE ${c} ORDER BY rowid DESC LIMIT 1`,i=a.map(([a,b])=>b)}else h=`SELECT * FROM ${b} ORDER BY rowid DESC LIMIT 1`,i=[]}let p=await e.executeQuery(h,i);if(!p.rows?.length)throw Error("Failed to retrieve created record");let q=p.rows[0],r=mg.deserializeRow(q);if(d&&d.length>0){let a={};for(let b of d)b in r&&(a[b]=r[b]);return a}return r},update:async({model:b,where:c,update:d,select:h})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");a.debugLogs&&console.log(`[Turso Adapter] Updating in ${b}:`,{where:c,update:d});let i=Object.keys(d);for(let a of i)await f.ensureColumnExists(b,a);let{whereClause:j,whereValues:k}=mg.processWhereConditions(c);if(!j)throw Error("Update requires WHERE conditions");let l=i.map(a=>`${a} = ?`).join(", "),m=[...i.map(a=>mg.sanitizeValue(d[a])),...k],n=`UPDATE ${b} SET ${l} WHERE ${j}`;if(a.debugLogs&&(console.log(`[Turso Adapter] Update SQL: ${n}`),console.log("[Turso Adapter] Update Values:",m)),0===(await e.executeQuery(n,m)).rowsAffected)return null;let o=`SELECT * FROM ${b} WHERE ${j} LIMIT 1`,p=await e.executeQuery(o,k);if(!p.rows?.length)return null;let q=p.rows[0],r=mg.deserializeRow(q);if(h&&h.length>0){let a={};for(let b of h)b in r&&(a[b]=r[b]);return a}return r},findOne:async({model:a,where:b,select:c})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");await f.ensureTableExists(a);let{whereClause:d,whereValues:h}=mg.processWhereConditions(b),i=`SELECT * FROM ${a}`;d&&(i+=` WHERE ${d}`),i+=" LIMIT 1";let j=await e.executeQuery(i,h);if(!j.rows?.length)return null;let k=j.rows[0],l=mg.deserializeRow(k);if(c&&c.length>0){let a={};for(let b of c)b in l&&(a[b]=l[b]);return a}return l},findMany:async({model:a,where:b,limit:c,offset:d,sortBy:h})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");await f.ensureTableExists(a);let{whereClause:i,whereValues:j}=mg.processWhereConditions(b),k=`SELECT * FROM ${a}`;if(i&&(k+=` WHERE ${i}`),h){let a=h.map(a=>{let b=a.desc?"DESC":"ASC";return`${a.field} ${b}`});k+=` ORDER BY ${a.join(", ")}`}return c&&(k+=` LIMIT ${c}`),d&&(k+=` OFFSET ${d}`),(await e.executeQuery(k,j)).rows.map(a=>mg.deserializeRow(a))},delete:async({model:a,where:b})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");let{whereClause:c,whereValues:d}=mg.processWhereConditions(b);if(!c)throw Error("Delete requires WHERE conditions");await f.ensureTableExists(a);let h=`DELETE FROM ${a} WHERE ${c}`;await e.executeQuery(h,d)},count:async({model:a,where:b})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");await f.ensureTableExists(a);let{whereClause:c,whereValues:d}=mg.processWhereConditions(b),h=`SELECT COUNT(*) as count FROM ${a}`;c&&(h+=` WHERE ${c}`);let i=await e.executeQuery(h,d);return i.rows[0]?.count||0},updateMany:async({model:b,where:c,update:d})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");a.debugLogs&&console.log(`[Turso Adapter] Updating many in ${b}:`,{where:c,update:d});let h=Object.keys(d);for(let a of h)await f.ensureColumnExists(b,a);let{whereClause:i,whereValues:j}=mg.processWhereConditions(c);if(!i)throw Error("UpdateMany requires WHERE conditions");let k=h.map(a=>`${a} = ?`).join(", "),l=[...h.map(a=>mg.sanitizeValue(d[a])),...j],m=`UPDATE ${b} SET ${k} WHERE ${i}`;return(await e.executeQuery(m,l)).rowsAffected||0},deleteMany:async({model:b,where:c})=>{if(await g(),!e||!f)throw Error("Failed to initialize database managers");a.debugLogs&&console.log(`[Turso Adapter] Deleting many from ${b}:`,c);let{whereClause:d,whereValues:h}=mg.processWhereConditions(c);if(!d)throw Error("DeleteMany requires WHERE conditions");await f.ensureTableExists(b);let i=`DELETE FROM ${b} WHERE ${d}`;return(await e.executeQuery(i,h)).rowsAffected||0},createSchema:async({tables:a,_file:b})=>{if(await g(),!f)throw Error("Failed to initialize schema manager");return f.generateSchema(a,{})},options:{provider:"turso",usePlural:a.usePlural||!1}}}}}({database:process.env.TURSO_DATABASE_URL||"./local.db",debugLogs:{create:!1,findOne:!1,findMany:!1,update:!1,delete:!1}}),emailAndPassword:{enabled:!0,requireEmailVerification:!1},socialProviders:{github:{clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""}},session:{expiresIn:604800,updateAge:86400},secret:process.env.BETTER_AUTH_SECRET||"your-secret-here-change-in-production",baseURL:process.env.BETTER_AUTH_URL||"http://localhost:3000"}),mi=mh.handler,mj=mh.handler,mk=new m.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/[...all]/route",pathname:"/api/auth/[...all]",filename:"route",bundlePath:"app/api/auth/[...all]/route"},distDir:".next",projectDir:"",resolvedPagePath:"/home/connerohnesorge/Documents/001Repos/better-auth-turso/examples/nextjs-app/src/app/api/auth/[...all]/route.ts",nextConfigOutput:"",userland:l}),{workAsyncStorage:ml,workUnitAsyncStorage:mm,serverHooks:mn}=mk;function mo(){return(0,o.patchFetch)({workAsyncStorage:ml,workUnitAsyncStorage:mm})}async function mp(a,b,c){var d;let e="/api/auth/[...all]/route";"/index"===e&&(e="/");let f=await mk.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:o,resolvedPathname:C}=f,D=(0,r.normalizeAppPath)(e),E=!!(k.dynamicRoutes[D]||k.routes[C]);if(E&&!j){let a=!!k.routes[C],b=k.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new A.NoFallbackError}let F=null;!E||mk.isDev||j||(F="/index"===(F=C)?"/":F);let G=!0===mk.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,q.getTracer)(),K=J.getActiveScopeSpan(),L={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,p.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>mk.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},M=new s.NodeNextRequest(a),N=new s.NodeNextResponse(b),O=t.NextRequestAdapter.fromNodeNextRequest(M,(0,t.signalFromNodeResponse)(b));try{let d=async c=>mk.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var g,h;let q=async({previousCacheEntry:g})=>{try{if(!(0,p.getRequestMeta)(a,"minimalMode")&&m&&o&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=L.renderOpts.collectedTags;if(!E)return await (0,w.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,x.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[z.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=z.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=z.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:B.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await mk.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,v.c)({isRevalidate:H,isOnDemandRevalidate:m})},l),b}},r=await mk.handleResponse({req:a,nextConfig:i,cacheKey:F,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:o,responseGenerator:q,waitUntil:c.waitUntil});if(!E)return null;if((null==r||null==(g=r.value)?void 0:g.kind)!==B.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==r||null==(h=r.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,p.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":r.isMiss?"MISS":r.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,x.fromNodeOutgoingHttpHeaders)(r.value.headers);return(0,p.getRequestMeta)(a,"minimalMode")&&E||s.delete(z.NEXT_CACHE_TAGS_HEADER),!r.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,y.getCacheControlHeader)(r.cacheControl)),await (0,w.I)(M,N,new Response(r.value.body,{headers:s,status:r.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(u.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:q.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(K||b instanceof A.NoFallbackError||await mk.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,v.c)({isRevalidate:H,isOnDemandRevalidate:m})}),E)throw b;return await (0,w.I)(M,N,new Response(null,{status:500})),null}}},2102:(a,b,c)=>{"use strict";c.d(b,{bj:()=>i,uc:()=>k});var d=c(8740),e=c(2325),f=c(9865),g=c(9758),h=c(5788);class i{#ab;get table(){return this.#ab}constructor(a){this.#ab=a}as(a){return new j(this.#ab,a)}}class j{#ab;#ac;get table(){return this.#ab}get alias(){return this.#ac}constructor(a,b){this.#ab=a,this.#ac=b}toOperationNode(){return d.N.create((0,g.M$)(this.#ab),e.O.create(this.#ac))}}function k(a){return(0,h.Gv)(a)&&(0,f.N)(a)&&(0,h.Kg)(a.table)&&(0,h.Kg)(a.alias)}},2170:(a,b,c)=>{"use strict";c.d(b,{c:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"JSONPathNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONPathNode",inOperator:a,pathLegs:(0,d.CN)([])}),cloneWithLeg:(a,b)=>(0,d.CN)({...a,pathLegs:(0,d.CN)([...a.pathLegs,b])})})},2325:(a,b,c)=>{"use strict";c.d(b,{O:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"IdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"IdentifierNode",name:a})})},2368:(a,b,c)=>{"use strict";c.d(b,{n:()=>p});var d=c(5144),e=c(3892),f=c(5788);class g{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#ad=(0,f.CN)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#ad[a.kind](a),this.nodeStack.pop()}}var h=c(4936),i=c(2435),j=c(2618),k=c(4586),l=c(3948),m=c(4943),n=c(5147);let o=/'/g;class p extends g{#ae="";#af=[];get numParameters(){return this.#af.length}compileQuery(a,b){return this.#ae="",this.#af=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),(0,f.CN)({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#af]})}getSql(){return this.#ae}visitSelectQuery(a){let b=void 0!==this.parentNode&&!i.k.is(this.parentNode)&&!e.o.is(this.parentNode)&&!d.B.is(this.parentNode)&&!k.Y.is(this.parentNode)&&!l.i.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&((0,n.u)("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(j.L.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!(0,f.Kg)(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(s[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),(0,f.Lm)(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(q[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return h.zX.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#ae+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(o,"''")}addParameter(a){this.#af.push(a)}appendImmediateValue(a){if((0,f.Kg)(a))this.appendStringLiteral(a);else if((0,f.Et)(a)||(0,f.Lm)(a)||(0,f.sI)(a))this.append(a.toString());else if((0,f.kZ)(a))this.append("null");else if((0,f.$P)(a))this.appendImmediateValue(a.toISOString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?r[a.modifier]-r[b.modifier]:1),(0,f.CN)(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let q=(0,f.CN)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),r=(0,f.CN)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),s=(0,f.CN)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"})},2378:(a,b,c)=>{"use strict";c.d(b,{J:()=>n,G:()=>function a(b){return(0,d.Tn)(b)?a(b((0,l.A)())):(0,d.MH)(b)?b.map(a=>m(a)):[m(b)]}});var d=c(5788),e=c(7035),f=c(6502);let g=(0,d.CN)({is:a=>"SelectionNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectionNode",selection:a}),createSelectAll:()=>(0,d.CN)({kind:"SelectionNode",selection:f.U.create()}),createSelectAllFromTable:a=>(0,d.CN)({kind:"SelectionNode",selection:e.q.createSelectAll(a)})});var h=c(4757),i=c(3995),j=c(5397),k=c(9758),l=c(8126);function m(a){return(0,d.Kg)(a)?g.create((0,h.DT)(a)):(0,i.C)(a)?g.create(a.toOperationNode()):g.create((0,j.v0)(a))}function n(a){return a?Array.isArray(a)?a.map(o):[o(a)]:[g.createSelectAll()]}function o(a){if((0,d.Kg)(a))return g.createSelectAllFromTable((0,k.M$)(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}},2435:(a,b,c)=>{"use strict";c.d(b,{k:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"ParensNode"===a.kind,create:a=>(0,d.CN)({kind:"ParensNode",node:a})})},2592:(a,b,c)=>{"use strict";c.d(b,{v:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"ListNode"===a.kind,create:a=>(0,d.CN)({kind:"ListNode",items:(0,d.CN)(a)})})},2618:(a,b,c)=>{"use strict";c.d(b,{L:()=>o});var d=c(3892),e=c(7880),f=c(4584),g=c(5532),h=c(7085),i=c(5788);let j=(0,i.CN)({is:a=>"ReturningNode"===a.kind,create:a=>(0,i.CN)({kind:"ReturningNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})}),k=(0,i.CN)({is:a=>"ExplainNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ExplainNode",format:a,options:b})});var l=c(4943);let m=(0,i.CN)({is:a=>"OutputNode"===a.kind,create:a=>(0,i.CN)({kind:"OutputNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})});var n=c(9622);let o=(0,i.CN)({is:a=>e.L.is(a)||d.o.is(a)||f.U.is(a)||g.e.is(a)||l.r.is(a),cloneWithEndModifier:(a,b)=>(0,i.CN)({...a,endModifiers:a.endModifiers?(0,i.CN)([...a.endModifiers,b]):(0,i.CN)([b])}),cloneWithWhere:(a,b)=>(0,i.CN)({...a,where:a.where?h.o.cloneWithOperation(a.where,"And",b):h.o.create(b)}),cloneWithJoin:(a,b)=>(0,i.CN)({...a,joins:a.joins?(0,i.CN)([...a.joins,b]):(0,i.CN)([b])}),cloneWithReturning:(a,b)=>(0,i.CN)({...a,returning:a.returning?j.cloneWithSelections(a.returning,b):j.create(b)}),cloneWithoutReturning:a=>(0,i.CN)({...a,returning:void 0}),cloneWithoutWhere:a=>(0,i.CN)({...a,where:void 0}),cloneWithExplain:(a,b,c)=>(0,i.CN)({...a,explain:k.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>(0,i.CN)({...a,top:b}),cloneWithOutput:(a,b)=>(0,i.CN)({...a,output:a.output?m.cloneWithSelections(a.output,b):m.create(b)}),cloneWithOrderByItems:(a,b)=>(0,i.CN)({...a,orderBy:a.orderBy?n.O.cloneWithItems(a.orderBy,b):n.O.create(b)}),cloneWithoutOrderBy:a=>(0,i.CN)({...a,orderBy:void 0})})},2642:(a,b,c)=>{"use strict";c.d(b,{G:()=>f});var d=c(7004),e=c(5788);async function f(a){let b=new d.c,c=new d.c;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),(0,e.CN)({connection:await b.promise,release:c.resolve})}},2863:(a,b,c)=>{"use strict";c.d(b,{q:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"ValueNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueNode",value:a}),createImmediate:a=>(0,d.CN)({kind:"ValueNode",value:a,immediate:!0})})},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3064:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(5788),e=c(6663),f=c(8107);let g=(0,d.CN)({is:a=>"OnNode"===a.kind,create:a=>(0,d.CN)({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,on:"And"===b?e.s.create(a.on,c):f.K.create(a.on,c)})}),h=(0,d.CN)({is:a=>"JoinNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:g.create(c)}),cloneWithOn:(a,b)=>(0,d.CN)({...a,on:a.on?g.cloneWithOperation(a.on,"And",b):g.create(b)})})},3300:(a,b,c)=>{"use strict";c.d(b,{P:()=>f});var d=c(5788),e=c(8208);let f=(0,d.CN)({is:a=>"CaseNode"===a.kind,create:a=>(0,d.CN)({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,when:(0,d.CN)(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,when:a.when?(0,d.CN)([...a.when.slice(0,-1),e.t.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},3721:(a,b,c)=>{"use strict";c.d(b,{Is:()=>k});var d=c(8740),e=c(6663),f=c(2325),g=c(9865),h=c(8107),i=c(2435),j=c(9411);class k{#E;constructor(a){this.#E=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#E,(0,j.GB)(a)))}and(...a){return new n(e.s.create(this.#E,(0,j.GB)(a)))}$castTo(){return new k(this.#E)}$notNull(){return new k(this.#E)}toOperationNode(){return this.#E}}class l{#ag;#ac;constructor(a,b){this.#ag=a,this.#ac=b}get expression(){return this.#ag}get alias(){return this.#ac}toOperationNode(){return d.N.create(this.#ag.toOperationNode(),(0,g.N)(this.#ac)?this.#ac.toOperationNode():f.O.create(this.#ac))}}class m{#E;constructor(a){this.#E=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#E,(0,j.GB)(a)))}$castTo(){return new m(this.#E)}toOperationNode(){return i.k.create(this.#E)}}class n{#E;constructor(a){this.#E=a}get expressionType(){}as(a){return new l(this,a)}and(...a){return new n(e.s.create(this.#E,(0,j.GB)(a)))}$castTo(){return new n(this.#E)}toOperationNode(){return i.k.create(this.#E)}}},3783:(a,b,c)=>{"use strict";c.d(b,{GQ:()=>u,EQ:()=>v,bl:()=>t});var d=c(3064),e=c(5788),f=c(9622);let g=(0,e.CN)({is:a=>"PartitionByNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByNode",items:(0,e.CN)(a)}),cloneWithItems:(a,b)=>(0,e.CN)({...a,items:(0,e.CN)([...a.items,...b])})}),h=(0,e.CN)({is:a=>"OverNode"===a.kind,create:()=>(0,e.CN)({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>(0,e.CN)({...a,orderBy:a.orderBy?f.O.cloneWithItems(a.orderBy,b):f.O.create(b)}),cloneWithPartitionByItems:(a,b)=>(0,e.CN)({...a,partitionBy:a.partitionBy?g.cloneWithItems(a.partitionBy,b):g.create(b)})});var i=c(8706),j=c(9411);class k{#a;constructor(a){this.#a=(0,e.CN)(a)}on(...a){return new k({...this.#a,joinNode:d.b.cloneWithOn(this.#a.joinNode,(0,j.GB)(a))})}onRef(a,b,c){return new k({...this.#a,joinNode:d.b.cloneWithOn(this.#a.joinNode,(0,j.vC)(a,b,c))})}onTrue(){return new k({...this.#a,joinNode:d.b.cloneWithOn(this.#a.joinNode,i.z.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#a.joinNode}}var l=c(2618),m=c(8976);let n=(0,e.CN)({is:a=>"PartitionByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByItemNode",partitionBy:a})});var o=c(4757);class p{#a;constructor(a){this.#a=(0,e.CN)(a)}orderBy(...a){return new p({overNode:h.cloneWithOrderByItems(this.#a.overNode,(0,m.xk)(a))})}clearOrderBy(){return new p({overNode:l.L.cloneWithoutOrderBy(this.#a.overNode)})}partitionBy(a){return new p({overNode:h.cloneWithPartitionByItems(this.#a.overNode,(0,o.kU)(a).map(n.create))})}$call(a){return a(this)}toOperationNode(){return this.#a.overNode}}var q=c(7515),r=c(6296),s=c(9758);function t(){return new q.n({executor:r.W})}function u(a,b){return new k({joinNode:d.b.create(a,(0,s.uJ)(b))})}function v(){return new p({overNode:h.create()})}},3859:(a,b,c)=>{"use strict";c.d(b,{Q:()=>i});var d=c(5788);let e=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],f=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],g=(0,d.CN)({is:a=>"DataTypeNode"===a.kind,create:a=>(0,d.CN)({kind:"DataTypeNode",dataType:a})});var h=c(9865);function i(a){if((0,h.N)(a))return a.toOperationNode();if(e.includes(a)||f.some(b=>b.test(a)))return g.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}},3892:(a,b,c)=>{"use strict";c.d(b,{o:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>(0,d.CN)({kind:"InsertQueryNode"}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},3948:(a,b,c)=>{"use strict";c.d(b,{i:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"SetOperationNode",operator:a,expression:b,all:c})})},3995:(a,b,c)=>{"use strict";c.d(b,{C:()=>h,g:()=>g});var d=c(9865),e=c(4757),f=c(5788);class g{#ah;get dynamicReference(){return this.#ah}get refType(){}constructor(a){this.#ah=a}toOperationNode(){return(0,e.vd)(this.#ah)}}function h(a){return(0,f.Gv)(a)&&(0,d.N)(a)&&(0,f.Kg)(a.dynamicReference)}},4063:(a,b,c)=>{"use strict";c.d(b,{l:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})})},4456:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"FromNode"===a.kind,create:a=>(0,d.CN)({kind:"FromNode",froms:(0,d.CN)(a)}),cloneWithFroms:(a,b)=>(0,d.CN)({...a,froms:(0,d.CN)([...a.froms,...b])})})},4584:(a,b,c)=>{"use strict";c.d(b,{U:()=>g});var d=c(5788),e=c(4456),f=c(2592);let g=(0,d.CN)({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"UpdateQueryNode",table:1===a.length?a[0]:f.v.create(a),...b&&{with:b}}),createWithoutTable:()=>(0,d.CN)({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>(0,d.CN)({...a,from:a.from?e.N.cloneWithFroms(a.from,b):e.N.create(b)}),cloneWithUpdates:(a,b)=>(0,d.CN)({...a,updates:a.updates?(0,d.CN)([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b})})},4586:(a,b,c)=>{"use strict";c.d(b,{Y:()=>f});var d=c(5788),e=c(7668);let f=(0,d.CN)({is:a=>"CreateViewNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateViewNode",name:e.y.create(a)}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},4757:(a,b,c)=>{"use strict";c.d(b,{$O:()=>r,DT:()=>u,NF:()=>s,Ow:()=>w,RY:()=>v,kU:()=>q,q5:()=>t,vd:()=>p});var d=c(8740),e=c(1078),f=c(7035),g=c(8572),h=c(5788),i=c(5397),j=c(2325),k=c(8976),l=c(4936),m=c(5998),n=c(9119),o=c(2170);function p(a){return(0,h.Kg)(a)?t(a):a.toOperationNode()}function q(a){return(0,h.MH)(a)?a.map(a=>r(a)):[r(a)]}function r(a){return(0,i.SS)(a)?(0,i.YK)(a):p(a)}function s(a,b){let c=t(a);if((0,l.Xm)(b))return m.Q.create(c,n.k.create(l.zX.create(b)));let d=b.slice(0,-1);if((0,l.Xm)(d))return m.Q.create(c,o.c.create(l.zX.create(d)));throw Error(`Invalid JSON operator: ${b}`)}function t(a){if(!a.includes("."))return f.q.create(e.Z.create(a));let b=a.split(".").map(x);if(3===b.length){var c=b;let[a,d,h]=c;return f.q.create(e.Z.create(h),g.H.createWithSchema(a,d))}if(2===b.length){var d=b;let[a,c]=d;return f.q.create(e.Z.create(c),g.H.create(a))}throw Error(`invalid column reference ${a}`)}function u(a){let b=" as ";if(!a.includes(b))return t(a);{let[c,e]=a.split(b).map(x);return d.N.create(t(c),j.O.create(e))}}function v(a){return e.Z.create(a)}function w(a){if(!a.includes(" "))return v(a);{let[b,c]=a.split(" ").map(x);if(!(0,k.bE)(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return(0,k.xk)([b,c])[0]}}function x(a){return a.trim()}},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4936:(a,b,c)=>{"use strict";c.d(b,{Xm:()=>h,we:()=>f,zX:()=>g});var d=c(5788);let e=["->","->>"],f=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...e,"not","-","exists","not exists","between","between symmetric"],g=(0,d.CN)({is:a=>"OperatorNode"===a.kind,create:a=>(0,d.CN)({kind:"OperatorNode",operator:a})});function h(a){return(0,d.Kg)(a)&&e.includes(a)}},4943:(a,b,c)=>{"use strict";c.d(b,{r:()=>f});var d=c(5788),e=c(8208);let f=(0,d.CN)({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:b}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens,b]):(0,d.CN)([b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens.slice(0,-1),e.t.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})})},5144:(a,b,c)=>{"use strict";c.d(b,{B:()=>f,o:()=>e});var d=c(5788);let e=["preserve rows","delete rows","drop"],f=(0,d.CN)({is:a=>"CreateTableNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateTableNode",table:a,columns:(0,d.CN)([])}),cloneWithColumn:(a,b)=>(0,d.CN)({...a,columns:(0,d.CN)([...a.columns,b])}),cloneWithConstraint:(a,b)=>(0,d.CN)({...a,constraints:a.constraints?(0,d.CN)([...a.constraints,b]):(0,d.CN)([b])}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithEndModifier:(a,b)=>(0,d.CN)({...a,endModifiers:a.endModifiers?(0,d.CN)([...a.endModifiers,b]):(0,d.CN)([b])}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},5147:(a,b,c)=>{"use strict";c.d(b,{u:()=>e});let d=new Set;function e(a){d.has(a)||(d.add(a),console.log(a))}},5152:(a,b,c)=>{"use strict";c.d(b,{h:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"PrimitiveValueListNode",values:(0,d.CN)([...a])})})},5242:a=>{"use strict";a.exports=require("@tursodatabase/turso")},5397:(a,b,c)=>{"use strict";c.d(b,{SS:()=>j,YK:()=>h,v0:()=>i});var d=c(7187),e=c(9865),f=c(8126),g=c(5788);function h(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function i(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function j(a){return(0,d.B)(a)||(0,d.q)(a)||(0,g.Tn)(a)}},5400:(a,b,c)=>{"use strict";c.d(b,{l:()=>r});var d=c(2325),e=c(9865),f=c(8706),g=c(2863),h=c(4757),i=c(9758),j=c(8853),k=c(7717),l=c(8740),m=c(5788),n=c(6296);class o{#a;constructor(a){this.#a=(0,m.CN)(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new q(this,a)}$castTo(){return new o({...this.#a})}$notNull(){return new o(this.#a)}withPlugin(a){return new o({...this.#a,plugins:void 0!==this.#a.plugins?(0,m.CN)([...this.#a.plugins,a]):(0,m.CN)([a])})}toOperationNode(){return this.#ai(this.#aj())}compile(a){return this.#ak(this.#aj(a))}async execute(a){let b=this.#aj(a);return b.executeQuery(this.#ak(b))}#aj(a){let b=void 0!==a?a.getExecutor():n.W;return void 0!==this.#a.plugins?b.withPlugins(this.#a.plugins):b}#ai(a){return a.transformQuery(this.#a.rawNode,this.#a.queryId)}#ak(a){return a.compileQuery(this.#ai(a),this.#a.queryId)}}function p(a){return new o(a)}class q{#al;#ac;constructor(a,b){this.#al=a,this.#ac=b}get expression(){return this.#al}get alias(){return this.#ac}get rawBuilder(){return this.#al}toOperationNode(){return l.N.create(this.#al.toOperationNode(),(0,e.N)(this.#ac)?this.#ac.toOperationNode():d.O.create(this.#ac))}}let r=Object.assign((a,...b)=>p({queryId:(0,k.a)(),rawNode:f.z.create(a,b?.map(s)??[])}),{ref:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,h.q5)(a))}),val:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,j.$s)(a))}),value(a){return this.val(a)},table:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,i.M$)(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",p({queryId:(0,k.a)(),rawNode:f.z.create(b,a.map(d.O.create))})},lit:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild(g.q.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithSql(a)}),join(a,b=r`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=s(a[b]),b!==a.length-1&&(c[2*b+1]=d);return p({queryId:(0,k.a)(),rawNode:f.z.createWithChildren(c)})}});function s(a){return(0,e.N)(a)?a.toOperationNode():(0,j.$s)(a)}},5532:(a,b,c)=>{"use strict";c.d(b,{e:()=>h});var d=c(5788),e=c(4456);let f=(0,d.CN)({is:a=>"UsingNode"===a.kind,create:a=>(0,d.CN)({kind:"UsingNode",tables:(0,d.CN)(a)}),cloneWithTables:(a,b)=>(0,d.CN)({...a,tables:(0,d.CN)([...a.tables,...b])})});var g=c(2618);let h=(0,d.CN)({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"DeleteQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>g.L.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>g.L.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:void 0!==a.using?f.cloneWithTables(a.using,b):f.create(b)})})},5788:(a,b,c)=>{"use strict";function d(a){return void 0===a||void 0===a}function e(a){return"string"==typeof a}function f(a){return"number"==typeof a}function g(a){return"boolean"==typeof a}function h(a){return null===a}function i(a){return a instanceof Date}function j(a){return"bigint"==typeof a}function k(a){return"undefined"!=typeof Buffer&&Buffer.isBuffer(a)}function l(a){return"function"==typeof a}function m(a){return"object"==typeof a&&null!==a}function n(a){return Object.freeze(a)}function o(a){return p(a)?a:[a]}function p(a){return Array.isArray(a)}function q(a){return a}c.d(b,{$P:()=>i,CN:()=>n,Et:()=>f,Gv:()=>m,Kg:()=>e,Lm:()=>g,MH:()=>p,Pe:()=>k,Tn:()=>l,_j:()=>o,b0:()=>d,kZ:()=>h,lQ:()=>q,sI:()=>j}),Object.prototype.toString},5998:(a,b,c)=>{"use strict";c.d(b,{Q:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>(0,d.CN)({...a,traversal:b})})},6296:(a,b,c)=>{"use strict";c.d(b,{W:()=>f});var d=c(6569);class e extends d.R{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new e([...this.plugins,a])}withPlugins(a){return new e([...this.plugins,...a])}withPluginAtFront(a){return new e([a,...this.plugins])}withoutPlugins(){return new e([])}}let f=new e},6331:(a,b,c)=>{"use strict";c.d(b,{E:()=>g});var d=c(8706),e=c(5788),f=c(7717);let g=(0,e.CN)({raw:(a,b=[])=>(0,e.CN)({sql:a,query:d.z.createWithSql(a),parameters:(0,e.CN)(b),queryId:(0,f.a)()})})},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},6502:(a,b,c)=>{"use strict";c.d(b,{U:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"SelectAllNode"===a.kind,create:()=>(0,d.CN)({kind:"SelectAllNode"})})},6559:(a,b,c)=>{"use strict";a.exports=c(4870)},6569:(a,b,c)=>{"use strict";c.d(b,{R:()=>h});var d=c(5788),e=c(2642),f=c(5147);let g=(0,d.CN)([]);class h{#am;constructor(a=g){this.#am=a}get plugins(){return this.#am}transformQuery(a,b){for(let c of this.#am){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a){return await this.provideConnection(async b=>{let c=await b.executeQuery(a);return"numUpdatedOrDeletedRows"in c&&(0,f.u)("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#an(c,a.queryId)})}async *stream(a,b){let{connection:c,release:d}=await (0,e.G)(this);try{for await(let d of c.streamQuery(a,b))yield await this.#an(d,a.queryId)}finally{d()}}async #an(a,b){for(let c of this.#am)a=await c.transformResult({result:a,queryId:b});return a}}},6576:(a,b,c)=>{"use strict";c.d(b,{f:()=>f});var d=c(5788);let e=(0,d.CN)({is:a=>"TopNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"TopNode",expression:a,modifiers:b})});function f(a,b){var c;if(!(0,d.Et)(a)&&!(0,d.sI)(a))throw Error(`Invalid top expression: ${a}`);if(!(0,d.b0)(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return e.create(a,b)}},6645:(a,b,c)=>{"use strict";c.d(b,{a:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"LimitNode"===a.kind,create:a=>(0,d.CN)({kind:"LimitNode",limit:a})})},6663:(a,b,c)=>{"use strict";c.d(b,{s:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"AndNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AndNode",left:a,right:b})})},6708:(a,b,c)=>{"use strict";c.d(b,{c:()=>D});var d=c(8740),e=c(5788);let f=(0,e.CN)({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>(0,e.CN)({kind:"SelectModifierNode",rawModifier:a})});var g=c(8896),h=c(9758),i=c(2378),j=c(4757),k=c(7880),l=c(2618),m=c(8976),n=c(6645);let o=(0,e.CN)({is:a=>"OffsetNode"===a.kind,create:a=>(0,e.CN)({kind:"OffsetNode",offset:a})}),p=(0,e.CN)({is:a=>"GroupByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"GroupByItemNode",groupBy:a})});var q=c(8126),r=c(1427),s=c(2325),t=c(3948),u=c(5397);function v(a,b,c){return(0,e.Tn)(b)&&(b=b((0,q.O)())),(0,e.MH)(b)||(b=[b]),b.map(b=>t.i.create(a,(0,u.YK)(b),c))}var w=c(9411),x=c(3721),y=c(8853),z=c(2863);let A={create:(a,b)=>({kind:"FetchNode",rowCount:z.q.create(a),modifier:b})};var B=c(6576);class C{#a;constructor(a){this.#a=(0,e.CN)(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new C({...this.#a,queryNode:l.L.cloneWithWhere(this.#a.queryNode,(0,w.GB)(a))})}whereRef(a,b,c){return new C({...this.#a,queryNode:l.L.cloneWithWhere(this.#a.queryNode,(0,w.vC)(a,b,c))})}having(...a){return new C({...this.#a,queryNode:k.L.cloneWithHaving(this.#a.queryNode,(0,w.GB)(a))})}havingRef(a,b,c){return new C({...this.#a,queryNode:k.L.cloneWithHaving(this.#a.queryNode,(0,w.vC)(a,b,c))})}select(a){return new C({...this.#a,queryNode:k.L.cloneWithSelections(this.#a.queryNode,(0,i.G)(a))})}distinctOn(a){return new C({...this.#a,queryNode:k.L.cloneWithDistinctOn(this.#a.queryNode,(0,j.kU)(a))})}modifyFront(a){return new C({...this.#a,queryNode:k.L.cloneWithFrontModifier(this.#a.queryNode,f.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.createWithExpression(a.toOperationNode()))})}distinct(){return new C({...this.#a,queryNode:k.L.cloneWithFrontModifier(this.#a.queryNode,f.create("Distinct"))})}forUpdate(a){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("ForUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}forShare(a){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("ForShare",a?(0,e._j)(a).map(h.M$):void 0))})}forKeyShare(a){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("ForKeyShare",a?(0,e._j)(a).map(h.M$):void 0))})}forNoKeyUpdate(a){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("ForNoKeyUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}skipLocked(){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("SkipLocked"))})}noWait(){return new C({...this.#a,queryNode:l.L.cloneWithEndModifier(this.#a.queryNode,f.create("NoWait"))})}selectAll(a){return new C({...this.#a,queryNode:k.L.cloneWithSelections(this.#a.queryNode,(0,i.J)(a))})}innerJoin(...a){return this.#ao("InnerJoin",a)}leftJoin(...a){return this.#ao("LeftJoin",a)}rightJoin(...a){return this.#ao("RightJoin",a)}fullJoin(...a){return this.#ao("FullJoin",a)}crossJoin(...a){return this.#ao("CrossJoin",a)}innerJoinLateral(...a){return this.#ao("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#ao("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#ao("LateralCrossJoin",a)}crossApply(...a){return this.#ao("CrossApply",a)}outerApply(...a){return this.#ao("OuterApply",a)}#ao(a,b){return new C({...this.#a,queryNode:l.L.cloneWithJoin(this.#a.queryNode,(0,g.a)(a,b))})}orderBy(...a){return new C({...this.#a,queryNode:l.L.cloneWithOrderByItems(this.#a.queryNode,(0,m.xk)(a))})}groupBy(a){var b;return new C({...this.#a,queryNode:k.L.cloneWithGroupByItems(this.#a.queryNode,(b=a,b=(0,e.Tn)(b)?b((0,q.A)()):b,(0,j.kU)(b).map(p.create)))})}limit(a){return new C({...this.#a,queryNode:k.L.cloneWithLimit(this.#a.queryNode,n.a.create((0,y.$s)(a)))})}offset(a){return new C({...this.#a,queryNode:k.L.cloneWithOffset(this.#a.queryNode,o.create((0,y.$s)(a)))})}fetch(a,b="only"){return new C({...this.#a,queryNode:k.L.cloneWithFetch(this.#a.queryNode,function(a,b){var c;if(!(0,e.Et)(a)&&!(0,e.sI)(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return A.create(a,b)}(a,b))})}top(a,b){return new C({...this.#a,queryNode:l.L.cloneWithTop(this.#a.queryNode,(0,B.f)(a,b))})}union(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("union",a,!1))})}unionAll(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("union",a,!0))})}intersect(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("intersect",a,!1))})}intersectAll(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("intersect",a,!0))})}except(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("except",a,!1))})}exceptAll(a){return new C({...this.#a,queryNode:k.L.cloneWithSetOperations(this.#a.queryNode,v("except",a,!0))})}as(a){return new E(this,a)}clearSelect(){return new C({...this.#a,queryNode:k.L.cloneWithoutSelections(this.#a.queryNode)})}clearWhere(){return new C({...this.#a,queryNode:l.L.cloneWithoutWhere(this.#a.queryNode)})}clearLimit(){return new C({...this.#a,queryNode:k.L.cloneWithoutLimit(this.#a.queryNode)})}clearOffset(){return new C({...this.#a,queryNode:k.L.cloneWithoutOffset(this.#a.queryNode)})}clearOrderBy(){return new C({...this.#a,queryNode:l.L.cloneWithoutOrderBy(this.#a.queryNode)})}clearGroupBy(){return new C({...this.#a,queryNode:k.L.cloneWithoutGroupBy(this.#a.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new C({...this.#a})}$castTo(){return new C(this.#a)}$narrowType(){return new C(this.#a)}$assertType(){return new C(this.#a)}$asTuple(){return new x.Is(this.toOperationNode())}$asScalar(){return new x.Is(this.toOperationNode())}withPlugin(a){return new C({...this.#a,executor:this.#a.executor.withPlugin(a)})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.queryNode,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){let a=this.compile();return(await this.#a.executor.executeQuery(a)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=r.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,r.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#a.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new C({...this.#a,queryNode:l.L.cloneWithExplain(this.#a.queryNode,a,b)});return await c.execute()}}function D(a){return new C(a)}class E{#ap;#ac;constructor(a,b){this.#ap=a,this.#ac=b}get expression(){return this.#ap}get alias(){return this.#ac}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return d.N.create(this.#ap.toOperationNode(),s.O.create(this.#ac))}}},6946:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(898),e=c(2471),f=c(7912);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},7004:(a,b,c)=>{"use strict";c.d(b,{c:()=>d});class d{#f;#g;#aq;constructor(){this.#f=new Promise((a,b)=>{this.#aq=b,this.#g=a})}get promise(){return this.#f}resolve=a=>{this.#g&&this.#g(a)};reject=a=>{this.#aq&&this.#aq(a)}}},7035:(a,b,c)=>{"use strict";c.d(b,{q:()=>f});var d=c(6502),e=c(5788);let f=(0,e.CN)({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>(0,e.CN)({kind:"ReferenceNode",table:a,column:d.U.create()})})},7052:(a,b,c)=>{"use strict";c.d(b,{V:()=>e});var d=c(5788);class e{nodeStack=[];#ar=(0,d.CN)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),(0,d.CN)(c)}transformNodeImpl(a,b){return this.#ar[a.kind](a,b)}transformNodeList(a,b){return a?(0,d.CN)(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:(0,d.CN)([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}},7085:(a,b,c)=>{"use strict";c.d(b,{o:()=>g});var d=c(5788),e=c(6663),f=c(8107);let g=(0,d.CN)({is:a=>"WhereNode"===a.kind,create:a=>(0,d.CN)({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,where:"And"===b?e.s.create(a.where,c):f.K.create(a.where,c)})})},7187:(a,b,c)=>{"use strict";c.d(b,{B:()=>f,q:()=>g});var d=c(9865),e=c(5788);function f(a){return(0,e.Gv)(a)&&"expressionType"in a&&(0,d.N)(a)}function g(a){return(0,e.Gv)(a)&&"expression"in a&&(0,e.Kg)(a.alias)&&(0,d.N)(a)}},7460:(a,b,c)=>{"use strict";c.d(b,{s:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"ValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueListNode",values:(0,d.CN)(a)})})},7515:(a,b,c)=>{"use strict";c.d(b,{n:()=>an});var d=c(6708),e=c(2378),f=c(1078),g=c(5152),h=c(7460),i=c(5788),j=c(8853);let k=(0,i.CN)({is:a=>"ValuesNode"===a.kind,create:a=>(0,i.CN)({kind:"ValuesNode",values:(0,i.CN)(a)})});var l=c(5397);let m=(0,i.CN)({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>(0,i.CN)({kind:"DefaultInsertValueNode"})});var n=c(8126);function o(a){let b=(0,i.Tn)(a)?a((0,n.A)()):a;var c=(0,i.MH)(b)?b:(0,i.CN)([b]);let d=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(c);return[(0,i.CN)([...d.keys()].map(f.Z.create)),k.create(c.map(a=>(function(a,b){let c=Object.keys(a),d=Array.from({length:b.size}),e=!1,f=c.length;for(let g of c){let c=b.get(g);if((0,i.b0)(c)){f--;continue}let h=a[g];((0,i.b0)(h)||(0,l.SS)(h))&&(e=!0),d[c]=h}if(f<b.size||e){let a=m.create();return h.s.create(d.map(b=>(0,i.b0)(b)?a:(0,j.$s)(b)))}return g.h.create(d)})(a,d)))]}var p=c(3892),q=c(2618);let r=(0,i.CN)({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ColumnUpdateNode",column:a,value:b})});var s=c(4757);function t(a){return Object.entries((0,i.Tn)(a)?a((0,n.A)()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>r.create(f.Z.create(a),(0,j.$s)(b)))}let u=(0,i.CN)({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>(0,i.CN)({kind:"OnDuplicateKeyNode",updates:a})});class v{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}var w=c(1427),x=c(2325),y=c(7085);let z=(0,i.CN)({is:a=>"OnConflictNode"===a.kind,create:()=>(0,i.CN)({kind:"OnConflictNode"}),cloneWith:(a,b)=>(0,i.CN)({...a,...b}),cloneWithIndexWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"And",b):y.o.create(b)}),cloneWithIndexOrWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"Or",b):y.o.create(b)}),cloneWithUpdateWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"And",b):y.o.create(b)}),cloneWithUpdateOrWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"Or",b):y.o.create(b)}),cloneWithoutIndexWhere:a=>(0,i.CN)({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>(0,i.CN)({...a,updateWhere:void 0})});var A=c(9411);class B{#a;constructor(a){this.#a=(0,i.CN)(a)}column(a){let b=f.Z.create(a);return new B({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{columns:this.#a.onConflictNode.columns?(0,i.CN)([...this.#a.onConflictNode.columns,b]):(0,i.CN)([b])})})}columns(a){let b=a.map(f.Z.create);return new B({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{columns:this.#a.onConflictNode.columns?(0,i.CN)([...this.#a.onConflictNode.columns,...b]):(0,i.CN)(b)})})}constraint(a){return new B({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{constraint:x.O.create(a)})})}expression(a){return new B({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new B({...this.#a,onConflictNode:z.cloneWithIndexWhere(this.#a.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new B({...this.#a,onConflictNode:z.cloneWithIndexWhere(this.#a.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new B({...this.#a,onConflictNode:z.cloneWithoutIndexWhere(this.#a.onConflictNode)})}doNothing(){return new C({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new D({...this.#a,onConflictNode:z.cloneWith(this.#a.onConflictNode,{updates:t(a)})})}$call(a){return a(this)}}class C{#a;constructor(a){this.#a=(0,i.CN)(a)}toOperationNode(){return this.#a.onConflictNode}}class D{#a;constructor(a){this.#a=(0,i.CN)(a)}where(...a){return new D({...this.#a,onConflictNode:z.cloneWithUpdateWhere(this.#a.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new D({...this.#a,onConflictNode:z.cloneWithUpdateWhere(this.#a.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new D({...this.#a,onConflictNode:z.cloneWithoutUpdateWhere(this.#a.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#a.onConflictNode}}var E=c(6576);let F=(0,i.CN)({is:a=>"OrActionNode"===a.kind,create:a=>(0,i.CN)({kind:"OrActionNode",action:a})});class G{#a;constructor(a){this.#a=(0,i.CN)(a)}values(a){let[b,c]=o(a);return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{columns:b,values:c})})}columns(a){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{columns:(0,i.CN)(a.map(f.Z.create))})})}expression(a){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{values:(0,l.YK)(a)})})}defaultValues(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{defaultValues:!0})})}modifyEnd(a){return new G({...this.#a,queryNode:q.L.cloneWithEndModifier(this.#a.queryNode,a.toOperationNode())})}ignore(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("ignore")})})}orIgnore(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("ignore")})})}orAbort(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("abort")})})}orFail(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("fail")})})}orReplace(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("replace")})})}orRollback(){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{orAction:F.create("rollback")})})}top(a,b){return new G({...this.#a,queryNode:q.L.cloneWithTop(this.#a.queryNode,(0,E.f)(a,b))})}onConflict(a){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{onConflict:a(new B({onConflictNode:z.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new G({...this.#a,queryNode:p.o.cloneWith(this.#a.queryNode,{onDuplicateKey:u.create(t(a))})})}returning(a){return new G({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.G)(a))})}returningAll(){return new G({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.J)())})}output(a){return new G({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.G)(a))})}outputAll(a){return new G({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.J)(a))})}clearReturning(){return new G({...this.#a,queryNode:q.L.cloneWithoutReturning(this.#a.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new G({...this.#a})}$castTo(){return new G(this.#a)}$narrowType(){return new G(this.#a)}$assertType(){return new G(this.#a)}withPlugin(a){return new G({...this.#a,executor:this.#a.executor.withPlugin(a)})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.queryNode,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){let a=this.compile(),b=await this.#a.executor.executeQuery(a),{adapter:c}=this.#a.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new v(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#a.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new G({...this.#a,queryNode:q.L.cloneWithExplain(this.#a.queryNode,a,b)});return await c.execute()}}var H=c(8896),I=c(9758);class J{numDeletedRows;constructor(a){this.numDeletedRows=a}}var K=c(5532),L=c(6645),M=c(8976);class N{#a;constructor(a){this.#a=(0,i.CN)(a)}where(...a){return new N({...this.#a,queryNode:q.L.cloneWithWhere(this.#a.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new N({...this.#a,queryNode:q.L.cloneWithWhere(this.#a.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new N({...this.#a,queryNode:q.L.cloneWithoutWhere(this.#a.queryNode)})}top(a,b){return new N({...this.#a,queryNode:q.L.cloneWithTop(this.#a.queryNode,(0,E.f)(a,b))})}using(a){return new N({...this.#a,queryNode:K.e.cloneWithUsing(this.#a.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#ao("InnerJoin",a)}leftJoin(...a){return this.#ao("LeftJoin",a)}rightJoin(...a){return this.#ao("RightJoin",a)}fullJoin(...a){return this.#ao("FullJoin",a)}#ao(a,b){return new N({...this.#a,queryNode:q.L.cloneWithJoin(this.#a.queryNode,(0,H.a)(a,b))})}returning(a){return new N({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.G)(a))})}returningAll(a){return new N({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.J)(a))})}output(a){return new N({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.G)(a))})}outputAll(a){return new N({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.J)(a))})}clearReturning(){return new N({...this.#a,queryNode:q.L.cloneWithoutReturning(this.#a.queryNode)})}clearLimit(){return new N({...this.#a,queryNode:K.e.cloneWithoutLimit(this.#a.queryNode)})}orderBy(...a){return new N({...this.#a,queryNode:q.L.cloneWithOrderByItems(this.#a.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new N({...this.#a,queryNode:q.L.cloneWithoutOrderBy(this.#a.queryNode)})}limit(a){return new N({...this.#a,queryNode:K.e.cloneWithLimit(this.#a.queryNode,L.a.create((0,j.$s)(a)))})}modifyEnd(a){return new N({...this.#a,queryNode:q.L.cloneWithEndModifier(this.#a.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new N({...this.#a})}$castTo(){return new N(this.#a)}$narrowType(){return new N(this.#a)}$assertType(){return new N(this.#a)}withPlugin(a){return new N({...this.#a,executor:this.#a.executor.withPlugin(a)})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.queryNode,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){let a=this.compile(),b=await this.#a.executor.executeQuery(a),{adapter:c}=this.#a.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new J(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#a.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new N({...this.#a,queryNode:q.L.cloneWithExplain(this.#a.queryNode,a,b)});return await c.execute()}}var O=c(4584);class P{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class Q{#a;constructor(a){this.#a=(0,i.CN)(a)}where(...a){return new Q({...this.#a,queryNode:q.L.cloneWithWhere(this.#a.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new Q({...this.#a,queryNode:q.L.cloneWithWhere(this.#a.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new Q({...this.#a,queryNode:q.L.cloneWithoutWhere(this.#a.queryNode)})}top(a,b){return new Q({...this.#a,queryNode:q.L.cloneWithTop(this.#a.queryNode,(0,E.f)(a,b))})}from(a){return new Q({...this.#a,queryNode:O.U.cloneWithFromItems(this.#a.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#ao("InnerJoin",a)}leftJoin(...a){return this.#ao("LeftJoin",a)}rightJoin(...a){return this.#ao("RightJoin",a)}fullJoin(...a){return this.#ao("FullJoin",a)}#ao(a,b){return new Q({...this.#a,queryNode:q.L.cloneWithJoin(this.#a.queryNode,(0,H.a)(a,b))})}orderBy(...a){return new Q({...this.#a,queryNode:q.L.cloneWithOrderByItems(this.#a.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new Q({...this.#a,queryNode:q.L.cloneWithoutOrderBy(this.#a.queryNode)})}limit(a){return new Q({...this.#a,queryNode:O.U.cloneWithLimit(this.#a.queryNode,L.a.create((0,j.$s)(a)))})}set(...a){return new Q({...this.#a,queryNode:O.U.cloneWithUpdates(this.#a.queryNode,function(...a){return 2===a.length?[r.create((0,s.$O)(a[0]),(0,j.$s)(a[1]))]:t(a[0])}(...a))})}returning(a){return new Q({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.G)(a))})}returningAll(a){return new Q({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.J)(a))})}output(a){return new Q({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.G)(a))})}outputAll(a){return new Q({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.J)(a))})}modifyEnd(a){return new Q({...this.#a,queryNode:q.L.cloneWithEndModifier(this.#a.queryNode,a.toOperationNode())})}clearReturning(){return new Q({...this.#a,queryNode:q.L.cloneWithoutReturning(this.#a.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new Q({...this.#a})}$castTo(){return new Q(this.#a)}$narrowType(){return new Q(this.#a)}$assertType(){return new Q(this.#a)}withPlugin(a){return new Q({...this.#a,executor:this.#a.executor.withPlugin(a)})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.queryNode,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){let a=this.compile(),b=await this.#a.executor.executeQuery(a),{adapter:c}=this.#a.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new P(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#a.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new Q({...this.#a,queryNode:q.L.cloneWithExplain(this.#a.queryNode,a,b)});return await c.execute()}}var R=c(7880),S=c(8572);let T=(0,i.CN)({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNameNode",table:S.H.create(a),columns:b?(0,i.CN)(b.map(f.Z.create)):void 0})});var U=c(3783);let V=(0,i.CN)({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>(0,i.CN)({...a,...b})});class W{#a;constructor(a){this.#a=(0,i.CN)(a)}materialized(){return new W({...this.#a,node:V.cloneWith(this.#a.node,{materialized:!0})})}notMaterialized(){return new W({...this.#a,node:V.cloneWith(this.#a.node,{materialized:!1})})}toOperationNode(){return this.#a.node}}function X(a,b){var c;let d=b((0,U.bl)()).toOperationNode();return(0,i.Tn)(a)?a((c=d,a=>new W({node:V.create(Y(a),c)}))).toOperationNode():V.create(Y(a),d)}function Y(a){if(!a.includes("("))return T.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return T.create(c,d)}}let Z=(0,i.CN)({is:a=>"WithNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"WithNode",expressions:(0,i.CN)([a]),...b}),cloneWithExpression:(a,b)=>(0,i.CN)({...a,expressions:(0,i.CN)([...a.expressions,b])})});var $=c(7717),_=c(8789),aa=c(4943);let ab=(0,i.CN)({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>(0,i.CN)({kind:"MatchedNode",not:a,bySource:b})});var ac=c(9865),ad=c(8706),ae=c(8208);function af(a,b,c){return ae.t.create((0,A.KN)([ab.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?(0,A.vC)(b[0],b[1],b[2]):(0,A.GB)(b)]:[]],"and",!1))}function ag(a){return(0,i.Kg)(a)?ad.z.create([a],[]):(0,ac.N)(a)?a.toOperationNode():a}var ah=c(6296);class ai{numChangedRows;constructor(a){this.numChangedRows=a}}class aj{#a;constructor(a){this.#a=(0,i.CN)(a)}modifyEnd(a){return new aj({...this.#a,queryNode:q.L.cloneWithEndModifier(this.#a.queryNode,a.toOperationNode())})}top(a,b){return new aj({...this.#a,queryNode:q.L.cloneWithTop(this.#a.queryNode,(0,E.f)(a,b))})}using(...a){return new ak({...this.#a,queryNode:aa.r.cloneWithUsing(this.#a.queryNode,(0,H.a)("Using",a))})}returning(a){return new aj({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.G)(a))})}returningAll(a){return new aj({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.J)(a))})}output(a){return new aj({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.G)(a))})}outputAll(a){return new aj({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.J)(a))})}}class ak{#a;constructor(a){this.#a=(0,i.CN)(a)}modifyEnd(a){return new ak({...this.#a,queryNode:q.L.cloneWithEndModifier(this.#a.queryNode,a.toOperationNode())})}top(a,b){return new ak({...this.#a,queryNode:q.L.cloneWithTop(this.#a.queryNode,(0,E.f)(a,b))})}whenMatched(){return this.#as([])}whenMatchedAnd(...a){return this.#as(a)}whenMatchedAndRef(a,b,c){return this.#as([a,b,c],!0)}#as(a,b){return new al({...this.#a,queryNode:aa.r.cloneWithWhen(this.#a.queryNode,af({isMatched:!0},a,b))})}whenNotMatched(){return this.#at([])}whenNotMatchedAnd(...a){return this.#at(a)}whenNotMatchedAndRef(a,b,c){return this.#at([a,b,c],!0)}whenNotMatchedBySource(){return this.#at([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#at(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#at([a,b,c],!0,!0)}returning(a){return new ak({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.G)(a))})}returningAll(a){return new ak({...this.#a,queryNode:q.L.cloneWithReturning(this.#a.queryNode,(0,e.J)(a))})}output(a){return new ak({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.G)(a))})}outputAll(a){return new ak({...this.#a,queryNode:q.L.cloneWithOutput(this.#a.queryNode,(0,e.J)(a))})}#at(a,b=!1,c=!1){let d={...this.#a,queryNode:aa.r.cloneWithWhen(this.#a.queryNode,af({isMatched:!1,bySource:c},a,b))};return new(c?al:am)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new ak({...this.#a})}toOperationNode(){return this.#a.executor.transformQuery(this.#a.queryNode,this.#a.queryId)}compile(){return this.#a.executor.compileQuery(this.toOperationNode(),this.#a.queryId)}async execute(){let a=this.compile(),b=await this.#a.executor.executeQuery(a),{adapter:c}=this.#a.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new ai(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class al{#a;constructor(a){this.#a=(0,i.CN)(a)}thenDelete(){return new ak({...this.#a,queryNode:aa.r.cloneWithThen(this.#a.queryNode,ag("delete"))})}thenDoNothing(){return new ak({...this.#a,queryNode:aa.r.cloneWithThen(this.#a.queryNode,ag("do nothing"))})}thenUpdate(a){return new ak({...this.#a,queryNode:aa.r.cloneWithThen(this.#a.queryNode,ag(a(new Q({queryId:this.#a.queryId,executor:ah.W,queryNode:O.U.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class am{#a;constructor(a){this.#a=(0,i.CN)(a)}thenDoNothing(){return new ak({...this.#a,queryNode:aa.r.cloneWithThen(this.#a.queryNode,ag("do nothing"))})}thenInsertValues(a){let[b,c]=o(a);return new ak({...this.#a,queryNode:aa.r.cloneWithThen(this.#a.queryNode,ag(p.o.cloneWith(p.o.createWithoutInto(),{columns:b,values:c})))})}}class an{#a;constructor(a){this.#a=(0,i.CN)(a)}selectFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:R.L.createFrom((0,I.JB)(a),this.#a.withNode)})}selectNoFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:R.L.cloneWithSelections(R.L.create(this.#a.withNode),(0,e.G)(a))})}insertInto(a){return new G({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:p.o.create((0,I.M$)(a),this.#a.withNode)})}replaceInto(a){return new G({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:p.o.create((0,I.M$)(a),this.#a.withNode,!0)})}deleteFrom(a){return new N({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:K.e.create((0,I.JB)(a),this.#a.withNode)})}updateTable(a){return new Q({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:O.U.create((0,I.JB)(a),this.#a.withNode)})}mergeInto(a){return new aj({queryId:(0,$.a)(),executor:this.#a.executor,queryNode:aa.r.create((0,I.Xm)(a),this.#a.withNode)})}with(a,b){let c=X(a,b);return new an({...this.#a,withNode:this.#a.withNode?Z.cloneWithExpression(this.#a.withNode,c):Z.create(c)})}withRecursive(a,b){let c=X(a,b);return new an({...this.#a,withNode:this.#a.withNode?Z.cloneWithExpression(this.#a.withNode,c):Z.create(c,{recursive:!0})})}withPlugin(a){return new an({...this.#a,executor:this.#a.executor.withPlugin(a)})}withoutPlugins(){return new an({...this.#a,executor:this.#a.executor.withoutPlugins()})}withSchema(a){return new an({...this.#a,executor:this.#a.executor.withPluginAtFront(new _.B(a))})}}},7655:(a,b,c)=>{"use strict";c.d(b,{t:()=>u});var d=c(3721),e=c(5788),f=c(7085),g=c(9622);let h=(0,e.CN)({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>(0,e.CN)({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>(0,e.CN)({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return(0,e.CN)({...a,[d]:a[d]?g.O.cloneWithItems(a[d],b):g.O.create(b)})},cloneWithFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"And",b):f.o.create(b)}),cloneWithOrFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"Or",b):f.o.create(b)}),cloneWithOver:(a,b)=>(0,e.CN)({...a,over:b})}),i=(0,e.CN)({is:a=>"FunctionNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"FunctionNode",func:a,arguments:b})});var j=c(4757),k=c(2378),l=c(8740),m=c(2325),n=c(3783),o=c(9411),p=c(8976),q=c(2618);class r{#a;constructor(a){this.#a=(0,e.CN)(a)}get expressionType(){}as(a){return new s(this,a)}distinct(){return new r({...this.#a,aggregateFunctionNode:h.cloneWithDistinct(this.#a.aggregateFunctionNode)})}orderBy(...a){return new r({...this.#a,aggregateFunctionNode:q.L.cloneWithOrderByItems(this.#a.aggregateFunctionNode,(0,p.xk)(a))})}clearOrderBy(){return new r({...this.#a,aggregateFunctionNode:q.L.cloneWithoutOrderBy(this.#a.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new r({...this.#a,aggregateFunctionNode:h.cloneWithOrderBy(this.#a.aggregateFunctionNode,(0,p.xk)(a),!0)})}filterWhere(...a){return new r({...this.#a,aggregateFunctionNode:h.cloneWithFilter(this.#a.aggregateFunctionNode,(0,o.GB)(a))})}filterWhereRef(a,b,c){return new r({...this.#a,aggregateFunctionNode:h.cloneWithFilter(this.#a.aggregateFunctionNode,(0,o.vC)(a,b,c))})}over(a){let b=(0,n.EQ)();return new r({...this.#a,aggregateFunctionNode:h.cloneWithOver(this.#a.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new r(this.#a)}$notNull(){return new r(this.#a)}toOperationNode(){return this.#a.aggregateFunctionNode}}class s{#au;#ac;constructor(a,b){this.#au=a,this.#ac=b}get expression(){return this.#au}get alias(){return this.#ac}toOperationNode(){return l.N.create(this.#au.toOperationNode(),m.O.create(this.#ac))}}var t=c(9758);function u(){let a=(a,b)=>new d.Is(i.create(a,(0,j.kU)(b??[]))),b=(a,b)=>new r({aggregateFunctionNode:h.create(a,b?(0,j.kU)(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new r({aggregateFunctionNode:h.create("count",(0,k.J)(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new r({aggregateFunctionNode:h.create("json_agg",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()])}),toJson:a=>new d.Is(i.create("to_json",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()]))})}},7668:(a,b,c)=>{"use strict";c.d(b,{y:()=>f});var d=c(5788),e=c(2325);let f=(0,d.CN)({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"SchemableIdentifierNode",identifier:e.O.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"SchemableIdentifierNode",schema:e.O.create(a),identifier:e.O.create(b)})})},7717:(a,b,c)=>{"use strict";c.d(b,{a:()=>e});var d=c(1584);function e(){return new f}class f{#av;get queryId(){return void 0===this.#av&&(this.#av=(0,d.D)(8)),this.#av}}},7880:(a,b,c)=>{"use strict";c.d(b,{L:()=>k});var d=c(5788),e=c(4456);let f=(0,d.CN)({is:a=>"GroupByNode"===a.kind,create:a=>(0,d.CN)({kind:"GroupByNode",items:(0,d.CN)(a)}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})});var g=c(6663),h=c(8107);let i=(0,d.CN)({is:a=>"HavingNode"===a.kind,create:a=>(0,d.CN)({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,having:"And"===b?g.s.create(a.having,c):h.K.create(a.having,c)})});var j=c(2618);let k=(0,d.CN)({is:a=>"SelectQueryNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>(0,d.CN)({kind:"SelectQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>(0,d.CN)({...a,selections:a.selections?(0,d.CN)([...a.selections,...b]):(0,d.CN)(b)}),cloneWithDistinctOn:(a,b)=>(0,d.CN)({...a,distinctOn:a.distinctOn?(0,d.CN)([...a.distinctOn,...b]):(0,d.CN)(b)}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithOrderByItems:(a,b)=>j.L.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>(0,d.CN)({...a,groupBy:a.groupBy?f.cloneWithItems(a.groupBy,b):f.create(b)}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithOffset:(a,b)=>(0,d.CN)({...a,offset:b}),cloneWithFetch:(a,b)=>(0,d.CN)({...a,fetch:b}),cloneWithHaving:(a,b)=>(0,d.CN)({...a,having:a.having?i.cloneWithOperation(a.having,"And",b):i.create(b)}),cloneWithSetOperations:(a,b)=>(0,d.CN)({...a,setOperations:a.setOperations?(0,d.CN)([...a.setOperations,...b]):(0,d.CN)([...b])}),cloneWithoutSelections:a=>(0,d.CN)({...a,selections:[]}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithoutOffset:a=>(0,d.CN)({...a,offset:void 0}),cloneWithoutOrderBy:a=>j.L.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>(0,d.CN)({...a,groupBy:void 0})})},8107:(a,b,c)=>{"use strict";c.d(b,{K:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"OrNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"OrNode",left:a,right:b})})},8126:(a,b,c)=>{"use strict";c.d(b,{O:()=>K,A:()=>L});var d=c(6708),e=c(7880),f=c(9758),g=c(8789),h=c(7717),i=c(7655),j=c(4757),k=c(9411),l=c(2435),m=c(3721),n=c(4936),o=c(5788);let p=(0,o.CN)({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"UnaryOperationNode",operator:a,operand:b})});var q=c(8853),r=c(6296),s=c(813),t=c(3300),u=c(8740),v=c(2325),w=c(9119);let x=(0,o.CN)({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"JSONPathLegNode",type:a,value:b})});var y=c(2170),z=c(5998),A=c(9865),B=c(2863);class C{#E;constructor(a){this.#E=a}at(a){return this.#aw("ArrayLocation",a)}key(a){return this.#aw("Member",a)}#aw(a,b){return new D(z.Q.is(this.#E)?z.Q.cloneWithTraversal(this.#E,y.c.is(this.#E.traversal)?y.c.cloneWithLeg(this.#E.traversal,x.create(a,b)):w.k.cloneWithValue(this.#E.traversal,B.q.createImmediate(b))):y.c.cloneWithLeg(this.#E,x.create(a,b)))}}class D extends C{#E;constructor(a){super(a),this.#E=a}get expressionType(){}as(a){return new E(this,a)}$castTo(){return new D(this.#E)}$notNull(){return new D(this.#E)}toOperationNode(){return this.#E}}class E{#ax;#ac;constructor(a,b){this.#ax=a,this.#ac=b}get expression(){return this.#ax}get alias(){return this.#ac}toOperationNode(){return u.N.create(this.#ax.toOperationNode(),(0,A.N)(this.#ac)?this.#ac.toOperationNode():v.O.create(this.#ac))}}var F=c(4063),G=c(6663);let H=(0,o.CN)({is:a=>"TupleNode"===a.kind,create:a=>(0,o.CN)({kind:"TupleNode",values:(0,o.CN)(a)})});var I=c(3859);let J=(0,o.CN)({is:a=>"CastNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"CastNode",expression:a,dataType:b})});function K(a=r.W){function b(a,b){return new m.Is(p.create(n.zX.create(a),(0,j.$O)(b)))}let c=Object.assign(function(a,b,c){return new m.Is((0,k.ds)(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>(0,d.c)({queryId:(0,h.a)(),executor:a,queryNode:e.L.createFrom((0,f.JB)(b))}),case:a=>new s.OU({node:t.P.create((0,o.b0)(a)?void 0:(0,j.$O)(a))}),ref:(a,b)=>(0,o.b0)(b)?new m.Is((0,j.q5)(a)):new C((0,j.NF)(a,b)),jsonPath:()=>new C(y.c.create()),table:a=>new m.Is((0,f.M$)(a)),val:a=>new m.Is((0,q.$s)(a)),refTuple:(...a)=>new m.Is(H.create(a.map(j.$O))),tuple:(...a)=>new m.Is(H.create(a.map(q.$s))),lit:a=>new m.Is((0,q.dJ)(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),betweenSymmetric:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between symmetric"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),and:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"and"):(0,k.Ve)(a,"and")),or:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"or"):(0,k.Ve)(a,"or")),parens(...a){let b=(0,k.GB)(a);return new m.Is(l.k.is(b)?b:l.k.create(b))},cast:(a,b)=>new m.Is(J.create((0,j.$O)(a),(0,I.Q)(b))),withSchema:b=>K(a.withPluginAtFront(new g.B(b)))});return c.fn=(0,i.t)(),c.eb=c,c}function L(a){return K()}},8208:(a,b,c)=>{"use strict";c.d(b,{t:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"WhenNode"===a.kind,create:a=>(0,d.CN)({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>(0,d.CN)({...a,result:b})})},8335:()=>{},8572:(a,b,c)=>{"use strict";c.d(b,{H:()=>f});var d=c(5788),e=c(7668);let f=(0,d.CN)({is:a=>"TableNode"===a.kind,create:a=>(0,d.CN)({kind:"TableNode",table:e.y.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"TableNode",table:e.y.createWithSchema(a,b)})})},8706:(a,b,c)=>{"use strict";c.d(b,{z:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"RawNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"RawNode",sqlFragments:(0,d.CN)(a),parameters:(0,d.CN)(b)}),createWithSql:a=>e.create([a],[]),createWithChild:a=>e.create(["",""],[a]),createWithChildren:a=>e.create(Array(a.length+1).fill(""),a)})},8740:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"AliasNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AliasNode",node:a,alias:b})})},8789:(a,b,c)=>{"use strict";c.d(b,{B:()=>m});var d=c(8740),e=c(2325),f=c(2592),g=c(7052),h=c(7668),i=c(8572);let j=(0,c(5788).CN)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),k={json_agg:!0,to_json:!0};class l extends g.V{#ay;#az=new Set;#aA=new Set;constructor(a){super(),this.#ay=a}transformNodeImpl(a,b){if(!this.#aB(a))return super.transformNodeImpl(a,b);let c=this.#aC(a);for(let a of c)this.#aA.add(a);let d=this.#aD(a);for(let a of d)this.#az.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#az.delete(a);for(let a of c)this.#aA.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#az.has(a.identifier.name)?c:{...c,schema:e.O.create(this.#ay)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:i.H.createWithSchema(this.#ay,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#aE(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#aE(a,b,"arguments")}}#aE(a,b,c){return k[a.func]?a[c].map(a=>!i.H.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#aB(a){return a.kind in j}#aD(a){let b=new Set;if("name"in a&&a.name&&h.y.is(a.name)&&this.#aF(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#aG(c,b);if("into"in a&&a.into&&this.#aG(a.into,b),"table"in a&&a.table&&this.#aG(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#aG(c.table,b);return"using"in a&&a.using&&this.#aG(a.using,b),b}#aC(a){let b=new Set;return"with"in a&&a.with&&this.#aH(a.with,b),b}#aG(a,b){if(i.H.is(a))this.#aF(a.table,b);else if(d.N.is(a)&&i.H.is(a.node))this.#aF(a.node.table,b);else if(f.v.is(a))for(let c of a.items)this.#aG(c,b)}#aF(a,b){let c=a.identifier.name;this.#az.has(c)||this.#aA.has(c)||b.add(c)}#aH(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#aA.has(a)||b.add(a)}}}class m{#H;constructor(a){this.#H=new l(a)}transformQuery(a){return this.#H.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}},8853:(a,b,c)=>{"use strict";c.d(b,{$s:()=>j,U2:()=>i,dJ:()=>l,qH:()=>k});var d=c(5152),e=c(7460),f=c(2863),g=c(5788),h=c(5397);function i(a){var b;return(0,g.MH)(a)?(b=a).some(h.SS)?e.s.create(b.map(a=>j(a))):d.h.create(b):j(a)}function j(a){return(0,h.SS)(a)?(0,h.YK)(a):f.q.create(a)}function k(a){return(0,g.Et)(a)||(0,g.Lm)(a)||(0,g.kZ)(a)}function l(a){if(!k(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return f.q.createImmediate(a)}},8896:(a,b,c)=>{"use strict";c.d(b,{a:()=>h});var d=c(3064),e=c(9411),f=c(3783),g=c(9758);function h(a,b){var c,h,i,j,k,l,m,n;if(3===b.length){return c=a,h=b[0],i=b[1],j=b[2],d.b.createWithOn(c,(0,g.uJ)(h),(0,e.vC)(i,"=",j))}if(2===b.length){return k=a,l=b[0],(0,b[1])((0,f.GQ)(k,l)).toOperationNode()}if(1===b.length){return m=a,n=b[0],d.b.create(m,(0,g.uJ)(n))}throw Error("not implemented")}},8976:(a,b,c)=>{"use strict";c.d(b,{bE:()=>o,xk:()=>p});var d=c(3995),e=c(7187),f=c(5788);let g=(0,f.CN)({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>(0,f.CN)({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>(0,f.CN)({...a,...b})});var h=c(8706),i=c(2325);let j={create:a=>(0,f.CN)({kind:"CollateNode",collation:i.O.create(a)})};class k{#a;constructor(a){this.#a=(0,f.CN)(a)}desc(){return new k({node:g.cloneWith(this.#a.node,{direction:h.z.createWithSql("desc")})})}asc(){return new k({node:g.cloneWith(this.#a.node,{direction:h.z.createWithSql("asc")})})}nullsLast(){return new k({node:g.cloneWith(this.#a.node,{nulls:"last"})})}nullsFirst(){return new k({node:g.cloneWith(this.#a.node,{nulls:"first"})})}collate(a){return new k({node:g.cloneWith(this.#a.node,{collation:j.create(a)})})}toOperationNode(){return this.#a.node}}var l=c(5147),m=c(5397),n=c(4757);function o(a){return"asc"===a||"desc"===a}function p(a){if(2===a.length)return[q(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?((0,l.u)("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>q(a))):[q(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function q(a,b){let c=function(a){if((0,m.SS)(a))return(0,m.YK)(a);if((0,d.C)(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?((0,l.u)("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),r((0,n.q5)(b),c)):(0,n.q5)(a)}(a);if(g.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return r(c,b)}function r(a,b){if("string"==typeof b){if(!o(b))throw Error(`Invalid order by direction: ${b}`);return g.create(a,h.z.createWithSql(b))}if((0,e.B)(b))return(0,l.u)("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),g.create(a,b.toOperationNode());let c=g.create(a);return b?b(new k({node:c})).toOperationNode():c}},9119:(a,b,c)=>{"use strict";c.d(b,{k:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONOperatorChainNode",operator:a,values:(0,d.CN)([])}),cloneWithValue:(a,b)=>(0,d.CN)({...a,values:(0,d.CN)([...a.values,b])})})},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9302:(a,b,c)=>{"use strict";c.d(b,{kQ:()=>e,sy:()=>f});var d=c(5788);let e="kysely_migration",f="kysely_migration_lock";(0,d.CN)({__noMigrations__:!0})},9411:(a,b,c)=>{"use strict";c.d(b,{GB:()=>n,KN:()=>r,Ve:()=>q,ds:()=>o,vC:()=>p});var d=c(4063),e=c(5788),f=c(9865),g=c(4936),h=c(4757),i=c(8853),j=c(2863),k=c(6663),l=c(2435),m=c(8107);function n(a){if(3===a.length)return o(a[0],a[1],a[2]);if(1===a.length)return(0,i.$s)(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function o(a,b,c){var e;return("is"===(e=b)||"is not"===e)&&s(c)?d.l.create((0,h.$O)(a),t(b),j.q.createImmediate(c)):d.l.create((0,h.$O)(a),t(b),(0,i.U2)(c))}function p(a,b,c){return d.l.create((0,h.$O)(a),t(b),(0,h.$O)(c))}function q(a,b){return r(Object.entries(a).filter(([,a])=>!(0,e.b0)(a)).map(([a,b])=>o(a,s(b)?"is":"=",b)),b)}function r(a,b,c=!0){let e="and"===b?k.s.create:m.K.create;if(0===a.length)return d.l.create(j.q.createImmediate(1),g.zX.create("="),j.q.createImmediate(+("and"===b)));let f=u(a[0]);for(let b=1;b<a.length;++b)f=e(f,u(a[b]));return a.length>1&&c?l.k.create(f):f}function s(a){return(0,e.kZ)(a)||(0,e.Lm)(a)}function t(a){if((0,e.Kg)(a)&&g.we.includes(a))return g.zX.create(a);if((0,f.N)(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function u(a){return(0,f.N)(a)?a.toOperationNode():a}},9622:(a,b,c)=>{"use strict";c.d(b,{O:()=>e});var d=c(5788);let e=(0,d.CN)({is:a=>"OrderByNode"===a.kind,create:a=>(0,d.CN)({kind:"OrderByNode",items:(0,d.CN)([...a])}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})})},9758:(a,b,c)=>{"use strict";c.d(b,{JB:()=>j,M$:()=>m,Xm:()=>l,uJ:()=>k});var d=c(5788),e=c(8740),f=c(8572),g=c(5397),h=c(2325),i=c(2102);function j(a){return(0,d.MH)(a)?a.map(a=>k(a)):[k(a)]}function k(a){return(0,d.Kg)(a)?l(a):(0,i.uc)(a)?a.toOperationNode():(0,g.v0)(a)}function l(a){let b=" as ";if(!a.includes(b))return m(a);{let[c,d]=a.split(b).map(n);return e.N.create(m(c),h.O.create(d))}}function m(a){if(!a.includes("."))return f.H.create(a);{let[b,c]=a.split(".").map(n);return f.H.createWithSchema(b,c)}}function n(a){return a.trim()}},9865:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(5788);function e(a){return(0,d.Gv)(a)&&(0,d.Tn)(a.toOperationNode)}}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[431],()=>b(b.s=2041));module.exports=c})();